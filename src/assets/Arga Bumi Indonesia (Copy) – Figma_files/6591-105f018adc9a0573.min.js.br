"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="db1c13c9-9679-5265-9b40-e01842e4abaf")}catch(e){}}();
(globalThis.webpackChunk_figma_web_bundler=globalThis.webpackChunk_figma_web_bundler||[]).push([[6591],{132539:(e,t,n)=>{n.d(t,{A:()=>o});let o=new(n(722458)).b({name:"FigmaScope",dependencies:[],exports:[],routeHints:[],enforce:!1,friendFiles:[],eslint:{rules:{"react/no-array-index-key":"off","@typescript-eslint/no-explicit-any":"off"}}})},789528:(e,t,n)=>{n.d(t,{J:()=>o});let o="dragged_styles--transparent--k4E4U"},43607:(e,t,n)=>{n.d(t,{Fd:()=>a,GE:()=>i,KM:()=>o,Sj:()=>r,Y$:()=>s});let o="multiplayer_viewport_overlay--viewportFrame--QsDIw",i="multiplayer_viewport_overlay--multiplayerBellOuterContainer--nFGro",r="multiplayer_viewport_overlay--multiplayerBellOuterContainerZIndex--us-sW",s="multiplayer_viewport_overlay--prototypeView---d4-5",a="multiplayer_viewport_overlay--delayTransition--YaWi4"},106181:(e,t,n)=>{n.d(t,{A9:()=>l,LF:()=>a,MI:()=>u,Mg:()=>c,OI:()=>r,cR:()=>s,lT:()=>o,m:()=>i,uX:()=>m,z_:()=>d});let o="share_button--shareButtonContainer--LA-wf",i="share_button--legacyShareButtonContainer--51MTb",r="share_button--shareButton--BPUkd share_button--textButtonContainer--uqZsQ",s="share_button--shareButtonExtraMargin--4zFpB share_button--shareButton--BPUkd share_button--textButtonContainer--uqZsQ",a="share_button--shareButtonWorkshop--zKuoB",l="share_button--shareButtonLoading--vLUAl",d="share_button--shareButtonPersonalDraftDisabled--PZUda share_button--shareButton--BPUkd share_button--textButtonContainer--uqZsQ",c="share_button--shareButtonFigjamDisabled--O-XXk",u="share_button--shareButtonSecondary--0-pgr",m="share_button--textButton--x7STz basic_form--primaryBtn--AU7Gy basic_form--btn--FSrmp ellipsis--ellipsis--Tjyfa text--fontPos11--2LvXf text--_fontBase--QdLsd"},556668:(e,t,n)=>{n.d(t,{ET:()=>i,HG:()=>a,Jy:()=>c,M4:()=>p,OP:()=>u,RT:()=>l,RX:()=>d,dG:()=>s,eP:()=>r,iE:()=>o,t$:()=>m});let o="face_stamps--stamp--W89mK",i="face_stamps--miniStampContainer--SDVwN",r="face_stamps--stampImagePlaceholder--pXueE",s="face_stamps--miniStamp--8eY9E",a="face_stamps--stampContainer--pSzJJ",l="face_stamps--faceStampButton--Ivbob",d="face_stamps--draggingStamp--fb7wV",c="face_stamps--draggingCopy--iNJaR",u="face_stamps--faceLabel--L-WBK ellipsis--ellipsis--Tjyfa",m="face_stamps--faceLabelPlaceholder--E9aYz",p="face_stamps--nonMiniStampPlaceholderContainer--QGaUd"},31863:(e,t,n)=>{n.d(t,{M:()=>i,h:()=>o});let o="reconnecting_modal--reconnectingModal--zB52E",i="reconnecting_modal--reconnectingModalAnimate--OCvjJ"},231704:(e,t,n)=>{n.d(t,{Ge:()=>d,JY:()=>o,V6:()=>l,VF:()=>a,f_:()=>s,r3:()=>r,s:()=>i});let o="dlt_universal_insert_collage--universalInsertCollageIcon--1oKSL",i="dlt_universal_insert_collage--collageIconContainer--Mkqay",r="dlt_universal_insert_collage--ignorePointerEvents--G4rRr",s="dlt_universal_insert_collage--collageScaleContainer--uLvqK",a="dlt_universal_insert_collage--collageImage--LdlFw",l="dlt_universal_insert_collage--errorBoundaryFallback--6P7SR",d="dlt_universal_insert_collage--universalInsertCollageIconContainer--yExun"},895528:(e,t,n)=>{n.d(t,{C0:()=>l,D9:()=>y,EA:()=>_,O8:()=>b,QE:()=>m,Qf:()=>g,SD:()=>h,TK:()=>s,UD:()=>o,W0:()=>c,WK:()=>x,_v:()=>C,cG:()=>a,fK:()=>f,hQ:()=>u,iG:()=>v,nT:()=>p,sI:()=>d,wx:()=>r,yM:()=>i});let o="vote_pins--votePinRoot--zOOjP",i="vote_pins--votePin--5E3rC",r="vote_pins--header--pfexD",s="vote_pins--headerText--O9EJ7 text--fontPos14--OL9Hp text--_fontBase--QdLsd",a="vote_pins--closeButtonContainer--WZCu2",l="vote_pins--medal--hNcNQ",d="vote_pins--expandingSection--wKym-",c="vote_pins--voterListSeparator--k0aO1",u="vote_pins--voterList--6fCBS",m="vote_pins--voterListItem--wa-M9",p="vote_pins--userName---6RMO text--fontPos11--2LvXf text--_fontBase--QdLsd ellipsis--ellipsis--Tjyfa",h="vote_pins--loadingAvatar--hq0Fh",f="vote_pins--loadingUserName--80x3W",g="vote_pins--voterListOverflowItem--V2jcD vote_pins--voterListItem--wa-M9",_="vote_pins--voterListOverflowIcon--xyXs6",v="vote_pins--voterListOverflowText--48DhR vote_pins--userName---6RMO text--fontPos11--2LvXf text--_fontBase--QdLsd ellipsis--ellipsis--Tjyfa",x="vote_pins--stampPreviewList--qlQDN",b="vote_pins--stampPreview--XkjWz",C="vote_pins--stampPreviewOverflow--QoTgf text--fontPos12--YsUAh text--_fontBase--QdLsd",y="vote_pins--offscreenMeasurementContainer--QYGnX"},637286:(e,t,n)=>{n.d(t,{xf:()=>x});var o=n(716976),i=n(903927),r=n(949701),s=n(609060),a=n(366535),l=n(847282),d=n(225417),c=n(74620),u=n(592726),m=n(944350),p=n(613936),h=n(19233),f=n(813166),g=n(75923);let _="edit_request",v="move_to_project";function x(e){let t=(0,i.wA)(),n=(0,g.RC)(),x=(0,g.Yx)(),b=e.editorType===m._Y.WHITEBOARD&&!!e.org?.figjamDisabledAt,C=e.editorType===m._Y.SLIDES&&(0,r.oA)(e.org?.isSlidesDisabled),y=e.editorType===m._Y.SITES&&e.org?.isSitesDisabled,w=e.editorType===m._Y.COOPER&&e.org?.isCooperDisabled,j=(0,c.aV)(),k=(0,u.iZ)();o.useEffect(()=>{let o=(0,l.QL)(_),i="true"===(0,l.QL)(v);o&&!j&&function(o){if(b||C||y||w||!n)return;let r=x.find(e=>e.id===o);if(r?.level!==p.e6.EDITOR||r.status!==h.IZ.Pending)return;let c=e.ownerRole?.userId,u=k?.id;if(null==c||null==u||c!==u)return;let m=r.requesterUser?.handle;if(!m)return;let g=i&&n.isFreeUserOnly&&n.isInDraftsFolder&&!n.hasOrg,j={handle:m,requestType:p.e6.EDITOR,roleRequestId:o};t((0,a.to)({type:f.g_,data:{fileKey:n.file?.key??e.key,source:d.nk.editRequestExternal}})),g&&(0,s.h)(n.file,n.repo,t,{handlesVisualBell:!0,callback:e=>{(0,h.wR)(t,h.IZ.Approved,j)}}),(0,l.EM)(_),(0,l.EM)(v)}(o)},[e,k,n,x,b,C,y,w,j,t])}},75923:(e,t,n)=>{n.d(t,{RC:()=>p,Yx:()=>m});var o=n(716976),i=n(903927),r=n(795033),s=n(449572),a=n(392243),l=n(381059),d=n(211862),c=n(59849),u=n(445046);function m(){let e=(0,d.tS)(),t=(0,s.Rs)(c.nn0,{fileKey:e??""},{enabled:!!e});return(0,o.useMemo)(()=>t.data?.file?.fileRoleRequests??[],[t.data?.file?.fileRoleRequests])}function p(){let e=(0,i.d4)(e=>e.currentUserOrgId),t=(0,i.d4)(d.vu),n=(0,r.md)(l.t).data??!0,m=(0,s.Rs)(c.L1I,{fileKey:t?.key??"",teamId:t?.team_id??null,repoId:t?.file_repo_id??null,projectId:t?.folder_id??null,currentOrgId:e??null});return(0,o.useMemo)(()=>{let e="loaded"===m.status&&m.data.file;if(!e)return null;let o=e.project,i=(0,a.VA)(o);return{file:t,repo:e.repo?{...(0,u.Xs)(e.repo),canEdit:e.repo.canEdit}:null,hasOrg:!!e.org,isInDraftsFolder:i,isFreeUserOnly:n}},[t,m.status,m.data,n])}},252112:(e,t,n)=>{n.d(t,{j:()=>o});let o={library:new(n(821359)).MH}},992753:(e,t,n)=>{n.d(t,{$5:()=>f,E6:()=>p,d9:()=>u});var o=n(795033),i=n(719097),r=n(211862),s=n(140948),a=n(381643),l=n(235711);let d=(0,s.bt)(e=>e.multiplayer.allUsers);(0,o.eU)(e=>{let t=e(i.p9),n=e(d);if(t&&0!==n.length)return n.filter(e=>e.userID!==t.id)});let c=(0,s.bt)(e=>e.multiplayer.deviceNameFilter),u=(0,o.eU)(e=>{let t=e(d),n=e(c);return null!=e(r.yV)&&null!=n&&new Set(t.filter(e=>e.deviceName===n).map(e=>e.userID)).size>1}),m=(0,l.r1)("seen_spotlight_hint"),p=(0,a.Z1)(m,(e,t)=>{let n=t(d),o=t(c);if(t(h))return!1;let i=n.filter(e=>e.deviceName===o),r=Math.max(...Object.values(i).map(e=>e.joinedAtS))-300,s=new Set;for(let e of i)e.joinedAtS>=r&&s.add(e.userID);return!(s.size<5)&&!e}),h=(0,s.bt)(e=>{let t="fullscreen"===e.selectedView.view&&!e.mirror.appModel.showUi,n="prototype"===e.selectedView.view&&e.selectedView.hideUI;return t||n}),f=(0,s.bt)(e=>{let t="fullscreen"===e.selectedView.view&&e.mirror.appModel.showUi,n="prototype"===e.selectedView.view&&!e.selectedView.hideUI;return t||n})},374618:(e,t,n)=>{n.d(t,{NE:()=>a});var o=n(266808),i=n(795033),r=n(337059);let s=(0,n(637599).vv)(()=>o.Ez5?.prototypingEditorState()?.activePrototypeDevice,null),a=(0,i.mg)(s,e=>!!e&&(0,r.ln)(e.presetIdentifier))},695203:(e,t,n)=>{n.d(t,{z:()=>c});var o=n(104076),i=n(754245),r=n(511570),s=n.n(r),a=n(437761),l=n(809635),d=n(222525);function c(e){if(!e.dragState?.dragPosition||!e.dragState?.dragOffset)return null;let t=e.dragState.dragPosition.subtract(e.dragState.dragOffset),n=(0,a.ZQ)(e.dragState.draggingResource)?l.W:e.dragState.draggingResource.redirect_icon_url;return(0,i.createPortal)((0,o.jsx)("img",{src:n,alt:e.dragState.draggingResource.name,className:s()(d.fe,{[d.Yg]:e.dragState.isDraggingOverCanvas}),style:{left:t.x,top:t.y,width:e.dragState.draggingThumbSize?.x,height:e.dragState.draggingThumbSize?.y},draggable:!1}),document.getElementById("fullscreen-root"))}},114400:(e,t,n)=>{n.d(t,{S:()=>m});var o=n(104076),i=n(754245),r=n(511570),s=n.n(r),a=n(411017),l=n(220411),d=n(652960),c=n(583669),u=n(222525);function m(e){let t=(0,a.fG)();if(!e.dragState?.dragPosition||!e.dragState?.dragOffset)return null;let n=e.dragState.draggingResource,r=e.dragState.dragPosition.subtract(e.dragState.dragOffset),{imageUrl:m,name:p,thumbnailIsSet:h,hubFileId:f,clientMeta:g,isWhiteboard:_,resizedThumbnailUrls:v}=t(n);return(0,i.createPortal)((0,o.jsx)("div",{className:s()(u.y3,{[u.Yg]:e.dragState.isDraggingOverCanvas}),style:{left:r.x,top:r.y,width:e.dragState.draggingThumbSize?.x,height:e.dragState.draggingThumbSize?.y},children:(0,o.jsx)(d.FK,{removeBorder:!0,children:(0,o.jsx)(c.Ho,{backgroundColor:(0,l.Cn)(g),image:m,isSet:h,isWhiteboard:_,hubFileId:f,alt:p,resizedThumbnailUrls:v})})}),document.getElementById("fullscreen-root"))}},81910:(e,t,n)=>{n.d(t,{E:()=>c});var o=n(104076),i=n(754245),r=n(511570),s=n.n(r),a=n(437761),l=n(196497),d=n(222525);function c(e){if(!e.dragState?.dragPosition||!e.dragState?.dragOffset)return null;let t=e.dragState.dragPosition.subtract(e.dragState.dragOffset),n=(0,a.ZQ)(e.dragState.draggingResource)?l.J:e.dragState.draggingResource.redirect_snapshot_url;return(0,i.createPortal)((0,o.jsx)("img",{src:n??void 0,alt:e.dragState.draggingResource.name,className:s()(d.Az,{[d.Yg]:e.dragState.isDraggingOverCanvas}),style:{left:t.x,top:t.y,width:e.dragState.draggingThumbSize?.x,height:e.dragState.draggingThumbSize?.y},draggable:!1}),document.getElementById("fullscreen-root"))}},568563:(e,t,n)=>{n.d(t,{Z:()=>l});var o=n(819851),i=n(664326),r=n(433802),s=n(436648),a=n(226697);function l(e){let t="whiteboard"===(0,o.lg)(),n=(0,a.F5)(),l=async o=>(e.insertAction(o),t&&(0,a.oM)({type:s.Rt.ORG_FACE_STAMPS,source:e.triggeredFrom,options:{...n,query:e.searchQuery}}),await Promise.resolve());return(0,i.t)({resource:e.resource,draggingThumbMaxDimensions:e.draggingThumbMaxDimensions,onDragStart:e.onDragStart,isDraggingDisabled:e.isDraggingDisabled,recomputeCancelRectsOnPointerUp:e.recomputeCancelRectsOnPointerUp,clickToInsert_DEPRECATED:e.clickToInsert_DEPRECATED,afterSuccessfulInsert:e.afterSuccessfulInsert},{insertAction:l,dragPreviewPointerPosition:r.N.RELATIVE,getDragPreviewSrc:()=>e.iconSrc,recordingKey:`insertable-facestamp-${e.resource.id}-${e.mini?"mini":"full"}`})}},238077:(e,t,n)=>{n.d(t,{c:()=>C});var o=n(903927),i=n(641518),r=n(147046),s=n(278491),a=n(201975),l=n(819851),d=n(4232),c=n(4033),u=n(548883),m=n(664326),p=n(433802),h=n(971990),f=n(904017),g=n(360606),_=n(437761),v=n(994847),x=n(809635),b=n(226697);function C(e){let t=(0,f.X$)("useInsertablePlugin").unwrapOr(null),n=(0,f.H3)(t),C=(0,d.Gt)(e.resource.plugin_id,e.triggeredFrom),y=(0,d.dR)(e.resource.plugin_id,e.triggeredFrom),w="whiteboard"===(0,l.lg)(),j=(0,b.F5)(),k=(0,a.t)(e.resource.plugin_id,C,y),P=(0,o.wA)(),I=k.length>0,T=(0,c.cW)(),E=(0,u.EO)(T[e.resource.plugin_id]),M=(0,h.x)({isWidget:!1,id:e.resource.plugin_id}),{validatePublishedPluginInOrgAllowlist:A}=(0,c.j1)(e.resource.plugin_id);return(0,m.t)({resource:e.resource,draggingThumbMaxDimensions:e.draggingThumbMaxDimensions,onDragStart:e.onDragStart,isDraggingDisabled:e.isDraggingDisabled,recomputeCancelRectsOnPointerUp:e.recomputeCancelRectsOnPointerUp,clickToInsert_DEPRECATED:e.clickToInsert_DEPRECATED,afterSuccessfulInsert:e.afterSuccessfulInsert},{insertAction:t=>{if(e.showRequestFlow)return Promise.resolve();let n=A();if(!(0,_.ZQ)(e.resource)&&!n)return Promise.resolve();if(E)M();else{let{e:n}=t;I?P(r.j7({type:s.LO,data:{pluginId:e.resource.plugin_id,target:{top:n.clientY,bottom:n.clientY,right:n.clientX,left:n.clientX,width:0,height:0},triggeredFrom:e.triggeredFrom}})):(0,_.ZQ)(e.resource)?y():C()}return w&&(0,b.oM)({id:e.resource.plugin_id,type:v.p.PLUGINS,source:e.triggeredFrom,options:{...j,query:e.searchQuery}}),Promise.resolve()},dragPreviewPointerPosition:p.N.CENTERED,getDragPreviewSrc:()=>(0,_.ZQ)(e.resource)?x.W:e.resource.redirect_icon_url||"",onPointerDownCallback:()=>{e.showRequestFlow||(0,_.ZQ)(e.resource)||E||g.F.getAndCache(e.resource,n)},recordingKey:i.Pt("plugin",e.resource.plugin_id)})}},635148:(e,t,n)=>{n.d(t,{B:()=>m});var o=n(266808),i=n(641518),r=n(819851),s=n(141773),a=n(411017),l=n(664326),d=n(433802),c=n(994847),u=n(226697);function m(e){let{insertTemplate:t}=(0,s.Fz)(),n="whiteboard"===(0,r.lg)(),m=(0,u.F5)(),{primaryKey:p,imageUrl:h}=(0,a.fG)()(e.resource),f=async i=>{let{dropPosition:r,isClick:s}=i;return n&&(0,u.oM)({id:e.resource.template.id,type:c.p.TEMPLATES,source:e.triggeredFrom,options:{...m,query:e.searchQuery}}),await t({template:e.resource,templateInsertionDirection:s?o.hKj.RIGHT:o.hKj.CUSTOM_POSITION,templateCustomPosition:s?void 0:r,triggeredFrom:e.triggeredFrom})};return(0,l.t)({resource:e.resource,draggingThumbMaxDimensions:e.draggingThumbMaxDimensions,onDragStart:e.onDragStart,isDraggingDisabled:e.isDraggingDisabled,recomputeCancelRectsOnPointerUp:e.recomputeCancelRectsOnPointerUp,clickToInsert_DEPRECATED:e.clickToInsert_DEPRECATED,afterSuccessfulInsert:e.afterSuccessfulInsert},{insertAction:f,dragPreviewPointerPosition:d.N.RELATIVE,getDragPreviewSrc:()=>h||"",recordingKey:i.Pt("template",p)})}},966854:(e,t,n)=>{n.d(t,{P:()=>x});var o=n(170627),i=n(641518),r=n(361170),s=n(819851),a=n(4033),l=n(548883),d=n(156134),c=n(288747),u=n(664326),m=n(433802),p=n(971990),h=n(360606),f=n(437761),g=n(994847),_=n(196497),v=n(226697);function x(e){let t=(0,c.dq)()||void 0,n="whiteboard"===(0,s.lg)(),r=(0,v.F5)(),x=(0,a.ZT)(),C=(0,l.EO)(x[e.resource.plugin_id]),y=(0,p.x)({isWidget:!0,id:e.resource.plugin_id});return(0,u.t)({resource:e.resource,draggingThumbMaxDimensions:e.draggingThumbMaxDimensions,onDragStart:e.onDragStart,isDraggingDisabled:e.isDraggingDisabled,recomputeCancelRectsOnPointerUp:e.recomputeCancelRectsOnPointerUp,clickToInsert_DEPRECATED:e.clickToInsert_DEPRECATED,afterSuccessfulInsert:e.afterSuccessfulInsert},{insertAction:t=>{if(C)y();else{let{dropPosition:n}=t;o.l7.user("insert-widget",()=>(0,d.j)({pluginID:e.resource.plugin_id,widgetName:e.resource.name,pluginVersionID:(0,f.ZQ)(e.resource)?"":e.resource.id,position:n.subtract(b),triggeredFrom:e.triggeredFrom}))}return n&&(0,v.oM)({id:e.resource.plugin_id,type:g.p.WIDGETS,source:e.triggeredFrom,options:{...r,query:e.searchQuery}}),Promise.resolve()},dragPreviewPointerPosition:m.N.RELATIVE,getDragPreviewSrc:()=>(0,f.ZQ)(e.resource)?_.J:e.resource.redirect_snapshot_url||"",onPointerDownCallback:()=>{(0,f.ZQ)(e.resource)||C||h.F.getAndCache(e.resource,t)},recordingKey:i.Pt("widget",e.resource.plugin_id)})}let b=new r.Mi(64,32)},971990:(e,t,n)=>{n.d(t,{x:()=>c});var o=n(716976),i=n(903927),r=n(192075),s=n(58212),a=n(117709),l=n(16480),d=n(146299);function c({isWidget:e,id:t}){let n=(0,i.wA)(),c=o.useCallback(()=>{(0,a.e)({id:t,isWidget:e,source:"extension-requires-payment-error"},o.createElement(d.C,{extensionId:t,extensionType:l.Ag.COMMUNITY}))},[t,e]);return o.useCallback(()=>{n(s.F.enqueue({message:e?(0,r.t)("community.buyer.paid_widgets_cannot_be_added_to_the_canvas_before_purchase"):(0,r.t)("community.buyer.paid_plugins_cannot_be_run_before_purchase"),error:!0,button:{text:(0,r.t)("community.buyer.buy"),action:c},type:e?"widget_requires_payment":"plugin_requires_payment"}))},[n,e,c])}},228439:(e,t,n)=>{n.d(t,{Q:()=>F});var o=n(104076),i=n(903927),r=n(307829),s=n(438557),a=n(936031),l=n(781767),d=n(812714),c=n(511570),u=n.n(c),m=n(983500),p=n(264830),h=n(115989),f=n(192075),g=n(142914),_=n(147046),v=n(675477),x=n(226377),b=n(565854),C=n(211862),y=n(592726),w=n(894210),j=n(737139),k=n(286911),P=n(828127),I=n(826160),T=n(699745),E=n(560823),M=n(623355),A=n(404343);let S=(0,m.jz)(A.m52),N=(0,m.jz)(A.Ko3);function D(e){let t=(0,i.d4)(e=>e.multiplayer);return"sessionID"in e&&t.observingSessionID===e.sessionID}var O=(e=>(e.CURRENT_USER="current_user",e.FILE_CREATOR="file_creator",e))(O||{});function R(e){let{user:t,onClick:n,volumeIcon:c,containsCursor:m,secondaryActions:p,disableSpotlightAnimation:_}=e,v=(0,C.q5)(),x=(0,i.d4)(e=>e.multiplayer),P=(0,y.iZ)(),M=D(t),{getTriggerProps:A,manager:S}=r.b(),N=x.allUsers.length>1,O=P?.id===t.userID,R="prototype"===(0,i.d4)(e=>e.selectedView).view,L=(0,o.jsx)(I.Ro,{entity:{...t,id:t.userID},className:E.Fp,size:24},t.userID),F=(0,b.Py)(t);(0,b.AD)(t)?L=(0,o.jsx)("span",{className:E.LH,children:(0,o.jsx)(k.vQ,{sessionID:t.sessionID,observingSessionID:x.observingSessionID,presenterSessionID:x.presenterSessionID??null,nominatedSessionID:x.sessionsNominatingCurrentUser.length>0?x.sessionID:null,user:t,showColorIndicators:N,horizontal:!0,disableSpotlightAnimation:_})}):F&&(L=(0,o.jsx)("span",{className:E.LH,children:(0,o.jsx)("div",{className:T._L,children:(0,o.jsx)(g.H8,{user:{...t,id:t.userID}})})}));let B=u()({[E.MO]:!0,[E.Cu]:e.isCurrentUserHeaderRow,[E.BI]:e.isInListbox&&!F,[E.yH]:m&&!F,[E.UD]:F}),U=()=>O?"current_user":t.userID===v?.creatorId?"file_creator":null,V=()=>{let e=U();return"current_user"===e?(0,o.jsxs)("span",{children:[" ",(0,f.tx)("collaboration.voice.you_lower_cased")]}):"file_creator"===e?(0,o.jsxs)("span",{children:[" ",(0,d.kc)().multiplayer_avatar_show_creator_label?(0,f.tx)("collaboration.voice.creator"):(0,f.tx)("collaboration.voice.owner")]}):""},q=()=>F?(0,o.jsx)("span",{className:E.FH,children:(0,o.jsx)(h.h1,{date:t.viewedAt})}):null,H=()=>{let e=p?.map(e=>o.jsx(r.q7,{onClick:t=>{t.stopPropagation(),t.preventDefault(),e.onClick(t)},disabled:e.disabled,children:e.text},e.key));return(0,o.jsx)(r.mc,{children:e})},z=()=>(0,o.jsxs)(r.bL,{manager:S,children:[(0,o.jsx)("div",{className:E.G7,children:(0,o.jsx)(s.u,{className:E.Xg,"aria-label":(0,f.t)("fullscreen.toolbar.multiplayer.more_options"),"data-tooltip-type":w.Ib.TEXT,"data-tooltip":(0,f.t)("fullscreen.toolbar.multiplayer.more_options"),...A(),children:(0,o.jsx)(l.J,{})})}),H()]}),Z=(0,o.jsxs)(j.fI,{className:u()(E.Hl,{[E.Sh]:(0,d.kc)().fix_overflow_menu_display&&R}),children:[L,(0,o.jsxs)("span",{className:E.nP,children:[(0,o.jsxs)("span",{className:E.ko,children:[(0,o.jsx)("span",{className:E.j7,children:(0,b.Py)(t)?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:E.TV,children:t.name}),q()]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("span",{className:E.DL,children:[t.name,V()]}),m&&(0,o.jsx)("span",{className:E.FH,children:M?(0,f.tx)("collaboration.voice.click_to_unfollow"):(0,f.tx)("collaboration.voice.click_to_follow")})]})}),c&&(0,o.jsx)("span",{className:E.e6,children:c})]}),(0,o.jsx)("span",{className:E.vO,children:p&&p.length>0&&z()})]})]});return n?(0,o.jsxs)(a.bL,{className:u()(B,{[E.Lk]:!F&&!S.isOpen,[E.tE]:!F&&S.isOpen}),children:[(0,o.jsx)(a.O6,{onClick:n,className:E.L8,"aria-label":M?(0,f.t)("collaboration.voice.click_to_unfollow_user",{username:t.name}):(0,f.t)("collaboration.voice.click_to_follow_user",{username:t.name})},t.userID),(0,o.jsxs)(j.fI,{className:u()(E.Hl,{[E.Sh]:(0,d.kc)().fix_overflow_menu_display&&R}),children:[L,(0,o.jsxs)("span",{className:E.nP,children:[(0,o.jsxs)("span",{className:E.ko,children:[(0,o.jsx)("span",{className:E.j7,children:(0,b.Py)(t)?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:E.TV,children:t.name}),q()]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("span",{className:E.DL,children:[t.name,V()]}),(0,o.jsx)("span",{className:E.zO,children:M?(0,f.tx)("collaboration.voice.click_to_unfollow"):(0,f.tx)("collaboration.voice.click_to_follow")})]})}),c&&(0,o.jsx)("span",{className:E.e6,children:c})]}),(0,o.jsx)(a.HG,{className:E.vO,children:p&&p.length>0&&z()})]})]})]}):n?(0,o.jsx)("button",{className:B,onClick:n,children:Z},t.userID):(0,o.jsx)("div",{className:u()(B,{[E.fJ]:S.isOpen}),children:Z},t.userID)}function L(e){let t=(0,i.d4)(e=>e.multiplayer),n=(0,i.d4)(e=>"prototype"===e.selectedView.view?e.prototype.showProgressBar:(0,x.T)(e?.progressBarState?.mode)),r=t.allUsers.length>1;(0,p.Av)();let{user:s,onClick:a,volumeIcon:l,disableSpotlightAnimation:d}=e,c=D(s),m=n?T.K$:"";if(!(0,b.AD)(s))return(0,o.jsxs)("div",{className:u()(T.C7,m),children:[(0,o.jsx)(g.H8,{user:{...s,id:s.userID}}),l&&(0,o.jsx)("span",{className:M.Wh,children:l})]});{let n=`voice-avatar-session-${s.sessionID}`;return(0,o.jsxs)("span",{"data-onboarding-key":e.onboardingKey,className:u()(M.R3,m),children:[a&&(0,o.jsx)("button",{className:M.XF,onClick:a,"data-tooltip-proxy-element-id":n,"aria-label":c?(0,f.t)("fullscreen.toolbar.multiplayer.unfollow_name",{name:s.name}):(0,f.t)("fullscreen.toolbar.multiplayer.follow_a_name",{name:s.name}),"data-fullscreen-intercept":!0}),(0,o.jsx)(k.vQ,{disableSpotlightAnimation:d,hasBorder:e.hasBorder,nominatedSessionID:t.sessionsNominatingCurrentUser.length>0?t.sessionID:null,observingSessionID:t.observingSessionID,presenterSessionID:t.presenterSessionID??null,sessionID:s.sessionID,showColorIndicators:r,tooltipOffsetY:(N-S)/2,tooltipProxyId:n,user:s}),l&&(0,o.jsx)("span",{className:M.Wh,children:l})]})}}function F(e){let{user:t,onboardingKey:n,callMetadata:r,isOverflow:s,isCurrentUserHeaderRow:a,onUserClick:l,containsCursor:d,secondaryActions:c,disableSpotlightAnimation:u,hasBorder:m,hidePopover:p}=e,h=(0,i.wA)(),f=r&&(0,o.jsx)(P.i,{userId:t.userID,userName:t.name,microphoneStyle:r.microphoneStyle,call:r.call,alwaysShowVoiceBars:s,volumeIconMutedState:s?P.S.DEFAULT:P.S.MINI}),g=l&&(e=>{e.stopPropagation(),e.preventDefault(),(0,b.AD)(t)&&(l(t),s?(h(_.oB()),p&&p()):h(v.jD()))});return s||a?(0,o.jsx)(R,{user:t,volumeIcon:f,onClick:g,containsCursor:d,secondaryActions:c,disableSpotlightAnimation:u,isCurrentUserHeaderRow:a}):(0,o.jsx)(L,{user:t,onboardingKey:n,volumeIcon:f,onClick:g,disableSpotlightAnimation:u,hasBorder:m})}},874216:(e,t,n)=>{n.d(t,{_:()=>C});var o=n(104076),i=n(684742),r=n(170627),s=n(812714),a=n(511570),l=n.n(a),d=n(957581),c=n(4033),u=n(548883),m=n(156134),p=n(81910),h=n(966854),f=n(944350),g=n(437761),_=n(550538),v=n(789528),x=n(417451),b=n(241789);function C(e){let t=(0,_.b)(),n=(0,c.ZT)(),a=(0,u.EO)(n[e.widget.plugin_id]),C="boolean"==typeof e.clickToInsert?e.clickToInsert&&!a:!a,{dragState:y,onInsertableResourcePointerDown:w}=(0,h.P)({clickToInsert_DEPRECATED:!1,afterSuccessfulInsert:t,triggeredFrom:e.analytics.triggeredFrom,resource:e.widget,searchQuery:e.analytics.searchQuery}),j=(0,g.ZQ)(e.widget);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(i.E,{"aria-label":(0,s.kc)().figjam_a11y_inserts_modal?e.widget.name:void 0,className:l()({[x.cJ]:!0,[v.J]:!!y,[x.HA]:e.fillContainer,[x.Gb]:e.context===f._Y.WHITEBOARD}),onClick:()=>{C&&r.l7.user("insert-widget",()=>{(0,m.j)({pluginID:e.widget.plugin_id,widgetName:e.widget.name,pluginVersionID:j?"":e.widget.id,triggeredFrom:"universal-insert"}),t()})},htmlAttributes:{onPointerDown:w},"data-testid":"widget-snapshot-draggable",children:[(0,o.jsx)("img",{src:e.src,alt:"",draggable:!1}),(0,o.jsx)("div",{className:x.DJ,children:j&&(0,o.jsx)(d.t,{svg:b.A,useOriginalSrcFills_DEPRECATED:!0,fallbackSvg:b.A})})]}),(0,o.jsx)(p.E,{dragState:y})]})}},70177:(e,t,n)=>{n.d(t,{w:()=>E});var o=n(104076),i=n(716976),r=n(795033),s=n(190028),a=n(653899),l=n(90844),d=n(422872),c=n(992753),u=n(863154),m=n(235711),p=n(592726),h=n(299640),f=n(143277),g=n(739801),_=n(10411),v=n(441030),x=n(883765),b=n(686549),C=n(555013),y=n(192075);let w={SPOTLIGHT_GUIDE:"https://help.figma.com/hc/articles/5025214483351-Facilitate-meetings-with-spotlight",FOLLOW_GUIDE:"https://help.figma.com/hc/articles/360040322673-Follow-collaborators-in-a-file"};function j(e){return(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:"multiplayer_nux_modals--title--N0NZG text--fontPos13--xW8hS text--_fontBase--QdLsd",children:e.title}),(0,o.jsx)("div",{className:"multiplayer_nux_modals--content--mROkG",children:e.content}),(0,o.jsxs)("div",{className:"multiplayer_nux_modals--footerContainer--I-MS-",children:[(0,o.jsx)(C.vd,{className:"multiplayer_nux_modals--footerButton--TJL3G",onClick:e.primaryCTAOnClick,children:e.primaryCTA}),(0,o.jsx)(C.tM,{onClick:e.secondaryCTAOnClick,children:e.secondaryCTA})]})]})}function k({onDismissModal:e}){let t=(0,y.tx)("collaboration.spotlight.2_0.onboarding_spotlight.description_with_spotlight_arg",{spotlightMeButtonText:(0,o.jsx)("b",{children:(0,y.tx)("collaboration.spotlight.tooltip.spotlight_me")})});return(0,o.jsx)(j,{title:(0,y.tx)("collaboration.spotlight.onboarding_spotlight.title"),content:t,secondaryCTA:(0,y.tx)("collaboration.voice.learn_more"),secondaryCTAOnClick:()=>(0,b.FJ)(w.SPOTLIGHT_GUIDE,"_blank","noopener"),primaryCTA:(0,y.tx)("collaboration.spotlight.onboarding.next"),primaryCTAOnClick:()=>{e(),(0,x.sx)("Context Viewed",{name:"should-close-open-spotlight-nux"})}})}function P({onDismissModal:e}){return(0,o.jsx)(j,{title:(0,y.tx)("collaboration.spotlight.onboarding_observation.title"),content:(0,y.tx)("collaboration.spotlight.onboarding_observation.description"),secondaryCTA:(0,y.tx)("collaboration.voice.learn_more"),secondaryCTAOnClick:()=>(0,b.FJ)(w.FOLLOW_GUIDE,"_blank","noopener"),primaryCTA:(0,y.tx)("collaboration.spotlight.onboarding.done"),primaryCTAOnClick:()=>{e()}})}let I="seen_synchronous_collaboration_onboarding",T=(0,m.r1)(I);function E(){let e=(0,r.md)(c.d9),t=(0,r.md)(u.PD),n=(0,r.md)(c.$5),m=(0,r.md)(T),x=(0,p.J$)(),b=(0,s.A)().subtract(7,"day").isBefore((0,s.A)(x)),C=(0,d.e)({overlay:v.aI5,priority:f.N.DEFAULT_MODAL},[t,m]),y=(0,d.e)({overlay:v.ar0,priority:f.N.DEFAULT_MODAL}),w=(0,i.useCallback)(()=>{e&&n&&!b&&C.show({canShow:(e,t)=>!e&&!t})},[e,n,b,C]),j=(0,i.useCallback)(()=>{y.show()},[y]),E=(0,i.useCallback)(()=>{C.complete(),j()},[C,j]);return(0,a.h)(w),(0,l.E)(C.uniqueId,h.M8,w),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(g.h,{element:({onClickPrimaryCta:e})=>(0,o.jsx)(k,{onDismissModal:e}),isShowing:C.isShowing,modalType:_.q3.WALK_THROUGH,onClickPrimaryCta:E,onClose:C.complete,onManualDismiss:C.complete,onboardingKey:"multiplayer-spotlight-nux-key",shouldDismissWhenLostDOMTarget:!0,trackingContextName:"multiplayer_onboarding",userFlagOnShow:I,width:268}),(0,o.jsx)(g.h,{element:({dismissModal:e})=>(0,o.jsx)(P,{onDismissModal:e}),isShowing:y.isShowing,modalType:_.q3.WALK_THROUGH,onClickPrimaryCta:y.complete,onClose:y.complete,onManualDismiss:y.complete,onboardingKey:"multiplayer-observation-nux-key",shouldDismissWhenLostDOMTarget:!0,trackingContextName:"multiplayer_observation_onboarding",userFlagOnShow:I,width:268})]})}},700795:(e,t,n)=>{n.d(t,{b:()=>C});var o=n(104076),i=n(716976),r=n(795033),s=n(653899),a=n(192075),l=n(549571),d=n(819851),c=n(90844),u=n(422872),m=n(992753),p=n(863154),h=n(15061),f=n(299640),g=n(143277),_=n(739801),v=n(10411),x=n(441030);let b=()=>(0,a.t)("collaboration.spotlight.nudge_spotlight.title");function C(){let e=(0,r.md)(p.PD),t=(0,r.md)(m.E6),n=(0,d.m0)(),a=(0,l._I)(),C=n&&!a,y=(0,u.e)({overlay:x.hPP,priority:g.N.SECONDARY_MODAL},[e,t]),w=(0,i.useCallback)(()=>{C||y.show({canShow:(e,t)=>!e&&t})},[C,y]);(0,s.h)(()=>{w()});let j=(0,i.useCallback)(()=>{y.isShowing||w()},[y.isShowing,w]);return(0,c.E)(y.uniqueId,f.M8,j),(0,o.jsx)(_.h,{element:h._,isShowing:y.isShowing,modalType:v.q3.ANNOUNCEMENT_POINTER,onClickPrimaryCta:y.complete,onClose:y.complete,onManualDismiss:y.complete,onboardingKey:"multiplayer-spotlight-nux-key",title:b,trackingContextName:"multiplayer_spotlight_nudge",userFlagOnShow:"seen_spotlight_hint"})}},301452:(e,t,n)=>{n.d(t,{IN:()=>ep,xw:()=>ed,ez:()=>el});var o=n(104076),i=n(716976),r=n(903927),s=n(951002),a=n(638004),l=n(171704),d=n(266808),c=n(795033),u=n(155545),m=n.n(u),p=n(851824),h=n(166887),f=n(328341),g=n(550209),_=n(361170),v=n(11395),x=n(814082),b=n(147046),C=n(646767),y=n(278491),w=n(495896),j=n(551037),k=n(229150),P=n(208045),I=n(692042),T=n(521255),E=n(592726),M=n(331497),A=n(728977),S=n(977899),N=n(198444),D=n(621087),O=n(483824),R=n(643330),L=n(247259),F=n(417439),B=n(277770),U=n(437540),V=n(192075),q=n(662771),H=n(968169),z=n(568590),Z=n(122010),G=n(513785),K=n(531034),X=n(902141);function W({clusteredThreads:e,hasActivePin:t,pageId:n,setClientMeta:r,isCommentsMode:s,setPinRendererRef:a,onCommentInsertionButtonFocusToggle:l}){let d=i.useCallback(()=>{let t=X.iZ?.getFocusedClusterId();return t?e.getById(t):null},[e]),c=(0,H.sT)(),u=i.useRef([]),m=function(e,t){let n=J(),o=(0,G.D)(),r=function(e,t){0===t.current.length&&(t.current=e.all().map(e=>e.id));let n=t.current,o=i.useRef(e),r=o.current,s=e.all().map(e=>e.id),a=X.iZ?.getFocusedClusterId(),l=i.useRef(!!a),d=l.current;if(l.current=!!a,r===e||d&&(!a||!s.includes(a)))return n;let c=Array.from(e.leafNodes).reduce((t,n)=>{let o=r?.getParentOf(n)?.id,i=e.getParentOf(n)?.id;return i&&t.set(i,o),t},new Map),u=e=>n.indexOf(c.get(e)??""),m=[...s].sort((e,t)=>{let n=u(e),o=u(t),i=-1===n?Number.MAX_SAFE_INTEGER:n,r=-1===o?Number.MAX_SAFE_INTEGER:o;if(i!==r)return i-r;if(a){if(e===a&&t!==a)return -1;if(t===a&&e!==a)return 1}return 0});if(a&&!n.includes(a)){let e=m.indexOf(a);if(e>0){let t=m.splice(0,e);m.push(...t)}}return o.current=e,t.current=m,m}(e,t),s=i.useCallback(e=>{let t=X.iZ?.getPinElementByClusterId(e);if(!t)return!1;let n=document.querySelector('[data-testid="properties-panel"]');if(!n)return!1;let o=t.getBoundingClientRect(),i=n.getBoundingClientRect();return o.right>i.left},[]);return i.useCallback((t,i=X.iZ?.getFocusedClusterId())=>{if(!i){let o=1===t?r.length-1:0,i=r[o],a=i?e.getById(i):null;a&&i&&n(a.cluster,s(i))?.then(()=>X.iZ?.focusPinById(i));return}let a=r.findIndex(e=>e===i)+(1===t?-1:1);if(a>=r.length||a<0){o();return}let l=r[a],d=e.getById(l);d&&n(d.cluster,s(l))?.then(()=>X.iZ?.focusPinById(l))},[r,e,n,s,o])}(e,u),p=(0,K.vB)(d,n,r),[h,f]=i.useState(!1),g=i.useCallback(e=>"Tab"===e.key&&(m(e.shiftKey?1:0),e.preventDefault(),e.stopPropagation(),!0),[m]);i.useEffect(()=>{if(!h)return;let e=e=>{if(g(e))return;let t=(()=>{switch(e.key){case"ArrowDown":return{x:0,y:1};case"ArrowUp":return{x:0,y:-1};case"ArrowLeft":return{x:-1,y:0};case"ArrowRight":return{x:1,y:0};default:return null}})();t&&p(_.Mi.scale(e.shiftKey?c.bigNudgeAmount:c.smallNudgeAmount,t))&&(e.preventDefault(),e.stopPropagation())};return window.addEventListener("keydown",e,!0),()=>window.removeEventListener("keydown",e,!0)},[h,m,t,p,c,g]),i.useEffect(()=>{if(s)return(0,q.lg)(e=>{m(0,e)}),()=>{(0,q.lg)(null)}},[s,m]);let v=i.useCallback(t=>{t&&(u.current=function(e){let t=e.all(),n=t.length;if(n<=1||n>100)return t.map(e=>e.id);let o=(e,n)=>Math.hypot(t[e].x-t[n].x,t[e].y-t[n].y),i=new Set(t.map((e,t)=>t)),r=[...i].reduce((e,n)=>t[n].x+t[n].y<t[e].x+t[e].y?n:e,0),s=[r];for(i.delete(r);i.size;){let e=s[s.length-1],t=[...i].reduce((t,n)=>o(e,n)<o(e,t)?n:t);s.push(t),i.delete(t)}return s.map(e=>t[e].id)}(e)),l?.(t)},[e,l]);return(0,o.jsxs)(Z.v,{isAccessible:s,role:"region","aria-label":(0,V.t)("comments.accessibility_pin_region_name"),children:[(0,o.jsx)(G.J,{onNativeEventKeyDown:g,onFocusToggle:v}),(0,o.jsx)("clustered-pins",{"data-fullscreen-intercept":!0,onFocus:()=>f(!0),onBlur:()=>f(!1),ref:a})]})}var Q=(e=>(e[e.Forward=0]="Forward",e[e.Backward=1]="Backward",e))(Q||{});let J=()=>{let e=(0,z.Z)(),t=i.useContext(A.kw),n=(0,U.R)(e=>e.selectedView);return i.useCallback((o,i=!1)=>{let r=o.threads[0];return e((0,q.E1)(r,t,n,i,!0))},[e,t,n])};var Y=n(142462),$=n(292423),ee=n(469756),et=n(681947),en=n(88819),eo=n(766812),ei=(e=>(e[e.Gradual=0]="Gradual",e[e.Jump=1]="Jump",e))(ei||{});let er=$.XC.getPinSize(3),es=Math.max(Y.u5,er.width,er.height),ea=e=>10*Math.round(100*e/10);function el(e,t,n){let o=n,i=t*n,r=es+(0,O.H)(e,n);return i<3*r&&(o=3*r*n/i),o}function ed({config:e,clusterLocation:t,pins:n,currentViewport:o}){let i=m()(n,e=>Math.max(Math.abs(e.x-t.x),Math.abs(e.y-t.y))),r=Math.abs(i.x-t.x),s=Math.abs(i.y-t.y),a=r>s?"width":"height",l=Math.max(r,s),d=e.clusterClickResultViewportPercentage/100,c=o[a]*d/(2*l),u=el(e,l,c);return u/o.zoomScale<1.5&&(u*=1.5),Math.min(u,e.minZoomPercentage/100+.5)}let ec=[d.NLJ.COMMENTS,d.NLJ.SELECT,d.NLJ.SCALE,d.NLJ.HAND,d.NLJ.TYPE],eu=(e,t,n,o,i,r)=>{let{threads:s}=e,a=s.map(e=>o(e)),l=s.map(e=>{let t=e.comments[0].client_meta;return t?.in_frame?t.node_id:void 0}),d=new Map;for(let e of a)for(let t of e.avatars)d.has(t.avatar_user_id)?(d.get(t.avatar_user_id).num_unread_comments+=t.num_unread_comments,d.get(t.avatar_user_id).num_comments+=t.num_comments):d.set(t.avatar_user_id,t);let c=1===s.length;return{id:c?s[0].id:(0,en.Ao)(e,s.length),x:e.x,y:e.y,pins:a,isUnread:a.some(e=>e.isUnread),avatarMap:d,onClick:i(e,a),anchoredNode:l.every(e=>e===l[0])?l[0]:void 0,isPinnedToFile:a.some(e=>e.isPinnedToFile),isSinglePin:c,cluster:e,onKeyDown:r(e,a)}};"customElements"in window&&customElements.define(X.Zb.desiredElementName,X.Zb);let em=i.memo(function(e){let t=!!e.activeThread||e.threads.length>0,n=(0,E.iZ)(),u=(0,N.s)(),m=(0,et.Z5)(),U=(0,r.wA)(),V=i.useContext(A.kw),q=i.useRef(null),H=(0,r.d4)(e=>e.mirror.appModel.currentTool),z=(0,M.ut)(d.Ez5?.editorState().handToolTemporarilyEnabled,!1),Z=(0,T.BI)(),G=e.activeThread?.id===S.hm,Q=G?null:e.activeThread?.id||null,J=(0,r.d4)(e=>e.comments.emphasizedPinIds),{zoomScale:Y,deltaOffsetX:ei,deltaOffsetY:er,deltaZoomScale:es}=(0,I.PD)({subscribeToUpdates_expensive:t}),{requestToDeselectCommentPin:el}=e,[em,ep]=i.useState(!1),eh=(0,C.qN)(),ef=(0,j.k)(),eg=(0,v.WN)(),[e_,ev]=i.useState(void 0),[ex,eb]=i.useState(!1),eC=(0,c.md)(X.ux),ey=i.useRef(null),ew=(0,c.md)(D.R),ej=(0,r.d4)(e=>![d.m1T.DESIGN_LAYOUT,d.m1T.WHITEBOARD_LAYOUT,d.m1T.HISTORY,d.m1T.PREVIEW,d.m1T.COMMENTS,d.m1T.DEV_HANDOFF,d.m1T.SLIDE_LAYOUT,d.m1T.SITES_LAYOUT].includes(e.mirror.appModel.activeCanvasEditModeType)||e.mirror.appModel.activeUserAction!==d.QOV.DEFAULT),ek=(0,r.d4)(e=>e.mirror.appModel.activeCanvasEditModeType===d.m1T.COMMENTS),eP=ej&&(!Z||Z?.shouldOptimizeForIpadApp&&Z?.shouldFadeCommentsDuringEdit),[eI,eT]=i.useState(!1),eE=eP||H===d.NLJ.MULTISELECT||eI,[eM,eA]=i.useState({viewport:V.getViewportInfo(),hasJumped:!1}),eS=i.useRef(e.threads);i.useEffect(()=>{eS.current=e.threads},[e.threads]);let eN=i.useCallback(e=>eS.current?.find(t=>t.id===e)||null,[eS]),eD=(0,r.d4)(e=>e.mirror.appModel.activeUserAction);i.useEffect(()=>{let e=q.current;e&&(e.shouldDisablePointerEvents=!ef&&u?.disableCommentsWhenHandToolEnabled&&H===d.NLJ.HAND||z||void 0!==eD&&eD!==d.QOV.DEFAULT||H===d.NLJ.MULTISELECT)},[q,H,z,eD,u?.disableCommentsWhenHandToolEnabled,ef]);let eO=e.dragDisabledOverride||!ec.includes(H),eR=(0,K.BK)(eN,e.pageId,e.setClientMeta,eO,e.requestToSelectCommentPin,ew),eL=(0,K.x5)(eO),eF=i.useMemo(()=>new Set(e.threads.filter(e=>eL(e)).map(e=>e.id)),[eL,e.threads]),eB=i.useCallback(e=>{U(x.wg({threadId:e}));let t=eN(e);t&&V.setHovering(t.canvasPosition)},[V,U,eN]),eU=i.useCallback(e=>{U(x.RP({threadId:e})),V.setHovering(null)},[V,U]),eV=(0,P.$)(),eq=(0,h.am)(),eH=i.useRef(!1);eH.current=eV&&ek;let ez=i.useCallback((e,t)=>ef?()=>Promise.resolve(eg("COMMENT_PIN_CLICK")):async n=>{let o=n||"screen-reader"===l.F.device,i=t.map(e=>e.id);eq("Comment Cluster Clicked",{clusterSize:t.length,commentThreadIds:i});let r=ed({config:m,clusterLocation:e,pins:t,currentViewport:V.getViewportInfo()}),s=V.navigateTo(e,r);el&&el(),await s,eH.current&&o&&q.current?.setSelectedFocusThreadIds(new Set(i))},[m,V,eq,el,ef,eg]),eZ=i.useCallback((e,t)=>{t.preventDefault(),t.stopPropagation();let n=eN(e);if(!n)return;let o=V.getViewportInfo(),i=q.current.getPinViewportRect(n.id),r=(0,I.Z0)(o,i),s={x:r.x+i.height/2,y:r.y-i.width/2,height:0,width:0},a=(0,I.HD)(s,o);U(b.j7({type:y.Z7,data:{thread:n,pinClientRect:a}}))},[U,V,eN]),eG=q.current,eK=(0,I.ni)(),eX=i.useCallback(e=>{if(eG){if("function"!=typeof eG.onViewportUpdate){(0,g.$D)(a.e.WAYFINDING,Error("pinRenderer.onViewportUpdate is not a function"),{extra:{pinRendererProperties:Object.getOwnPropertyNames(eG)}});return}eG.onViewportUpdate(e)}},[eG]);i.useEffect(()=>{t&&eX(V.getViewportInfo())},[eX,t,V]),(0,I.D6)({subscribeToUpdates_expensive:t},eX),i.useEffect(()=>{eG&&(eG.bounds={min:{x:eK.x,y:eK.y},max:{x:eK.x+eK.width,y:eK.y+eK.height}},eG.onElementClicked=eR.onPinClicked,eG.onElementDragEnd=eR.onDragEnd,eG.onElementDragMove=eR.onDragUpdate,eG.onElementDragStart=eR.onDragStart,eG.onElementContextMenu=eZ)},[eZ,eG,eR,eK]);let eW=i.useCallback(e=>{let t;let o=(0,en.c4)(e.comments),i=e.comments.slice(1).reduce((e,t)=>t.isUnread?e+1:e,0);if(e.boundingBoxAnchorCanvasPosition)t=e.boundingBoxAnchorCanvasPosition;else if(e.comments[0].client_meta?.selection_box_anchor&&(t=e.comments[0].client_meta.selection_box_anchor,e.comments[0].client_meta?.in_frame)){let n=e.comments[0].client_meta,o=_.Mi.subtract(t,n);t=_.Mi.add(e.canvasPosition,o)}let r=!!e.isPendingFromSinatra,a={id:e.id,x:e.canvasPosition.x,y:e.canvasPosition.y,isOurs:e.comments[0].user_id===n?.id,pending:r,avatars:o,createdAt:new Date(Date.parse(e.comments[0].created_at)),onMouseEnter:()=>eB(e.id),onMouseLeave:()=>eU(e.id),previewMessageMeta:e.comments[0].message_meta,isUnread:e.comments[0].isUnread||i>0,numUnreadReplies:i,isDraggable:eF.has(e.id)&&!e.boundingBoxAnchorCanvasPosition,isResolved:!!e.comments[0].resolved_at,label:e.comments[0].order_id||"",updatedAt:e.comments[e.comments.length-1].created_at,selectionBoxAnchor:t,otherBoundingBoxes:e.otherBoundingBoxes,numAttachments:e.comments.map(e=>e.attachments?.length||0).reduce((e,t)=>e+t,0),isPinnedToFile:(0,w.U6)()?!!e.commentPin:void 0};return e.sidebarItemType===S.kT.COMMENT_THREAD?{...a,type:S.kT.COMMENT_THREAD}:e.sidebarItemType===S.kT.FEED_POST?{...a,type:S.kT.FEED_POST,feedPostTitle:e.feedPostTitle,pinVerticalStagger:e.pinVerticalStagger}:e.sidebarItemType===S.kT.LITMUS_COMMENT_THREAD?{...a,type:S.kT.LITMUS_COMMENT_THREAD}:void(0,s.xb)(e)},[n,eF,eB,eU]),eQ=i.useMemo(()=>e.threads.reduce((e,t)=>{let{canvasPosition:n}=t;return n&&e.push({...t,canvasPosition:n}),e},[]),[e.threads]),[eJ,eY]=i.useState(new Map),e$=i.useCallback((e,t)=>{eY(n=>new Map(n.set(e,t)))},[]),e0=q.current?.getFocusedClusterId()??null;i.useEffect(()=>{eV&&eY(new Map)},[eV,e0]);let e1=(0,f.ZC)(eQ),e2=eQ!==e1&&void 0!==e1;i.useEffect(()=>{e2&&eY(new Map)},[e2,eQ]);let e4=(0,f.ZC)(eh),[e5,e7]=i.useState(()=>{if(eh)return(0,k.Zz)(e.threads)});i.useEffect(()=>{void 0===e5&&!e4&&eh&&(0,k.Zz)(e.threads)&&e7(!0)},[e4,eh,e.threads,e5]),i.useEffect(()=>{e2&&e5&&(e.threads.some(e=>null!=e.commentPin&&e.comments.some(e=>e.isUnread))||e7(!1))},[e5,e2,e.threads]);let e3=(()=>{let e=(0,P.$)();return i.useCallback((t,n)=>o=>{e&&"Enter"===o.key&&ez(t,n)(!0)},[e])})(),e6=i.useCallback((e,t)=>{let n=new Set(e.map(e=>e.id)),o=ea(t.zoomScale),i=eJ.get(o);if(i){let e=i.map(e=>eu(e,t,u,eW,ez,e3));return new ee.n(e,n,t.zoomScale,e5)}{e$(o,i=(0,O.g)(e,t,m,eV?q.current?.getFocusedClusterId()??null:null));let r=i.map(e=>eu(e,t,u,eW,ez,e3));return new ee.n(r,n,t.zoomScale,e5)}},[eV,eJ,e5,u,eW,ez,e3,m,e$]),e9=i.useCallback(e=>{eA({viewport:V.getViewportInfo(),hasJumped:1===e})},[V]),e8=(0,p.A)(e9,m.rebuildClustersZoomDelay),te=i.useMemo(()=>{let e=e6(eQ,eM.viewport);return e.applyInstant=eM.hasJumped,e},[eQ,eM,e6]);i.useEffect(()=>{let e=eM.viewport.zoomScale;if(Y===e)return;let t=q.current;e>Y&&t&&(t.isZoomingOut=!0);let{width:n,height:o}=V.getViewportInfo();Math.abs(es)/Y>.45||Math.abs(ei)/n>.95||Math.abs(er)/o>.95?e9(1):e8(0)},[V,es,ei,er,m.rebuildClustersZoomDelay,eM.viewport,Y,eG,e8,e9]);let tt=i.useCallback(e=>{ep(null!=e),q.current=e},[]);i.useEffect(()=>{if(q.current){let e=q.current;if(em)e.data={clusters:te,selectedPinId:Q,emphasizedPinIds:J,dimUnselectedPins:!!eE};else{e.wrapperOffsetFn=e=>V.getCommentsWrapperOffset(e);let t=V.getViewportInfo();e.initialViewport=t,e.data={clusters:te,selectedPinId:Q,emphasizedPinIds:J,dimUnselectedPins:!!eE},e.clientConfig=u}}},[V,Q,J,em,te,u,eE]);let tn=!!e.activeThread,to=e.activeThread?(0,en.c4)(e.activeThread.comments).length:1,{setActivePinSize:ti}=e;i.useEffect(()=>{if(!tn){ti(null);return}if(G){let e=$.XC.getPinSize(1);ti({height:e.height,width:e.width});return}ti({width:$.XC.getPinSize(to).width,height:0})},[ti,tn,G,to]);let tr=()=>{let e;if(!q.current)return;let t=q.current.shadowRoot,n=t?.querySelector(`[data-onboarding-key="${F.UU}"]`);if(!n)return;let o=ey?.current?.getBoundingClientRect(),i=o?.height,r=n.getBoundingClientRect(),s=F.V_/2,a=r.top<window.innerHeight/3,l=r.top-10,d=r.top+10;if(i){let t=r.top+10-i;e=a?l:t}else e=d;ev({top:e,left:r.left-F.V_-10,pointerOffset:s,pointerPosition:R.F_.RIGHT_BODY})};i.useEffect(()=>{eC&&tr()},[eC]),i.useEffect(()=>{tr()},[ex]),i.useEffect(()=>{ev(void 0)},[ei,er]);let ts=i.useMemo(()=>{if(e_)return{targetLocation:e_,innerRef:ey,setIsShowingOverlay:eb}},[e_,ey,eb]);return(0,o.jsxs)(eo.p,{children:[eC&&!!ts&&(0,o.jsx)(B.ue,{registrationOrigin:L.iX.NEW_COMMENT,fixedPositionProps:ts}),eV?(0,o.jsx)(W,{clusteredThreads:te,hasActivePin:tn,isCommentsMode:ek,pageId:e.pageId,setClientMeta:e.setClientMeta,setPinRendererRef:tt,onCommentInsertionButtonFocusToggle:eT}):(0,o.jsx)("clustered-pins",{ref:tt})]})}),ep=i.memo(function(e){return(0,o.jsx)(em,{activeThread:e.activeThread,dragDisabledOverride:e.dragDisabledOverride,isCommunity:e.isCommunity,pageId:e.pageId,requestToDeselectCommentPin:e.requestToDeselectCommentPin,requestToSelectCommentPin:e.requestToSelectCommentPin,setActivePinSize:e.setActivePinSize,setClientMeta:e.setClientMeta,threads:e.threads,viewportPositionFromClientPosition:e.viewportPositionFromClientPosition},e.pageId)})},469756:(e,t,n)=>{n.d(t,{n:()=>o});class o{constructor(e,t,n,o){this._cached_all=null,this.applyInstant=!1,this.minimizeUnpinned=!1,this.clusters=e.reduce((e,t)=>(e[t.id]=t,e),{}),this.order=e.map(e=>e.id),this.leafNodes=t;let i={};o&&(this.minimizeUnpinned=!0),e.forEach(e=>{e.pins.forEach(t=>{i[t.id]=e.id})}),this.hierarchy=i,this.zoomScale=n}get length(){return this.order.length}all(){return this._cached_all||(this._cached_all=this.order.map(e=>this.clusters[e])),this._cached_all}getParentOf(e){let t=this.hierarchy[e];return t&&this.clusters[t]||null}getById(e){return this.clusters[e]||null}}},513785:(e,t,n)=>{n.d(t,{J:()=>m,D:()=>u});var o=n(104076),i=n(716976),r=n(903927),s=n(266808);n(120440);var a=n(192075),l=n(208045),d=n(687849),c=n(692042);function u(){let e=(0,r.d4)(e=>e.mirror.appModel.activeCanvasEditModeType===s.m1T.COMMENTS),t=(0,l.$)()&&e;return(0,i.useCallback)(()=>{if(!t)return;let e=document.querySelector("button[data-kb-comment-insertion-button]");e instanceof HTMLElement&&e.focus()},[t])}function m({onNativeEventKeyDown:e,onFocusToggle:t}){let n=i.useRef(null),[r,l]=(0,i.useState)(!1),u=(0,c.i$)(),m=i.useCallback(()=>{l(!0),t?.(!0),requestAnimationFrame(()=>{s.Ez5?.invalidateCanvas()});let e=!1,o=()=>{if(!e){e=!0;return}n.current?.blur()};window.addEventListener("mousemove",o),n.current?.addEventListener("blur",()=>{window.removeEventListener("mousemove",o),l(!1),t?.(!1),s.Ez5?.invalidateCanvas()},{once:!0})},[t]),p=(0,i.useCallback)(t=>{e(t.nativeEvent)},[e]),{className:h,style:f}={className:"xjbqb8w xixxii4 x11lhmoz x1vjfegm"};return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)("button",{ref:n,"aria-label":(0,a.t)("comments.create-comment"),className:h,"data-fullscreen-intercept":!0,"data-kb-comment-insertion-button":!0,onClick:d.VU.get("create-comment","keyboard"),onFocus:m,onKeyDown:p,style:{...f,left:u?`${u.x+9}px`:void 0,top:u?`${u.y+25}px`:void 0},type:"button",children:r&&(0,o.jsx)("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD8AAAA/CAYAAABXXxDfAAAACXBIWXMAABCcAAAQnAEmzTo0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAA2tSURBVHgB7ZtbrFXFGcdnrb0P98NFVJACWqWSakilGlNCW/TRNI0kBE3jA/ahvvRBX5oYHxTjU9WKJkhMX9SkSRMxqC9iQho1EUipRitIgxru5V7u97P3mv5/w3zrzL5xOFdI5EvWWXvdZub/3eb7vpnj3HW6Tj84ytwwkve+oZ8sy8I9zvY8vZe8Hx5n9qJ+u2GgIQWvwZft2biXL1/eto9vvvkme+edd4rnn38+i+/xvbdvmxgRmr/0KBsyRuRukBQBZ+2AGwCAQXfddVcGaI7Dhw9nDz74YIUxfPLJJ/nSpUuzRx55hPFk+p3zG8b0Cr9BUA39DZQGDZ7BIV3OcbAZ11Hi4fzAAw/kABYg7lW2b9+e7927tyIG5Hqenzp1Klu9enU+ZcqU/L777gvP7777btOIcLa2XZMJDYaqbgBkXE/s1dsgkTJAJT0nIPm9997rxo4dm2/btq362muvTX300UcX6pup48eP/1FRFOGbc+fO7REDdq1bt+7fX3zxxf9EhdooxBAY5/XbixnemKGj7M8YMJTmcDngpaq7S5JFe3I766hqwFUNdtSCBQvGfvvtt785fvz4Gz09PXv8FdDFixc3nz59+u+bNm369bRp08bPmTNntBjYJf+AiVTE1ErsJ09NbrBacCVUAo4dht/xOjfQOk/YsmXLb8+ePbsRQMeOHfMff/yxf+qppzySvO222xhpeXDNfZ6/9957DYw4dOjQH+fOndtNu8ZY67MNA4Zn9mpybCVoJPLEE090IZ0ZM2aM++CDD+YL9AYGv2PHjgBo8uTJDWD7Onj/8ccfD99D0oS1GzZsmPfQQw8FLUgZkIAeHvDWgUnawKOCDIQBoaKS0jP1ev0EkgZ0fwB3OowJtHvkyJFnbrrppglRu6r0b+NJmeCGilL7dtG2U+DYJGouJ/USUkK9m9XaRdU2tTaJGn355ZfhPs87fUu70MGDB/9yww03TFSfYzQOHHYDE9wwaEAqdQ46C/atY4IG9DIDe/XVV1sGji3bwK+UeJ/vmtvCy0cGvAwDYLyAjwK8OcLU9gfFhOhBGxwbnaDmANd53NGjR//MgBiY6yCtgdKbb77ZogkpA3Q9Po6jyxhgfsDObhCU2lLp4OgQ5/P1118vbifxe+65p0W1B0q0Q3tp+2+99VZ4Rv/4GqRvTtDFadANgfqnNhSmMjy7pDHmhRde+HGtVtvN4FJvzkBxeENJtJcygP7ol9iBcRBPpNJ3ifr3mwFNHwZO2pSGnaV2nqolv4caeMqAtC98ArRv375Xbrzxxm6kz/g6TIP9A9/0cZ5GbR9++OF8OsYmXaKOQ6XqnahZy1B/psCnn356DjFGmymw/xrgG+f0AJwDdYfLcJvBpJJ47rnn/EhQ6ljpH0ILGRfjM/Cm/pdzfHk74Eka6Ug1OZOBKdzk6FKgsVSRnNu5c2d4R506BSNuJOjJJ590kn74Tf9Kh52A/2HUqFGjp06dmiuJIlsskywoJmAtDGib0upFZ0UGo9mzZ2eknJ999tmvqtXqzPfff798Jm4HBowEAVzBUHn99ttvuzzPJ65Zs2bR/v373XfffRfuKyMs3/Edkp4W8KSGAEeN4RxcvPPOOzOlnZnUvaJU9Oe8l4JHGiNJixYtKn/bOG6++eafdXd3V86fP59LMzHVsnDSoSDSmM/7JE93lyoqVFzc+vXrs4kTJ2a33nprJhX7xVdffeWUpoZvkISmITeShKbRL2PgQP0V8S2Q7VfuuOOOusLlbObMmeFd6gCxMGK+oqQGyQM6VmbCQTEBqV+4cCHbuHFjRYlLdfTo0TN37dpVfjPSwI1ggNGnn35KweSn8vwVVN+IgoqRCTRto53DSz/2KkZ4BTOZVMmdPHkyk73PMkcHXS3wqY9B+pVKZaIqQ11yyBXGi9BWrVpVqn67Nto6PKSOyuM08PKAnTRpUj5u3LhcnXSbykPmeUea0n4j+G5JP9P9DPCYKs/M8SFUqyvad3l8UAYB5uXtozFjxjCfOiUw7syZM+5aJhVRwtilnX7hwoWeaRDVFxZz4oVL7D6Ax8On1VCkzkd4THnPwEk5FHctUbP2yd5PIUCERDySSh48MThqkHzw9u3mwVg5Db+psn7//ffY/fDUyAZAzDhGmoUAvE8CLDRGLw31OGnGj68yjx8rvI2SbybUBGdHPZ1GuCfJe3cNUQoesxT4PZqOa8Qls2bNank/ht8N90zt205zqqE7VF4qFXyCbMpdC9Quzjhw4MA/JXFs2u3Zs8dpSvZogfkuW/1Jw9xS8ilXAB9V3svTlw/wpu4aIC1+lL8XL14czprft3BWqOuVdrPQEaJTm+ttoSNd3Ci9fbPDw1OqQFCCVT49pIuEAyVLZowefvhhJ9Pct2TJkvU2Pp7Lxhu+Axuq75qnOj6yZMYyIXN2OAvNoV5JDY5k0Gt7gyUSmTSbRPLKOdaIARcl9QIs3GeJK/3O1hJd4vDM2wduwBnEi6pgLzi8JsBXVfKANuFAGm84q8q0Gk+vvKPQrFQo+UJrnc3zcfm7ZT2vYZ7vRGo0U4Q3tAsC/SQcnJa0y2urIQjsqhdffHG7HF9d73hVmkqAaG+S2pq3b+vwvHl7VN0KAjg8vD02L44W7iqQATd1x8OrLB5sXar8V517tKRVaEWHMheSL5TeenPa+LBI4draLcFnlww//MYrSmXKl2iUx8aQkSQAAzyd11F3JK9a4jMfffTRYfmkHuxdaWx97dq1ISRH5c3u2QHSLpBrkbyRTRGaNpzy5PBbic2IggdAO+BUclTMXPnYY4/9Q+F3D0VNgDPFuSjZNOXtRAY+y9oYPUGObMppYQDV8wLvRoIMdKrq0IoVK4JZYufz589/RRK/iK0r/qihnUSjTHEaN5IPGxp4P9ne0iB+q+T4tHBpUsdjagGSEpbTVMcOimGxeQAiXYoSlKVSwBAqrjJ5kCbA582b95LU/ILA16XiNUVzBeG36g11U3Xz8hFbwyxhlG7tyGx/DRdsEmKqO3HiBOeqVkcq6nC8wshtK1eu7E6LiMNJ1AcZuBzYqa1bt666//773wC4jppS1x5pZF0qX9u7dy+SJrEJAmKqRvIxsGm7baVUe+cad0/xMR6T666uroIiAZKXam1dtmzZsBYxrEIru3ZaByRk/fzZZ59dAnBJ+zzAda7h5LRYUSd/Z/g4uhS4tWdBXFvwNs+ne+Lw7EhealYyAK+6adOmFTbVDFUJC7VGpQFMu4DGvmVqn6sk/XtVZn+n6/8AXOMEbM/06dNryt3riu6KOAWH6S0mM6XEEwZ0HoBvWo2NjAlLVKyEsCNCgc4UdTR98+bNf5KX/a8fBqJd2fzf3n333WUCM1cMmC1HO0MMmKbrqWL8ZN2bpLGNY1xx7XBU80JlslLTEXXLIn6yvSyUrtkTJ6dXkcpXsHt51i7ZWZdWR3/yS5HGQvIc0l6+t+1lKVPRLKkoz8I1vwlHeReNUlV4n8zp+Ouvv/6vdevWHVU/NT2v0RySRs15Hwcnqde1OsM9j7prlaZOP7fffnsRqzahHhH1/LKRawreu+j0XKzZ8wPwOD3yehigQQK+qukvOELZWUV5vmmKl+fFSWaco63ZWkD4re+xzZIprnf6KewawPHwEyZM8AJbU18FwGGWVJ33Qj1OEveJutNucHgxSWup1adUtYG5S+vwtlQV8l9jgNS9gAHR8QVOixE53BeYuiTCt6yTZdIScgFvxY+U85GznsQjFhs906jUOsQQSFf30ZJ6fB8HW0e6MI3sshk4EufdWKoqNTfu4HB9Sr75OtlNGTK8VPosBu7evTunpI20SXikvnnSVsgGJTEOKiyOM2TX0posVoKRcqHyU1gTALT6gdmUogMDdC7UF16d1NVAB+dGMISjjKG4d73Ji2sX1LSVfEKmpsFW4nIV5azAbTmXXL/rZE5ogWwzOBVs1yebgMj9WT0R0ALmmMrLmYVcmyQpTk/lshPtUSHW2RtokzRL0byPdNM8nToj92CCld9S4P2VfLjnGwsbVEHDe0iUUjYLgVxT0eUMEyKQnEHKgVFKDvc0HXmBygDDwgdhMjEDUygD510jGHDLLbcQVXLOVJryxiRMj3A77tIKcznndD43VXd9OLrLgS8ZAMEE2yIOeO5pECGGjstA4WBhEA2QpFxU0aDe1iDJETmCzp7n+AtFZXzXW1mJQNPfFCIJXizgsgCGvuXgCtuI7HuDmN5wtQ+1bwHvk4TflqqTrd6hFg4TkAKxP4zgPtkfPiFtS/N1uIYxAkow49MSVHzHxWwsEIlUMuhwph8cGwIw8EmsngLv1+7rli3naSHTri1B4LBFP0sZGRj3MQekFJ9TQc0MVASENEOKjMrj8amwQvounC08pU2TNJQANlW38dhYbZoesjJbyyZj1xv9ha2n7hLzqrb/Vr852B0dNiI3H/F5lz3nW9tIbL9jhMZ1xY52UVuioQOuMXT80DftYcna/M+MOUT+4BTNCaGeNg1ByZTUcIYsOEnX0rmOdfamITUI9oqc2uWoz6+bmFBGgcub/nEIdTdHxHVU0/IdA2d2y+8UdFpo7O261+lG35M+HznyrfvaG/bp2TUq6pN9fOl/Rrhk13Z6L23bJVte291zV5HKELjTANP9732d+wLsrlVKIrqGe00Htw3E5RxV87vX6ToNI/0fBC8yxW6pPJwAAAAASUVORK5CYII=",alt:"",width:"30",height:"30"})})})}},531034:(e,t,n)=>{n.d(t,{BK:()=>E,vB:()=>A,x5:()=>P});var o=n(716976),i=n(903927),r=n(466890),s=n(361170),a=n(11395),l=n(814082),d=n(646767),c=n(551037),u=n(229150),m=n(208045),p=n(657687),h=n(709615),f=n(568590),g=n(692042),_=n(211862),v=n(592726),x=n(728977),b=n(977899),C=n(198444),y=n(455401),w=n(292423),j=n(88819),k=n(902141);function P(e){let t=(0,v.TA)(),n=_.q5()?.canEdit;return o.useCallback(o=>!!(!0!==e&&(0,b.b7)(o.sidebarItemType))&&(!!n||o.comments[0].user_id===t),[e,t,n])}function I(e,t){let n=o.useContext(x.kw);return o.useCallback(o=>{let i=e(o.id);if(!i||!i.canvasPosition)return;let r=n.getViewportInfo(),a=(0,g.Z0)(r,i.canvasPosition),l=s.Mi.subtract(a,o.offset);t((0,g.$$)(r,l),i,r)},[e,t,n])}function T(){let e=o.useContext(x.kw);return o.useCallback(t=>{e.setHovering(t)},[e])}function E(e,t,n,s,u,p){let h=o.useContext(x.kw),_=(0,i.wA)(),v=h.getCommentDestinationForCanvasPosition,b=(0,y.fG)(),P=T(),E=I(e,P),A=(0,m.$)(),S=I(e,o.useCallback((e,n)=>{if(n.comments[0]?.client_meta?.selection_box_anchor){let o=b(e,v(e,t)?.nodeId);if(o){let e=(0,r.pV)(n.comments[0].client_meta.selection_box_anchor,o);if(e.x!==n.comments[0].client_meta.selection_box_anchor.x||e.y!==n.comments[0].client_meta.selection_box_anchor.y){let t={...n.comments[0].client_meta};t.selection_box_anchor=e,_(l.hY({thread:n,clientMeta:t}))}}}P(e)},[t,b,v,_,P])),N=I(e,M(t,n)),D=o.useCallback((...e)=>{N(...e),A&&k.iZ?.blurFocusedPin()},[A,N]),O=function(e,t,n){let r=(0,i.wA)(),s=o.useContext(x.kw),u=(0,d.I_)(),m=(0,C.s)(),p=(0,f.Z)("comments_navigate"),h=(0,c.k)(),_=(0,a.WN)();return o.useCallback(o=>{if(h){_("COMMENT_PIN_CLICK");return}let i=e(o);if(i){if(t){if(!i.isPendingFromSinatra&&i.canvasPosition){let e=(0,g.Z0)(s.getViewportInfo(),i.canvasPosition),n=(0,j.c4)(i.comments).length,o=w.XC.getPinSize(n);t(i.id,{x:e.x,y:e.y,width:1.15*o.width,height:1.15*o.height})}}else r(l.bB({receiptsAPI:u.commentReceipts,viewport:s,thread:i,skipDeactivatingExistingActiveComment:n,config:m,navigate:p}))}},[u,r,e,s,t,n,m,p,h,_])}(e,u,p);return o.useMemo(()=>({onDragEnd:D,onPinClicked:O,onDragUpdate:S,onDragStart:E}),[E,D,O,S])}function M(e,t){let n=o.useContext(x.kw),a=(0,i.wA)(),d=n.getCommentDestinationForCanvasPosition,c=(0,y.fG)(),m=(0,y.pC)(),p=(0,y.gu)(),h=n.getValidCommentsRect,f=T();return o.useCallback((n,o,i)=>{let _;let v=(0,g.Z0)(i,n);if(!(0,u.rN)(v,h()))return;if(m(n)){a(l.UU()),p(),f(null);return}let x=d(n,e,!1),b={x:n.x,y:n.y,node_id:x?.nodeId,node_offset:x?.nodeOffset,viewport:i,page_id:e,in_frame:x?.inFrame,selection_box_anchor:o.comments[0].client_meta?.selection_box_anchor,stable_path:x?.stablePath};if(o.comments[0].client_meta?.selection_box_anchor){if(o.comments[0].client_meta.in_frame){let e=o.comments[0].client_meta,t=o.comments[0].client_meta.selection_box_anchor,i=s.Mi.subtract(t,e),r=o.canvasPosition;if(x?.inFrame){let e=s.Mi.subtract(r,n);_=s.Mi.add(s.Mi.add(n,i),e)}else _=s.Mi.add(i,r)}else _=o.comments[0].client_meta?.selection_box_anchor;let e=c(n,x?.nodeId);e&&(_=(0,r.pV)(_,e))}b.selection_box_anchor=_,t({thread:o,clientMeta:b}),f(null)},[e,t,a,d,c,m,p,h,f])}function A(e,t,n){let i=M(t,n),r=o.useContext(x.kw),a=(0,p.MP)();return o.useCallback(t=>{if(a)return!1;let n=e();if(!n?.isSinglePin)return!1;let o=n.cluster.threads[0];return!!o&&(i(s.Mi.add(n,t),o,r.getViewportInfo()),h.Lj.announceCommentPinMoved(t),!0)},[a,e,i,r])}},833536:(e,t,n)=>{n.d(t,{B:()=>tI});var o=n(104076),i=n(716976),r=n(903927),s=n(951002),a=n(689161),l=n(492737),d=n(917360),c=n(812714),u=n(101880),m=n(236631),p=n(192075),h=n(814082),f=n(111297),g=n(30899),_=n(551037),v=n(373235),x=n(74620),b=n(563554),C=n(681947),y=n(455401),w=n(928693),j=n(546547),k=n(873289),P=n(78439),I=n(265149),T=n(72138),E=n(814509),M=n(936031),A=n(674524),S=n(328341),N=n(586398),D=n(750802),O=n(11395),R=n(211862),L=n(592726),F=n(977899),B=n(684742),U=n(307829),V=n(454851),q=n(781767),H=n(889081),z=n(67256),Z=n(349490),G=n(511570),K=n.n(G),X=n(466890),W=n(652539),Q=n(894210),J=n(116553),Y=n(826160),$=n(882726);let ee="comment_avatar_list--avatarListElement--7ghSl",et=i.memo(function(e){let{userId:t,imgUrl:n,handle:r}=e,s=i.useMemo(()=>({id:t,img_url:n,handle:r}),[t,n,r]);return(0,o.jsx)("div",{className:ee,children:(0,o.jsx)(Y.Ro,{size:24,entity:s,className:"comment_avatar_list--commentAvatar--LwAuB"})})});function en(e){let{avatars:t,maxAvatarsShown:n}=e,r=i.useMemo(()=>t.slice(0,n-1),[t,n]),s=t.length===n,a=t.length>e.maxAvatarsShown,l=t[e.maxAvatarsShown-1];return(0,o.jsxs)("div",{className:e.grayscale?"comment_avatar_list--avatarListGrayscale--TQPH8 comment_avatar_list--avatarList--ogW8K":"comment_avatar_list--avatarList--ogW8K",children:[r.map(e=>(0,o.jsx)(et,{userId:e.avatar_user_id,imgUrl:e.avatar_url,handle:e.avatar_user_handle},e.avatar_user_id)),s&&l&&(0,o.jsx)(et,{userId:l.avatar_user_id,imgUrl:l.avatar_url,handle:l.avatar_user_handle},l.avatar_user_id),a&&(0,o.jsx)("div",{className:ee,children:(0,o.jsx)($.f,{size:24,className:"comment_avatar_list--overflowAvatar--6i3DO comment_avatar_list--commentAvatar--LwAuB",text:`${e.avatars.length-e.maxAvatarsShown+1}`})})]})}var eo=n(87535),ei=n(115989),er=n(657687);let es=i.memo(function(e){return(0,o.jsxs)("div",{className:"comment_metadata--commentMetadata---ku0T",children:[(e.orderId||e.parentName&&!e.hideParentName)&&(0,o.jsx)("span",{className:"comment_metadata--parentName--pO-hK text--fontPos11--2LvXf text--_fontBase--QdLsd",children:(0,o.jsx)(el,{parentName:e.parentName||null,orderId:e.orderId,hideParentName:e.hideParentName,thread:e.thread,hideOrphanedState:e.hideOrphanedState})}),(0,o.jsx)(ea,{rootUser:e.rootUser,createdAt:e.createdAt,isPendingFromSinatra:e.isPendingFromSinatra,metaAddon:e.metaAddon})]})});function ea(e){return(0,o.jsxs)("span",{className:"comment_metadata--authorTimeCreated--su-Jn",children:[(0,o.jsx)("div",{className:"comment_metadata--author--FqE-k text--fontPos11--2LvXf text--_fontBase--QdLsd",dir:"auto",children:e.rootUser}),"\xa0",(0,o.jsx)("div",{className:"comment_metadata--timeCreated---00vM text--fontPos11--2LvXf text--_fontBase--QdLsd",children:e.isPendingFromSinatra?(0,p.tx)("comments.in_a_moment"):(0,o.jsx)(ei.h1,{date:e.createdAt,capitalize:!0})}),e.metaAddon]})}function el(e){let t=(0,er.Kq)(e.thread);if(!e.hideOrphanedState&&t){if(e.orderId){let t=(0,p.tx)("comments.unattached");return(0,p.tx)("comments.parent_name_and_number",{parentName:t,commentNumber:e.orderId})}return null}return e.hideParentName||!e.parentName?e.orderId?(0,p.tx)("comments.number_only",{commentNumber:e.orderId}):null:e.orderId?(0,p.tx)("comments.parent_name_and_number",{parentName:e.parentName,commentNumber:e.orderId}):(0,o.jsx)("span",{children:e.parentName})}var ed=n(256384),ec=n(281684),eu=n(381640);let em=(0,eu.nF)((e,t)=>{let{receiptsAPI:n,comment:o}=t;n.markAsUnread(o.uuid).catch(t=>{let n=(0,p.t)("whiteboard.an_error_occurred_while_marking_a_canvas_mention_as_unread");try{t=JSON.parse(t),e.dispatch(ed.s.error((0,ec.J)(t,n)))}catch(t){e.dispatch(ed.s.error(n))}})}),ep=(0,eu.nF)((e,t)=>{let{receiptsAPI:n,thread:o}=t,i=o.comments.map(e=>e.uuid).filter(e=>!!e);n.markAsRead(i).catch(t=>{let n=(0,p.t)("whiteboard.an_error_occurred_while_marking_a_canvas_mention_as_read");try{t=JSON.parse(t),e.dispatch(ed.s.error((0,ec.J)(t,n)))}catch(t){e.dispatch(ed.s.error(n))}})});var eh=n(366535),ef=n(584565),eg=n(646767),e_=n(210793);function ev(e){let{thread:t,isUnread:n,copyLink:s,onDeleteThread:a,onDeleteThreadComplete:l,onDeleteThreadCancel:d}=e,{commentReceipts:c}=(0,eg.I_)(),u=(0,ef.fr)(),m=(0,r.wA)(),f=(0,R.tS)(),g=(0,L.TA)(),_=i.useCallback(()=>{c&&(n?m(h.AY({receiptsAPI:c,thread:t})):m(h.QY({receiptsAPI:c,comment:t.comments[0]})))},[c,m,n,t]),v=i.useCallback(()=>{u&&(n?m(ep({receiptsAPI:u,thread:t})):m(em({receiptsAPI:u,comment:t.comments[0]})))},[u,m,n,t]),x=i.useCallback(()=>{s(t.comments[0])},[s,t]),b=i.useCallback(()=>{m((0,eh.to)({type:e_.E,data:{onConfirm:()=>a(t),onConfirmComplete:l,onCancel:d}}))},[m,a,d,l,t]),C=i.useMemo(()=>{if(g===t.comments[0].user_id&&!t.isCanvasMention&&(0,F.MV)(t.sidebarItemType))return(0,o.jsx)(U.q7,{onClick:b,children:(0,p.tx)("comments.delete_thread")},"deleteThread")},[t,g,b]),y=i.useMemo(()=>{let e=[];return u&&f&&t.isCanvasMention?e.push((0,o.jsx)(U.q7,{onClick:v,children:n?(0,p.tx)("comments.mark_as_read"):(0,p.tx)("comments.mark_as_unread")},"toggleUnreadCanvasMention")):c&&f&&!t.isCanvasMention&&(0,F.m)(t.sidebarItemType)&&e.push((0,o.jsx)(U.q7,{onClick:_,children:n?(0,p.tx)("comments.mark_as_read"):(0,p.tx)("comments.mark_as_unread")},"toggleUnreadComment")),e.push((0,o.jsx)(U.q7,{onClick:x,children:(0,p.tx)("comments.copy_link")},"copyCommentLink")),C&&e.push(C),e},[c,u,f,x,C,t.isCanvasMention,t.sidebarItemType,v,_,n]);return(0,o.jsx)(U.mc,{children:y})}let ex="comments_row_presentation--button--wBibN",eb="comments_row_presentation--headerElement--FStcl",eC="comments_row_presentation--countMetadata--xGPiX";var ey=n(255111),ew=n(452),ej=n(325876),ek=n(214487),eP=n(57544),eI=n(505e3);let eT=i.memo(function(e){return(0,o.jsxs)("div",{className:"comments_row_presentation--replyAndAttachmentCount--OrlJC",children:[0!==e.replyCount&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:eC,children:(0,p.tx)("comments.reply_count",{replyCount:e.replyCount})}),0!==e.attachmentCount&&(0,o.jsx)("div",{className:"comments_row_presentation--dot--9cR30 comments_row_presentation--countMetadata--xGPiX",children:"\xb7"})]}),0!==e.attachmentCount&&(0,o.jsx)("div",{className:eC,children:(0,p.tx)("comments.attachment_count",{attachmentCount:e.attachmentCount})})]})}),eE=i.memo(function(e){return(0,o.jsxs)(o.Fragment,{children:[e.postTitle&&(0,o.jsx)("div",{className:"comments_row_presentation--postTitle--9oNMe",children:e.postTitle}),!(0,X.I)(e.messageMeta)&&(0,o.jsx)(J.HH,{className:"comments_row_presentation--commentMessage--q-YaC text--fontPos11--2LvXf text--_fontBase--QdLsd ellipsis--ellipsisAfter3Lines--h405C ellipsis--_ellipsisAfterNLines--LzI7k comment_message--commentMessage--kZCzD",messageMeta:e.messageMeta,commentId:e.commentId}),(0,o.jsx)(eT,{replyCount:e.replyCount,attachmentCount:e.attachmentCount})]})}),eM=e=>e.stopPropagation(),eA=i.memo(function(e){let{copyLink:t,isPendingFromSinatra:n,optionsMenuRef:i,onDeleteThread:s,onDeleteThreadComplete:a,onDeleteThreadCancel:l,isUnavailable:d,isResolved:c,isUnread:u,onChangeResolveState:m,thread:h,isFocusedThread:f,userCanResolveThread:_,openPostDetailModal:v}=e,x=(0,r.d4)(e=>e.comments.hoveredPinIds),b=e.thread.replyCount||e.thread.comments.length-1,C=e.thread.attachments?.length||e.thread.comments.map(e=>e.attachments?.length||0).reduce((e,t)=>e+t,0)||0,y=e.avatars[0].avatar_user_handle,w=e.hideResolve||!_||n,j=h.sidebarItemType===F.kT.FEED_POST&&!(0,g.y)(),k=(0,o.jsx)(M.HG,{children:(0,o.jsx)(B.E,{"aria-label":(0,p.t)("comments.unavailable_offline"),"data-tooltip-type":Q.Ib.TEXT,"data-tooltip":(0,p.t)("comments.unavailable_offline"),"data-onboarding-key":"page-unavailable-offline",children:(0,o.jsx)("span",{"aria-hidden":"true",children:(0,o.jsx)(W.B,{svg:ey.A})})})}),P=null!=h.commentPin,{manager:I,getTriggerProps:T}=U.b(),E=(0,o.jsxs)(U.bL,{manager:I,children:[(0,o.jsx)(V.d,{"aria-label":(0,p.t)("comments.more_actions"),...T(),children:(0,o.jsx)(q.J,{className:I.isOpen?void 0:ex})}),(0,o.jsx)(ev,{thread:h,isUnread:e.isUnread,copyLink:t,onDeleteThread:s,onDeleteThreadComplete:a,onDeleteThreadCancel:l})]}),A=(0,o.jsx)(eo.K0,{svg:c?ek.A:ej.A,className:K()(c?"comments_row_presentation--resolvedButton--EJTu4 comments_row_presentation--button--wBibN":!P&&ex,e.isUnread?"":"comments_row_presentation--buttonRead--zeH0O"),"data-tooltip-type":Q.Ib.TEXT,"data-tooltip":P?(0,p.t)("comments.pinning.cannot_resolve"):c?(0,p.t)("comments.mark_as_unresolved"):(0,p.t)("comments.mark_as_resolved"),onClick:m,onMouseDown:eM,disabled:P,children:c?(0,o.jsx)(H.g,{}):(0,o.jsx)(z.W,{})}),S=(0,o.jsx)(eo.K0,{svg:eI.A,className:ex,"data-tooltip-type":Q.Ib.TEXT,"data-tooltip":(0,p.t)("fig_feed.view_post"),onClick:v,onMouseDown:eM}),N=(0,o.jsxs)(o.Fragment,{children:[!n&&!j&&(0,o.jsx)(M.HG,{className:eb,ref:i,children:E}),e.thread.sidebarItemType===F.kT.FEED_POST&&(0,o.jsx)(M.HG,{className:eb,ref:i,children:S}),!w&&(0,o.jsx)(M.HG,{className:eb,children:A})]});return(0,o.jsx)("div",{className:K()(h.isActive?"comments_row_presentation--commentSelected--whxrP comments_row_presentation--_comment--x7j04 text--fontPos11--2LvXf text--_fontBase--QdLsd":f||I.isOpen?"comments_row_presentation--commentFocused---7hfS comments_row_presentation--_comment--x7j04 text--fontPos11--2LvXf text--_fontBase--QdLsd":"comments_row_presentation--comment--wtdS- comments_row_presentation--_comment--x7j04 text--fontPos11--2LvXf text--_fontBase--QdLsd",{"comments_row_presentation--unread--xgn7e":u,"comments_row_presentation--pinHovered--k1OJV":x.includes(h.id)}),children:(0,o.jsxs)("div",{className:"comments_row_presentation--commentInner--Eu0xM",children:[(0,o.jsx)("div",{className:"comments_row_presentation--blueDot--n7bLI",children:(0,o.jsx)(Z.H,{})}),(0,o.jsxs)("span",{className:"comments_row_presentation--commentHeader---8DED",children:[e.thread.sidebarItemType===F.kT.FEED_POST&&(0,o.jsx)(W.B,{svg:eP.A,className:"comments_row_presentation--postIcon--VsaAl"}),(0,o.jsx)(en,{maxAvatarsShown:4,avatars:e.avatars,grayscale:!e.isUnread&&e.thread.sidebarItemType!==F.kT.LITMUS_COMMENT_THREAD}),(0,o.jsx)("div",{className:I.isOpen?"comments_row_presentation--buttonsVisible--m7qED comments_row_presentation--buttons--qc-Yn":"comments_row_presentation--buttons--qc-Yn",children:d?k:N})]}),(0,o.jsx)(es,{rootUser:y,createdAt:e.thread.comments[0].created_at,isPendingFromSinatra:n,orderId:e.orderId,parentName:e.parentName,hideParentName:e.hideParentName,thread:e.thread,hideOrphanedState:e.hideOrphanedState,metaAddon:e.metaAddon?.(e.thread)}),e.thread.sidebarItemType===F.kT.FEED_POST&&(0,o.jsxs)("div",{className:"comments_row_presentation--postThumbnailContainer--NjgZy",children:[(0,o.jsx)("img",{src:e.thread.feedPostThumbnail,alt:"placeholder",className:"comments_row_presentation--postThumbnail--SPSS3 feed_post_popover_modal--postThumbnail--jac1E",style:{backgroundColor:e.thread.feedPostThumbnailBackground,padding:e.thread.padFeedPostThumbnail?"8px":"0"}}),e.thread.feedPostNumContent>1&&(0,o.jsx)("div",{className:"comments_row_presentation--numContent--HmWiu comments_row_presentation--postThumbnailOverlay--pPIMf feed_post_popover_modal--postThumbnailOverlay--vDoKP",children:(0,o.jsx)(W.B,{svg:ew.A,className:"comments_row_presentation--overlayIcon--91i3d"})})]}),(0,o.jsx)(eE,{commentId:e.thread.comments[0].id,messageMeta:e.thread.comments[0].message_meta,replyCount:b,attachmentCount:C,postTitle:e.thread.sidebarItemType===F.kT.FEED_POST?e.thread.feedPostTitle:void 0})]})})});var eS=n(266808),eN=n(264993),eD=n(886710),eO=n(76616),eR=n(361170),eL=n(58212),eF=n(50536),eB=n(147046),eU=n(354114),eV=n(568590),eq=n(643077),eH=n(120074),ez=n(248043),eZ=n(944350),eG=n(728977),eK=n(301452),eX=n(198444),eW=n(383310),eQ=n(569565),eJ=n(220812),eY=n(281772);function e$(e){let t=(0,r.d4)(e=>e.mirror.appModel.pagesList);return null===e.page||(0,eH.Fy)(t,e.page)===eS.xal.LOADED}let e0=i.memo(function(e){let{element:t}=e,{comments:n}=t,{getClosestThread:s,onResolveComment:a}=e.extras,l=i.useMemo(()=>{let e=new Map,t=[];return n.forEach(n=>{if(e.has(n.user.id)){let o=e.get(n.user.id);t[o].num_unread_comments+=n.isUnread?1:0,t[o].num_comments+=1}else t.push({avatar_url:n.user.img_url,avatar_user_id:n.user.id,avatar_user_handle:n.user.handle,num_unread_comments:n.isUnread?1:0,num_comments:1}),e.set(n.user.id,t.length-1)}),t},[n]),d=!!n[0].resolved_at,c=n.some(e=>e.isUnread),u=!!t.isPendingFromSinatra,m=i.useRef(null),f=i.useRef(null),g=(0,S.ZC)(t.isActive),v=i.useRef(!1),x=(0,L.iZ)(),b=(0,R.q5)(),w=(0,N.yZ)(),j=e$(t),k=i.useMemo(()=>!w&&!j,[w,j]),P=(0,y.hB)(),I=i.useMemo(()=>P(t),[P,t]),T=t.id,{isFocusedThread:B,onCanvasMentionSelect:U,onCommentFocus:V,onCommentBlur:q,onCommentMouseEnter:H,onCommentMouseLeave:z,onCommentSelect:Z,onChangeResolveState:G,onCanvasMentionCopyLink:K,openPostDetailModal:X}=function(e,t,n){let o=(0,r.wA)(),{comments:s}=e,a=!!s[0]?.resolved_at,l=i.useRef(!1),[d,c]=i.useState(!1),u=e.id,m=!R.q5()?.canEdit,f=(0,r.d4)(e=>e.mirror.appModel.showComments),g=(0,N.yZ)(),_=e$(e),v=i.useContext(eG.kw),x=(0,eX.s)(),b=(0,er.Kq)(e),w=(0,eV.Z)("comments_navigate"),j=!!e.isPendingFromSinatra,k=(0,eg.I_)(),P=(0,ef.fr)(),I=(0,r.Pj)(),T=(0,eW.n0)(),E=(0,eQ.VS)({pagesList:T,isComparingChanges:!1,enabled:!!e.isCanvasMention}),M=(0,eq.dh)(!!e.isCanvasMention),A=i.useCallback(()=>{let t=I.getState().openFile;if(t){let n=(0,ez.jN)({file:t,nodeId:e.nodeId,isFigJam:t.editorType===eZ._Y.WHITEBOARD});o(eF.S({url:n}))}},[o,e.nodeId,I]),S=i.useCallback(()=>g||_?(o(eL.F.dequeue({matchType:"offline-comment-navigation"})),!1):(o(eL.F.enqueue({type:"offline-comment-navigation",message:(0,p.t)("comments.unavailable_offline")})),!0),[g,_,o]),D=i.useCallback(async()=>{if(!S()&&(l.current=!0,o(h.Fm({threadId:u,source:void 0})),e.nodeId||e.stablePath)){let t;let n=I.getState().mirror.sceneGraph;e.isCanvasMention&&P&&o(ep({thread:e,receiptsAPI:P}));let i=eN.x7;e.stablePath?i=`[${e.stablePath.join(",")}]`:e.nodeId&&(i=`[${e.nodeId}]`),e.isCanvasMention&&e.page&&e.page!==M&&(await E(e.page),await (0,eD.yQ)()),eS.glU?.setActiveCommentAnchorData({stablePath:i}),eS.fp8?.markMentionsAsReadFromStablePath(i),e.stablePath?t=n.getFromStablePath(e.stablePath):e.nodeId&&(t=n.get(e.nodeId)),t&&w((0,eY.e)(t,v,"canvas-mentions"),{additionalTrackEventParams:{text_node_id_path:e.nodeId,mention_id:e.uuid}})}},[S,o,u,e,I,P,w,v,E,M]),O=(0,y.Ue)(),L=i.useMemo(()=>{if(O)return O(e)},[O,e]),B=i.useCallback(()=>{if(S())return;l.current=!0,m&&!f&&eU.Y5.triggerAction("toggle-show-comments",{source:"comment_sidebar_list"}),L&&L(),eO.sn.start("view_comment_thread");let n=v.getViewportInfo(),i={thread:e,viewport:v,config:x,navigate:w,isOrphanedComment:b};if(o(j?h.l5(i):h.bB({...i,receiptsAPI:k.commentReceipts})),!b&&!x.disableZoomViewportOnCommentSelection){let o=t(e.id);if(o){let t=eR.Mi.distance(e.canvasPosition,o?.canvasPosition),i=(0,eK.ez)(C.i$,t,n.zoomScale);i>n.zoomScale&&(v.setZoomScale(n.zoomScale,i),v.setCanvasSpaceCenter(e.canvasPosition,n,i))}}},[k.commentReceipts,x,f,o,t,b,j,w,L,S,e,m,v]),U=i.useCallback(()=>{c(!0),o(h.NJ({threadId:u}))},[o,u]),V=i.useCallback(()=>{requestAnimationFrame(()=>{c(!1)}),o(h.Oo({threadId:u}))},[o,u]),q=i.useCallback(()=>{o(h.NJ({threadId:u}))},[o,u]);return{isFocusedThread:d,onCanvasMentionSelect:D,onCommentFocus:U,onCommentBlur:V,onCommentMouseEnter:q,onCommentMouseLeave:i.useCallback(()=>{l.current=!1,o(h.Oo({threadId:u}))},[o,u]),onCommentSelect:B,onChangeResolveState:i.useCallback(e=>{e.stopPropagation(),o(eB.oB()),n&&n(u,!a)},[u,o,n,a]),onCanvasMentionCopyLink:A,openPostDetailModal:i.useCallback(()=>{e.sidebarItemType===F.kT.FEED_POST&&o((0,eh.to)({type:eJ.K,data:{postUuid:e.feedPostPublicUuid,inFileView:!0}}))},[o,e])}}(t,s,a),{scrollableRef:W}=e,{isActive:Q}=t;i.useEffect(()=>{v.current||!Q||g||W.current?.scrollToRow(T)},[Q,T,g,W]);let J=x?.id,Y=i.useMemo(()=>!!(0,F.Vk)(t.sidebarItemType)&&(!(0,F.m)(t.sidebarItemType)||(b&&J?(0,E.To)(t,b,J):null)),[b,J,t]),$=(0,A.rf)(`comment-sidebar-comment-${t.id}`,"click",Z),ee=(0,_.k)(),et=(0,O.WN)();ee&&($=()=>et("SELECT_COMMENT_SIDEBAR")),t.isCanvasMention&&($=U);let en=t.comments.length-1,eo=c?(0,p.t)("comments.aria_label_select_comment_descriptive_unread",{authorString:l[0].avatar_user_handle,contentString:(0,D.F)(t.comments[0].message_meta[0]?.t)??"",replyString:(0,p.t)("comments.reply_count",{replyCount:en})}):(0,p.t)("comments.aria_label_select_comment_descriptive",{authorString:l[0].avatar_user_handle,contentString:(0,D.F)(t.comments[0].message_meta[0]?.t)??"",replyString:(0,p.t)("comments.reply_count",{replyCount:en})}),ei=t.isCanvasMention?K:e.extras.copyLink,es=i.useCallback(()=>{requestAnimationFrame(()=>f.current?.focus())},[]),ea=(0,o.jsx)(eA,{avatars:l,copyLink:ei,hideOrphanedState:e.extras.hideOrphanedState,hideParentName:e.extras.hidePageName,hideResolve:e.extras.hideResolve||!!t.isCanvasMention,isFocusedThread:B,isPendingFromSinatra:u,isResolved:d,isUnavailable:k,isUnread:c,metaAddon:e.extras.metaAddon,onChangeResolveState:G,onDeleteThread:e.extras.onDeleteThread,onDeleteThreadCancel:es,onDeleteThreadComplete:e.extras.onDeleteThreadComplete,openPostDetailModal:X,optionsMenuRef:m,orderId:t.comments[0].order_id||null,parentName:I,thread:t,userCanResolveThread:Y});return(0,o.jsxs)(M.bL,{className:"comments_row_presentation--cardRoot--PjGzu",children:[(0,o.jsx)(M.O6,{ref:f,htmlAttributes:{onBlur:q,onFocus:V,onMouseEnter:H,onMouseLeave:z},className:"comments_row_presentation--cardButton--5hUiX",onClick:$,"aria-label":eo,"aria-expanded":t.isActive}),ea]})}),e1=i.memo(function(e){let{index:t,start:n,measureRef:r}=e.virtualItem,{setSize:s}=e,a=i.useRef(t);i.useEffect(()=>{a.current=t},[t,a]);let l=i.useCallback(e=>{let t=e?.getBoundingClientRect().height;t&&s(a.current,t),r(e)},[a,r,s]);return(0,o.jsx)("div",{ref:l,style:{position:"absolute",top:n,left:0,width:"100%"},children:e.children})});function e2(e){let t=i.useRef(null),{elements:n}=e,r=(0,y.Lc)(),s=i.useRef(n);i.useEffect(()=>{s.current=n},[n]);let a=(0,I.wY)(t),{estimatedSize:l}=e,d=i.useRef(null),c=i.useRef(new Map),u=i.useCallback(e=>0===n.length?0:c.current.get(e)||l,[n,l]),m=i.useCallback((e,t)=>{c.current.set(e,t)},[]),p=(0,P.z)({size:n.length,parentRef:d,estimateSize:u,overscan:10,paddingEnd:r}),h=p.scrollToIndex,f=i.useRef({scrollToRow:t=>{h(n.findIndex(n=>n[e.elementKey]===t))}});return i.useEffect(()=>{f.current={scrollToRow:t=>{h(n.findIndex(n=>n[e.elementKey]===t))}}},[n,h,e.elementKey]),(0,o.jsx)("div",{ref:t,className:"comments_sidebar_list--container--VBa2a",children:(0,o.jsx)(T.P,{className:"comments_sidebar_list--scrollContainer--MKu6f",scrollContainerRef:d,height:a?.height||0,children:(0,o.jsx)("div",{style:{height:`${p.totalSize}px`,width:"100%",position:"relative",marginTop:"var(--spacer-1)"},children:p.virtualItems.map(t=>{let n=e.elements[t.index],i=n[e.elementKey],r=e.row;return(0,o.jsx)(e1,{virtualItem:t,setSize:m,children:(0,o.jsx)(r,{element:n,dataset:s,scrollableRef:f,extras:e.extras})},i)})})})})}let e4=i.memo(function(e){let{onResolveComment:t,hideResolve:n,copyLink:r,hidePageName:s,hideOrphanedState:a,onDeleteThread:l,onDeleteThreadComplete:d,metaAddon:c}=e,u=(0,E.$I)(e.items),m=i.useMemo(()=>({onResolveComment:t,getClosestThread:u,hideResolve:n,copyLink:r,hidePageName:s,hideOrphanedState:a,onDeleteThread:l,onDeleteThreadComplete:d,metaAddon:c}),[t,u,n,r,s,a,l,d,c]);return(0,o.jsx)(e2,{elements:e.items,elementKey:"id",row:e0,estimatedSize:133,extras:m})});var e5=n(446385),e7=n(420680),e3=n(423128),e6=n(80969),e9=n(476816),e8=n(299986),te=n(697157),tt=n(915459);let tn=i.forwardRef((e,t)=>{let{searchInputRef:n,onMouseDown:r,onMouseUp:s,onClearSearchClick:a,onClearSearchKeyDown:l,onBlur:d,onSearchKeyDown:u,onSearchChange:m}=(0,tt.ne)(e,t),h=i.useCallback(e=>{e.stopPropagation(),u(e)},[u]),f=i.useCallback(e=>{"Enter"===e.key&&l(e),e.stopPropagation()},[l]);return(0,o.jsx)("div",{className:"sidebar_search--searchContainer--eU94N",children:(0,c.kc)().a11y_comments_search?(0,o.jsx)(e6.D,{ref:n,"aria-description":(0,p.t)("general.search_will_update"),"aria-label":(0,p.t)("comments.search"),disabled:e.disabled,onChange:e.onChange,onKeyDown:u,placeholder:e.placeholder||(0,p.t)("general.search"),recordingKey:e.recordingKey,spellCheck:!1,value:e.query}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e9.h,{}),(0,o.jsx)(te.L,{ref:n,className:"sidebar_search--searchInput--ySEJ2 text--fontPos11--2LvXf text--_fontBase--QdLsd ellipsis--ellipsis--Tjyfa",onBlur:d,onChange:m,onKeyDown:h,onMouseDown:r,onMouseUp:s,placeholder:e.placeholder||(0,p.t)("search.sidebar_search_placeholder"),spellCheck:!1,value:e.query}),!!e.query&&(0,o.jsx)("button",{className:"sidebar_search--xIcon--1xoiw",onClick:a,onKeyDown:f,"aria-label":(0,p.t)("search.sidebar_search_clear"),children:(0,o.jsx)(e8.L,{})})]})})});tn.displayName="sidebarSearchBar";var to=n(276800),ti=n(129011),tr=n(166887),ts=n(437540),ta=n(422647),tl=n(432099);let td=(0,eu.nF)((e,t)=>{let n=tl.Ay.put(`/api/file/${t.key}/file_followers`,{notification_preference:t.notification_preference}).catch(t=>{let n=t.data?.message||"An error occurred while updating notification preference.";e.dispatch(ed.s.flash(n)),console.error(t)}),o=e.getState().user?.id;t.id?ta.WB()?.optimisticallyUpdate({FileFollower:{[t.id]:{notificationPreference:t.notification_preference}}},n):o&&ta.WB()?.optimisticallyCreate({FileFollower:{[`optimistic-id-${t.key}`]:{key:t.key,userId:o,notificationPreference:t.notification_preference,unreadComments:null,statusChangeNotifs:!1}}},n)});var tc=n(819851),tu=(e=>(e.ALL="all",e.PARTICIPATING="participating",e.NONE="none",e))(tu||{}),tm=n(564941),tp=n(315515);function th(){let e=(0,r.d4)(R.sS),t=(0,L.iZ)(),n=(0,eg.jp)(),s=(0,eg.I_)(),a=(0,ef.fr)(),l=(0,eg.n6)(),d=(0,tc.m0)(),c=(0,r.wA)(),u=(0,r.d4)(e=>e.mirror.appModel.showComments),m=i.useCallback(()=>{eU.Y5.triggerAction("toggle-show-comments",{source:"comments_sidebar_setting"})},[]),f=(0,ts.R)(e=>e.mirror.appModel.keyboardShortcuts),g=(0,tm.c1)(f,"toggle-show-comments"),_=(0,tr.am)();if(i.useEffect(()=>{_("Properties Panel Comments Tab Settings Opened")},[_]),!e||!t)return null;if("loaded"!==n.status)return(0,o.jsx)(U.mc,{children:(0,o.jsx)(U.q7,{disabled:!0,onClick:to.lQ,children:(0,p.tx)("comments.error_loading_notification_preferences")})});let v=n?.data?.notificationPreference||tu.NONE,x=n?.data?.statusChangeNotifs??!1,b=t=>{t!==v&&(c(td({id:n?.data?.id,key:e,notification_preference:t})),_("Comments Notification Preference Changed",{newPreference:t,fileKey:e}))},C=o=>{if(o===x)return;let i=tp.sr.updateStatusChangePreferences({fileKey:e,optIn:o}).catch(e=>{let t=e.data?.message||"An error occurred while updating status change preference.";c(ed.s.flash(t)),console.error(e)});n?.data?.id?ta.WB()?.optimisticallyUpdate({FileFollower:{[n?.data?.id]:{statusChangeNotifs:o}}},i):t?.id&&ta.WB()?.optimisticallyCreate({FileFollower:{[`optimistic-id-${e}`]:{key:e,userId:t.id,notificationPreference:null,unreadComments:null,statusChangeNotifs:o}}},i),_("Dev Mode Notification Preference Changed",{newPreference:o,fileKey:e})};return(0,o.jsxs)(U.mc,{children:[(0,o.jsxs)(ti.H_,{checked:!u,onChange:m,children:[(0,p.tx)("comments.hide_comments"),g&&(0,o.jsx)(U.Ov,{children:(0,o.jsx)(U.ME,{children:(0,o.jsx)(U.rm,{children:g})})})]},"preference"),(0,o.jsx)(U.wv,{}),(0,o.jsxs)(ti.z6,{onChange:e=>b(e),title:(0,o.jsx)(U.hE,{children:(0,p.tx)("comments.comment_notifications")}),value:v,children:[(0,o.jsx)(ti.CU,{value:tu.ALL,children:(0,p.tx)("comments.everything_option")},"notification-all"),(0,o.jsx)(ti.CU,{value:tu.PARTICIPATING,children:(0,p.tx)("comments.just_mentions_and_replies_option")},"notification-participating"),(0,o.jsx)(ti.CU,{value:tu.NONE,children:(0,p.tx)("comments.nothing_option")},"notification-none")]},"comment-notification-title"),d&&(0,o.jsxs)(ti.z6,{title:(0,o.jsx)(U.hE,{children:(0,p.tx)("comments.dev_mode_notifications")}),onChange:e=>C("true"===e),value:x?"true":"false",children:[(0,o.jsx)(ti.CU,{value:"true",children:(0,p.tx)("comments.status_changes")},"notification-dm-status-changes"),(0,o.jsx)(ti.CU,{value:"false",children:(0,p.tx)("comments.nothing_option")},"notification-dm-none")]},"dev-mode-notification-title"),(0,o.jsx)(U.q7,{onClick:()=>{let e=s.commentReceipts;e&&a&&c(h.Tb({commentReceiptsAPI:e,canvasMentionReceiptsAPI:a}))},disabled:0===l,children:(0,p.tx)("comments.mark_all_as_read")},"mark_all_read")]})}var tf=n(104725);let tg="comments_sidebar_header--headerIconButtonSel--3-zXH";function t_(e){let t=(0,r.wA)(),{getTriggerProps:n,manager:s}=U.b(),a=(0,_.k)(),l=(0,O.WN)();(0,tf.Z)(s);let d=(0,S.ZC)(s.isOpen);return(i.useEffect(()=>{if(d!==s.isOpen){if(a)return l("SELECT_COMMENT_SIDEBAR");t(h.UU())}},[t,a,s.isOpen,d,l]),e.hideSettingsDropdown)?null:(0,o.jsxs)(U.bL,{manager:s,children:[(0,o.jsx)(V.d,{...n(),"aria-label":(0,p.t)("comments.settings"),children:(0,o.jsx)(q.J,{className:K()(s.isOpen&&tg)})}),(0,o.jsx)(th,{})]})}var tv=n(343167),tx=n(383262);function tb({activeFilters:e,...t}){let n=(0,r.wA)(),{getTriggerProps:s,manager:a}=U.b(),l=(0,i.useMemo)(()=>{let t=new Set(e);return e.has(e5.mW.RESOLVED)?t.delete(e5.mW.RESOLVED):t.add(e5.mW.RESOLVED),t},[e]),d=t.filters.some(e=>l.has(e)),c="all"!==t.activeMode,u=(d||c)&&!a.isOpen,m=i.useMemo(()=>{let e=[];return t.sorts.length>0&&e.push((0,o.jsx)(ti.z6,{title:(0,o.jsx)(U.r1,{children:(0,p.t)("comments.sort")}),onChange:t.threadManager.setSort,value:t.activeSort,children:t.sorts.map(e=>(0,o.jsx)(ti.CU,{value:e,children:(0,k.L9)(e)},`sort-option-${e}`))},"sort-group")),t.filters.length>0&&e.push((0,o.jsx)(U.YJ,{title:(0,o.jsx)(U.r1,{children:(0,p.t)("comments.filter")}),children:t.filters.map(e=>(0,o.jsx)(ti.H_,{checked:l.has(e),onChange:()=>t.threadManager.toggleFilter(e),disabled:k.vO[t.activeMode].includes(e),children:(0,k.T4)(e)},`filter-option-${e}`))},"filter-group")),t.modes&&t.modes.length>0&&e.push((0,o.jsx)(ti.z6,{title:(0,o.jsx)(U.r1,{children:(0,p.t)("comments.mode")}),onChange:t.threadManager.setMode,value:t.activeMode,children:t.modes.map(e=>(0,o.jsx)(ti.CU,{value:e,children:(0,k.ek)(e)},`mode-option-${e}`))},"mode-group")),e},[t.sorts,t.filters,t.modes,t.activeSort,t.threadManager,t.activeMode,l]),f=(0,S.ZC)(a.isOpen)??!1;return i.useEffect(()=>{f!==a.isOpen&&n(h.UU())},[n,a.isOpen,f]),(0,o.jsxs)(U.bL,{manager:a,children:[(0,o.jsx)(V.d,{...s(),"aria-label":(0,p.t)("comments.sort_filter"),children:(0,o.jsx)(W.B,{className:K()(u?"comments_sidebar_header--sortButtonActive--sPnuw":"comments_sidebar_header--headerIconButton--JiHD6",a.isOpen&&tg),svg:u?tx.A:tv.A})}),(0,o.jsx)(U.mc,{children:m})]})}function tC(e){let t=(0,r.wA)(),n=i.useCallback(()=>{t(h.UU()),e.threadManager.setQuery("")},[t,e.threadManager]),s=i.useCallback(n=>{t(h.UU()),e.threadManager.setQuery(n)},[t,e.threadManager]);return(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)("div",{className:e.stackHeader?"comments_sidebar_header--sidebarHeaderStacked--qkQGM comments_sidebar_header--sidebarHeader--BwT0H text--fontPos11--2LvXf text--_fontBase--QdLsd":"comments_sidebar_header--sidebarHeader--BwT0H text--fontPos11--2LvXf text--_fontBase--QdLsd",children:[(0,o.jsx)(tn,{focusOnMount:!1,query:e.activeQuery||"",clearSearch:n,onChange:s}),(0,o.jsxs)("div",{className:"comments_sidebar_header--sidebarHeaderButtons--XMkx3",children:[(0,o.jsx)(tb,{activeFilters:e.activeFilters,activeMode:e.activeMode,activeSort:e.activeSort,filters:e.filters,modes:e.modes,sorts:e.sorts,threadManager:e.threadManager}),(0,o.jsx)(t_,{hideSettingsDropdown:e.hideSettingsDropdown}),e.onCloseButton&&(0,o.jsx)(e7.K,{"aria-label":(0,p.t)("common.close"),onClick:e.onCloseButton,recordingKey:"threadHeader",children:(0,o.jsx)(e3.A,{})})]})]})})}var ty=n(890611);function tw(e){return(0,o.jsx)("div",{className:"empty_state_message_view--emptyStateWrapper--QSOXE",children:(0,o.jsxs)("div",{className:"empty_state_message_view--emptyStateInner--XVxQ0",children:[(0,o.jsx)(W.B,{className:"empty_state_message_view--commentTool--lg4bm",svg:ty.A}),(0,o.jsx)("div",{className:"empty_state_message_view--emptyStateMessage--3q4Qh",children:e.message})]})})}function tj(e){return e.hasActiveQuery?(0,o.jsx)(tw,{message:(0,c.kc)().a11y_comments_search?(0,o.jsx)(a.T,{role:"alert",children:(0,p.tx)("comments.no_comments_matched_your_search")}):(0,p.tx)("comments.no_comments_matched_your_search")}):({filters:e.filters}).filters.has("yours")?(0,o.jsx)(tw,{message:(0,p.tx)("comments.when_you_leave_a_comment_or_get_mentioned_in_one_it_ll_show_up_here")}):(0,o.jsx)(tw,{message:(0,p.tx)("comments.give_feedback_ask_a_question_or_just_leave_a_note_of_appreciation_click_anywhere_in_the_file_to_leave_a_comment")})}function tk({loadedSidebarItems:e,...t}){let n=(0,x.dH)(),{activeQuery:r,activeFilters:s}=i.useContext(k.hh),a=!r||r&&!e.length,l=e.length,d=(0,v.q)(),c=(0,_.k)();return(0,f.T8)((0,o.jsxs)(o.Fragment,{children:[d&&(0,o.jsx)(j.Mw,{panelName:j.ON.COMMENTS}),a&&!l&&!c&&(0,o.jsx)(tj,{hasActiveQuery:!!r,filters:s,empty:!e.length}),(0,o.jsx)(e4,{items:e,onResolveComment:t.onResolveComment,hideResolve:t.hideResolve,copyLink:t.copyLink,onDeleteThread:t.onDeleteThread,onDeleteThreadComplete:t.onDeleteThreadComplete,hidePageName:t.hidePageName,hideOrphanedState:t.hideOrphanedState})]}),b.e0.COMMENTS_TOOL,{currentTool:n})}let tP=[e5.hJ.COMMENTS_ONLY,e5.hJ.POSTS_ONLY];function tI(e){let t=(0,r.wA)(),{activeQuery:n,activeSort:a,activeMode:c,activeFilters:f,filteredSidebarItems:_,threadManager:v}=i.useContext(k.hh),x=(0,y.Qj)(),b=(0,y.Yo)(),j=(0,y.lM)(),P=i.useMemo(()=>e.sorts&&Array.from(e.sorts)||x,[e.sorts,x]),I=i.useMemo(()=>e.filters&&Array.from(e.filters)||b,[e.filters,b]),T=i.useMemo(()=>(0,g.y)()&&!j?tP:void 0,[j]),E=i.useMemo(()=>"loaded"===_.status&&_.data||[],[_]),M=i.useRef(E);i.useEffect(()=>{M.current=E},[E,M]);let A=i.useCallback((e,n)=>{let o=M.current.find(t=>t.id===e);o&&t(h.hx({thread:o,resolved:n}));let i=(0,k.oS)(f,e5.mW.RESOLVED);n&&!i&&D.current?.focus()},[M,t,f]),S=i.useCallback(e=>{(0,s.B1)(e.comments[0],"thread.comments[0] is null"),t(h.Mv({comment:e.comments[0]}))},[t]),N=i.useCallback(()=>{requestAnimationFrame(()=>D.current?.focus())},[]),D=i.useRef(null),O=e.isShown??!0;i.useEffect(()=>{if(!O)return;let e=D.current;if(!e)return;let t=()=>(e?.focus(),document.activeElement===e);requestAnimationFrame(()=>{t()||setTimeout(t,100)})},[O]);let{disableSidebar:R}=(0,C.Z5)(),L=i.useCallback(()=>{(0,C.uw)({disableSidebar:!1})},[]),F=(0,w.v)(),B=e.copyLinkOverride??F,U=(0,l.U1)(D);return R?(0,o.jsxs)("div",{className:m.s.flex.flexColumn.justifyStart.alignCenter.m8.mt18.$,children:[(0,p.tx)("comments.you_have_disabled_the_comments_sidebar_via_the_debug_menu"),(0,o.jsx)("div",{className:m.s.flex.flexRow.justifyCenter.alignCenter.$,children:(0,o.jsx)("button",{className:m.s.p10.w100.m8.$,style:{backgroundColor:"green",color:"white"},onClick:L,children:(0,p.tx)("comments.re_enable")})})]}):(0,o.jsxs)(d.b,{"aria-label":(0,p.t)("fullscreen.accessibility.comments_sidebar"),className:"comments_sidebar--container--g86FO","data-comments-sidebar":!0,"data-fullscreen-intercept":!0,ref:U,children:[(0,o.jsx)(tC,{activeFilters:f,activeMode:c,activeQuery:n,activeSort:a,filters:I,hideSettingsDropdown:e.hideSettingsDropdown,modes:T,onCloseButton:e.onCloseButton,sorts:P,stackHeader:e.stackHeader,threadManager:v}),(0,o.jsx)(u.x,{className:"comments_sidebar--loading--7fXvY",isLoading:"loading"===_.status,children:()=>(0,o.jsx)(tk,{hidePageName:e.hidePageName,hideOrphanedState:e.hideOrphanedState,onResolveComment:A,copyLink:B,onDeleteThread:S,onDeleteThreadComplete:N,hideResolve:e.hideResolve,loadedSidebarItems:E})})]})}},814509:(e,t,n)=>{n.d(t,{$2:()=>n3,To:()=>n4,$I:()=>n2});var o=n(104076),i=n(716976),r=n(903927),s=n(638004),a=n(812714),l=n(795033),d=n(166887),c=n(361170),u=n(1188),m=n(967782),p=n(228227),h=n(814082),f=n(850701),g=n(646767),_=n(229150),v=n(74620),x=n(120074),b=n(521255),C=n(743484),y=n(211862),w=n(458325),j=n(592726),k=n(209740),P=n(728977),I=n(977899),T=n(299117),E=n(301452),M=n(198444),A=n(873289),S=n(266808),N=n(851824),D=n(147046),O=n(278491),R=n(551037),L=n(692042),F=n(331497),B=n(469756),U=n(681947),V=n(88819),q=n(531034),H=n(766812),z=n(621087),Z=n(483824),G=n(754245),K=n(511570),X=n.n(K),W=n(328341),Q=n(755444),J=n(957501),Y=n.n(J);class ${constructor(e,t,n,o){if(e.pins.length>1&&(this.showClusterCount=!0),!n)return;let i=eo(e,n);if(!i){o||1!==e.pins.length||e.pins[0].isOurs||(this.expandPin=!0);return}let r=i.pins.length>1&&e.pins.length>1?en(i,t):et(i,t);this.initialPosition=r}}class ee{constructor(e,t,n){let o=n.pins.length>1&&e.pins.length>1?en(n,t):et(n,t);this.finalPosition=o}}let et=(e,t)=>({x:e.x+e.x*(t-1),y:e.y+e.y*(t-1)}),en=(e,t)=>({x:e.x+e.x*(t-1)-32,y:e.y+e.y*(t-1)-32}),eo=(e,t)=>{if(1===e.pins.length)return t.getParentOf(e.id);let n=t.getParentOf(e.pins[0].id)||null,o=n?new Set(n.pins.map(e=>e.id)):new Set;return e.pins.every(e=>o.has(e.id))||(n=null),n};var ei=n(944338),er=n(194423),es=n(826160),ea=n(25080),el=n(742521),ed=n(652648),ec=n(535008);let eu=el.ay-1,em=i.memo(function({avatar:e,isInCluster:t,isGhost:n,initiallyHidden:r}){let{src:s,fallbackStyle:a}=(0,i.useMemo)(()=>{let t=(0,es.Sw)(e.avatar_url);if(t)return{src:t};let n=(0,ea.$L)(e.avatar_user_id,ea.us),o=(0,ea.Xx)(n);return{src:t,fallbackStyle:{backgroundColor:n,color:o}}},[e.avatar_url,e.avatar_user_id]),l=e.avatar_user_handle[0];return(0,o.jsx)("div",{className:X()(ec.H,{[ed.my]:t,[ed.v2]:n,[ec.K_]:t}),children:s?(0,o.jsx)("img",{src:s,className:X()(ec.my,!1===r?ec.el:null),draggable:!1,alt:l}):(0,o.jsx)("span",{className:X()(ec.e7,!1===r?ec.el:null),style:a,children:l})})}),ep=i.memo(function({avatars:e,initiallyHidden:t}){let n=e.slice(0,eu),i=e.slice(eu+1),r=e[eu];return(0,o.jsx)("div",{className:ec.dQ,children:(0,o.jsxs)("div",{className:ec.u_,children:[i.length?(0,o.jsx)("div",{className:ec.Ws,children:i.reverse().map(e=>(0,o.jsx)(em,{avatar:e,initiallyHidden:t},e.avatar_user_id))}):null,r?(0,o.jsx)("div",{className:ec.OF,children:(0,o.jsx)(em,{avatar:r,initiallyHidden:t})}):null,n.length?(0,o.jsx)("div",{className:ec.q_,children:n.reverse().map(e=>(0,o.jsx)(em,{avatar:e,initiallyHidden:t},e.avatar_user_id))}):null]})})});function eh(e,t,n,o=!1){if(!t||!(0,ei.x)())return Promise.resolve();let i=`translate3d(${t.x}px, ${t.y}px, 0px) scale(0.2)`;return new Promise((t,r)=>{let s=e.animate([{offset:n,transform:i}],{duration:200});s.onfinish=()=>{o&&(e.style.opacity="0"),t()},s.oncancel=()=>{r()}})}let ef=i.memo(function({cluster:e,selectedState:t,zoomScale:n,animationInfo:r}){let s=(0,i.useMemo)(()=>[...e.avatarMap.values()].sort((e,t)=>e.num_unread_comments>0&&t.num_unread_comments>0?e.num_comments>t.num_comments?-1:1:e.num_unread_comments>0?-1:t.num_unread_comments>0?1:e.num_comments>t.num_comments?-1:1).slice(0,5),[e.avatarMap]),a=1===s.length?s[0]:void 0,l=function(e,t){let n=(t-1)*e.x-32,o=(t-1)*e.y-32;return{x:e.x+n,y:e.y+o}}(e,n),d=(0,i.useRef)(null),c=(0,i.useRef)(null);return(0,i.useEffect)(()=>{if(d.current){if(r instanceof $){let{initialPosition:t,showClusterCount:n}=r;if(d.current.style.opacity="1.0",n&&c.current){var e;(e=c.current)?(e.style.transition="none",e.style.opacity="1",(0,er.G)(e,[],{duration:1e3}).then(()=>{e.style.removeProperty("opacity"),e.style.removeProperty("transition")})):Promise.resolve()}t&&eh(d.current,t,0,!1)}else if(r instanceof ee){let{finalPosition:e}=r;eh(d.current,e,1,!0)}}},[r]),(0,o.jsx)("div",{ref:d,"data-testid":"figma-comment-cluster",role:"button",tabIndex:0,className:X()(ed.Di,{[ed.gy]:e.isUnread,[ed.rX]:t===V.LX.DIMMED}),style:{willChange:"transform",transform:`translate3d(${l.x}px, ${l.y}px, 0px) scale(var(--scale))`,opacity:r instanceof $?0:1,zIndex:r instanceof ee?-1:0},onClick:e.onClick,children:(0,o.jsxs)("div",{className:ed.IS,"data-testid":"avatar-cluster",children:[(0,o.jsxs)("div",{className:ed.u_,children:[a?(0,o.jsx)(em,{avatar:a,isInCluster:!0,isGhost:!0}):null,s.map(e=>(0,o.jsx)(em,{avatar:e,isInCluster:!0},e.avatar_user_id))]}),(0,o.jsx)("div",{ref:c,className:ed.A3,"display-thread-count":e.pins.length})]})})});var eg=n(78468),e_=n.n(eg),ev=n(76616),ex=n(466890),eb=n(641518),eC=n(115989),ey=n(192075),ew=n(354114);let ej=i.memo(function({absoluteBounds:e}){let{width:t,height:n,x:i,y:r}=e;return(0,o.jsx)("div",{className:"selection_box--selectionBox--FNRhk","data-testid":"figma-comment-selection-box",style:{width:t,height:n,left:i,top:r}})}),ek=e=>e.ctrlKey||e.altKey||e.shiftKey||e.metaKey;function eP(e,t){let n=(t-1)*e.x,o=(t-1)*e.y;return{x:e.x+n,y:e.y+o}}function eI(e,t,n,o=!1){if(!t||!(0,ei.x)())return Promise.resolve();let i=`translate3d(${t.x}px, ${t.y}px, 0px) scale(0.2)`;return new Promise((t,r)=>{let s=e.animate([{offset:n,transform:i}],{duration:200});s.onfinish=()=>{o&&(e.style.opacity="0"),t()},s.oncancel=()=>{r()}})}let eT=i.memo(function({pin:e}){let t=(0,i.useMemo)(()=>e_().sanitize((0,ex.sP)(e.previewMessageMeta),{ALLOWED_TAGS:["img","span"],ALLOWED_ATTR:["src","class"],ALLOWED_URI_REGEXP:new RegExp((0,Q.CZ)("emoji/*"))}),[e.previewMessageMeta]),n=(0,i.useMemo)(()=>{let t=e.avatars.reduce((e,t)=>e+t.num_comments,0)-1,n=e.numAttachments,o=!!e.numUnreadReplies&&e.numUnreadReplies!==t,i=t?(0,ey.t)("comments.preview_reply_count",{replyCount:o?e.numUnreadReplies:t,new:o?"true":"false"}):"",r=n?(0,ey.t)("comments.attachment_count",{attachmentCount:n}):"",s="";return""!==i?s=""!==r?`${i} \xb7 ${r}`:i:""!==r&&(s=r),s},[e.avatars,e.numUnreadReplies,e.numAttachments]),r=(0,i.useMemo)(()=>(0,eC.JD)(e.createdAt,"short"),[e.createdAt]);return(0,o.jsxs)("div",{className:ec.$N,children:[(0,o.jsxs)("div",{className:ec.Ud,children:[(0,o.jsx)("div",{className:ec.T7,dir:"auto",children:e.avatars[0].avatar_user_handle}),(0,o.jsx)("div",{className:ec.Zr,children:r})]}),(0,o.jsx)("div",{className:ec.se,dir:"auto",children:t}),(0,o.jsx)("span",{className:ec.V_,children:n})]})});function eE(){return(0,o.jsx)("div",{className:ec.S})}let eM=i.memo(function({pin:e}){let{selectionBoxAnchor:t}=e,n=(0,L.Pl)({subscribeToUpdates_expensive:!!t});if(!t)return null;let i=eP(e,n),r=function(e,t,n){let o=eP(n,t),i=Math.min(e.x,o.x),r=Math.min(e.y,o.y);return{width:Math.max(e.x-i,o.x-i),height:Math.max(e.y-r,o.y-r),x:i,y:r}}(i,n,t);if(!r)return null;let s={x:r.x-i.x,y:r.y-i.y,width:r.width,height:r.height};return(0,o.jsx)(ej,{absoluteBounds:s})}),eA=i.memo(function({pin:e,selectedState:t,onPinClicked:n,onDragEnd:r,onDragUpdate:s,onDragStart:a,onContextMenu:l,animationInfo:d,recordingKey:u,avatarInitiallyHidden:m}){let p=(0,i.useRef)(null),[h,f]=(0,i.useState)(!1),[g,_]=(0,i.useState)(!1),v=eb.rf(u,"click",i.useCallback(()=>{ev.sn.start("view_comment_thread"),n(e.id)},[n,e.id])),{onPointerDown:x,dragOffset:b}=function({ref:e,canDrag:t,onDragStart:n,onDragEnd:o,onDragUpdate:r,onClick:s}){let[a,l]=(0,i.useState)("idle"),[d,u]=(0,i.useState)(!1),[m,p]=(0,i.useState)(null),[h,f]=(0,i.useState)({x:0,y:0}),g=(0,i.useCallback)(t=>{0!==t.button||ek(t)||"idle"!==a||(e.current?.setPointerCapture(t.pointerId),t.stopPropagation(),p({x:t.clientX,y:t.clientY}),l("ready"),u(!1))},[a,e]),_=(0,i.useCallback)(e=>{if(u(!0),"idle"===a||!m||!t)return;let o={x:e.clientX,y:e.clientY},i=c.Mi.subtract(m,o);f(i),"ready"===a?(l("dragging"),n(i)):r(i)},[a,n,r,m,t]),v=(0,i.useCallback)(t=>{"dragging"===a?(e.current?.releasePointerCapture(t.pointerId),t.stopPropagation(),o(h),f({x:0,y:0})):d||s(),l("idle")},[e,a,h,o,s,d]);return(0,i.useEffect)(()=>("idle"!==a&&(document.addEventListener("pointermove",_),document.addEventListener("pointerup",v)),()=>{document.removeEventListener("pointermove",_),document.removeEventListener("pointerup",v)}),[_,v,a]),(0,i.useMemo)(()=>({onPointerDown:g,dragOffset:h}),[g,h])}((0,i.useMemo)(()=>({ref:p,canDrag:e.isDraggable,onDragStart:t=>a({id:e.id,offset:t}),onDragEnd:t=>r({id:e.id,offset:t}),onDragUpdate:t=>s({id:e.id,offset:t}),onClick:v}),[e,a,r,s,v]));(0,i.useEffect)(()=>{let t;return e.pending?t=setTimeout(()=>{_(!0)},500):_(!1),()=>{t&&clearTimeout(t)}},[e.pending]),(0,i.useEffect)(()=>{if(p.current){if(d instanceof $){let{initialPosition:t,expandPin:n}=d;if(t)p.current.style.opacity="1.0",eI(p.current,t,0,!1);else if(n){var e;f(!0),((e=p.current)?(requestAnimationFrame(()=>{e.style.setProperty("--expandAnimationTime","0.4s"),e.classList.add(ec.sz)}),(0,er.G)(e,[],{duration:400,endDelay:3500}).then(()=>{e.classList.remove(ec.sz),e.style.removeProperty("--expandAnimationTime")})):Promise.resolve()).then(()=>{f(!1)})}}else if(d instanceof ee){let{finalPosition:e}=d;eI(p.current,e,1,!0)}}},[d]);let C=eb.BV(u,"pointerover",()=>{f(!0)});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{"data-testid":`figma-comment-pin-${e.id}`,role:"button",tabIndex:0,className:X()(ec.ij,ec.C_,{[ec.wH]:t===V.LX.ACTIVE,[ec.rX]:t===V.LX.DIMMED,[ec.Fm]:e.pending||t===V.LX.ACTIVE,[ec.gy]:e.isUnread}),style:{opacity:d instanceof $&&d.initialPosition?0:1,zIndex:d instanceof ee?-1:void 0,transform:0!==b.x||0!==b.y?`translate3d(${-b.x}px, ${-b.y}px, 0px)`:void 0},onPointerDown:x,onContextMenu:t=>l(e.id,{x:e.x,y:e.y,width:23*Math.min(e.avatars.length,2)+32,height:-32},t.nativeEvent),onPointerOver:C,onPointerOut:()=>{f(!1)},children:(0,o.jsxs)("div",{className:X()(ec.kW,{[ec.tu]:e.avatars.length>1}),children:[g?(0,o.jsx)(eE,{}):(0,o.jsx)(ep,{avatars:e.avatars,initiallyHidden:m}),h&&(0,o.jsx)(eT,{pin:e})]})}),e.selectionBoxAnchor&&h&&(0,o.jsx)(eM,{pin:e})]})}),eS=i.memo(function({x:e,y:t,children:n}){let r=(0,i.useRef)(null),s=i.useContext(P.kw),a=i.useCallback(function(n){let o=r.current;if(o){let i=eP({x:e,y:t},n.zoomScale);o.style.transform=`translate3d(${i.x}px, ${i.y}px, 0px)`}},[e,t]);return(0,i.useLayoutEffect)(()=>(a(s.getViewportInfo()),ew.Y5&&ew.Y5.viewport.on("onSetViewport",a),()=>{ew.Y5&&ew.Y5.viewport.removeListener("onSetViewport",a)}),[a,s]),(0,o.jsx)("div",{style:{willChange:"transform"},ref:r,children:n})}),eN=i.memo(function({pin:e,selectedState:t,onPinClicked:n,onDragEnd:i,onDragUpdate:r,onDragStart:s,onContextMenu:a,animationInfo:l,recordingKey:d,avatarInitiallyHidden:c}){return(0,o.jsx)(eS,{x:e.x,y:e.y,children:(0,o.jsx)(eA,{animationInfo:l,avatarInitiallyHidden:c,onContextMenu:a,onDragEnd:i,onDragStart:s,onDragUpdate:r,onPinClicked:n,pin:e,recordingKey:d,selectedState:t})})});function eD(e){let{children:t}=e,n=(0,i.useRef)(null),[r,s]=(0,i.useState)(null);return(0,i.useEffect)(()=>{if(n.current){let e=n.current.attachShadow({mode:"open"}),t=document.createElement("style");t.nonce=(0,Q.Ay)().csp_nonce,t.textContent=["/** @postcss-export-raw */\n.selection_box--selectionBox--FNRhk {\n  position: absolute;\n  box-sizing: border-box;\n  border: dashed 2px var(--color-border-selected);\n  pointer-events: none;\n}\n","/** @postcss-export-raw */\n",ed.Nz,ec.Nz].join("\n"),e.append(t),s(e)}},[]),(0,o.jsx)("div",{ref:n,"data-testid":"pin-renderer-shadow-dom-container",children:r&&(0,G.createPortal)(t,r)})}function eO({selectedPinId:e,dimUnselectedPins:t,emphasizedPinIds:n,clusteredThreads:r,clientConfig:s,shouldDisablePointerEvents:a,haveCommentsToShow:l,onPinClicked:d,onDragEnd:u,onDragUpdate:m,onDragStart:p,onContextMenu:h,disableFilteringPinsOnViewportChanges:f}){let g=(0,i.useContext)(P.kw),_=(0,L._X)({subscribeToUpdates_expensive:l}),v=(0,i.useMemo)(()=>g.getCommentsWrapperOffset(_),[g,_]),[x,b]=(0,i.useState)(_);_===x||f||b(_);let C=(0,W.ZC)(r),y=(0,i.useMemo)(()=>(function(e,t){let n=e.all();if(!t||0===t.all().length)return n.map(n=>n.pins.length>1?{cluster:n,animationInfo:new $(n,e.zoomScale,t,e.applyInstant)}:{cluster:n,animationInfo:{}});let o=n.reduce((e,t)=>(e.set(t.id,t),e),new Map),i=t.all(),r=i.reduce((e,t)=>(e.set(t.id,t),e),new Map),s=n.map(n=>{let o=r.get(n.id);return o?((0,V.xN)(n,o),{cluster:n,animationInfo:{}}):{cluster:n,animationInfo:new $(n,e.zoomScale,t,e.applyInstant)}}),a=i.filter(e=>!o.has(e.id)),l=Y()(a,t=>{let n=eo(t,e);return n?[{cluster:t,animationInfo:new ee(t,e.zoomScale,n)}]:[]});return l.length>100?s:l.concat(s)})(r,C),[r,C]),w=(0,i.useMemo)(()=>{let e=function(e,t){let n=(0,L.qc)(t),o=(0,L.kE)(78,t.zoomScale),i=(0,c.UI)(n,o);return e.filter(({cluster:e})=>!(e.x<i.x)&&!(e.x>i.x+i.width)&&!(e.y<i.y)&&!(e.y>i.y+i.height))}(y,x);return e.sort((e,t)=>e.cluster.id<t.cluster.id?-1:1),e},[y,x]),j=(0-_.offsetX)*_.zoomScale+v.x,k=(0-_.offsetY)*_.zoomScale+v.y,I={top:`${_.y+_.height/2}px`,left:`${_.x+_.width/2}px`,transform:`translate(${j}px, ${k}px)`};return(0,o.jsx)("div",{className:X()({"pin_renderer--overlay--oZ6wJ":!0,"pin_renderer--overlayPassthrough--IK1LV":_.isPanning||_.isZooming||a}),style:I,"data-testid":"clustered-comments-wrapper","aria-hidden":"true",children:(0,o.jsx)(eD,{children:(0,o.jsx)(o.Fragment,{children:w.map(({cluster:n,animationInfo:r})=>{let s;return s=e?n.pins.find(t=>t.id===e)?V.LX.ACTIVE:V.LX.DIMMED:n.pins.every(e=>e.isResolved)?V.LX.DIMMED:t?V.LX.DIMMED:V.LX.NORMAL,(0,o.jsx)(i.Fragment,{children:1===n.pins.length?(0,o.jsx)(eN,{pin:n.pins[0],recordingKey:`commentPin.${n.pins[0].id}`,selectedState:s,onPinClicked:d,onDragEnd:u,onDragUpdate:m,onDragStart:p,onContextMenu:h,animationInfo:r}):(0,o.jsx)(ef,{cluster:n,selectedState:s,zoomScale:_.zoomScale,animationInfo:r})},n.id)})})})})}var eR=(e=>(e[e.Gradual=0]="Gradual",e[e.Jump=1]="Jump",e))(eR||{});let eL=[S.NLJ.COMMENTS,S.NLJ.SELECT,S.NLJ.SCALE,S.NLJ.HAND,S.NLJ.TYPE],eF=(e,t,n,o)=>{let{threads:i}=e,r=i.map(e=>n(e)),s=i.map(e=>{let t=e.comments[0].client_meta;return t?.in_frame?t.node_id:void 0}),a=new Map;for(let e of r)for(let t of e.avatars)a.has(t.avatar_user_id)?(a.get(t.avatar_user_id).num_unread_comments+=t.num_unread_comments,a.get(t.avatar_user_id).num_comments+=t.num_comments):a.set(t.avatar_user_id,t);return{id:1===i.length?i[0].id:(0,V.Ao)(e,i.length),x:e.x,y:e.y,pins:r,isUnread:r.some(e=>e.isUnread),avatarMap:a,onClick:o(e,r),anchoredNode:s.every(e=>e===s[0])?s[0]:void 0,isPinnedToFile:r.some(e=>e.isPinnedToFile),isSinglePin:1===i.length,cluster:e,onKeyDown:()=>{}}};function eB(e){return{width:23*Math.min(e-1,2)+32,height:32}}let eU=i.memo(function(e){let t=!!e.activeThread||e.threads.length>0,n=(0,j.iZ)(),s=(0,M.s)(),a=(0,U.Z5)(),u=(0,r.wA)(),m=i.useContext(P.kw),p=(0,r.d4)(e=>e.mirror.appModel.currentTool),f=(0,F.ut)(S.Ez5?.editorState().handToolTemporarilyEnabled,!1),g=(0,l.md)(z.R),_=(0,b.BI)(),v=(0,r.d4)(e=>![S.m1T.DESIGN_LAYOUT,S.m1T.WHITEBOARD_LAYOUT,S.m1T.HISTORY,S.m1T.PREVIEW,S.m1T.COMMENTS,S.m1T.DEV_HANDOFF,S.m1T.SITES_LAYOUT].includes(e.mirror.appModel.activeCanvasEditModeType)||e.mirror.appModel.activeUserAction!==S.QOV.DEFAULT)&&(!_||_?.shouldOptimizeForIpadApp&&_?.shouldFadeCommentsDuringEdit),x=e.activeThread?.id===I.hm,C=x?null:e.activeThread?.id||null,y=(0,r.d4)(e=>e.comments.emphasizedPinIds),{zoomScale:w,deltaOffsetX:k,deltaOffsetY:T,deltaZoomScale:A}=(0,L.PD)({subscribeToUpdates_expensive:t}),{requestToDeselectCommentPin:G}=e,[K,X]=i.useState({viewport:m.getViewportInfo(),hasJumped:!1}),W=w<K.viewport.zoomScale,Q=i.useRef(e.threads);i.useEffect(()=>{Q.current=e.threads},[e.threads]);let J=i.useCallback(e=>Q.current?.find(t=>t.id===e)||null,[Q]),Y=(0,r.d4)(e=>e.mirror.appModel.activeUserAction),$=e.dragDisabledOverride||!eL.includes(p),ee=(0,q.BK)(J,e.pageId,e.setClientMeta,$,e.requestToSelectCommentPin,g),et=(0,q.x5)($),en=i.useMemo(()=>new Set(e.threads.filter(e=>et(e)).map(e=>e.id)),[et,e.threads]),eo=i.useCallback(e=>{u(h.wg({threadId:e}));let t=J(e);t&&m.setHovering(t.canvasPosition)},[m,u,J]),ei=i.useCallback(e=>{u(h.RP({threadId:e})),m.setHovering(null)},[m,u]),er=(0,d.am)(),es=i.useCallback((e,t)=>()=>{er("Comment Cluster Clicked",{clusterSize:t.length,commentThreadIds:t.map(e=>e.id)});let n=(0,E.xw)({config:a,clusterLocation:e,pins:t,currentViewport:m.getViewportInfo()});m.navigateTo(e,n),G&&G()},[a,m,er,G]),ea=i.useCallback((e,t,n)=>{n.preventDefault(),n.stopPropagation();let o=J(e);if(!o)return;let i=m.getViewportInfo(),r=(0,L.Z0)(i,t),s={x:r.x+t.height/2,y:r.y-t.width/2,height:0,width:0},a=(0,L.HD)(s,i);u(D.j7({type:O.Z7,data:{thread:o,pinClientRect:a}}))},[u,m,J]),el=i.useCallback(e=>{let t=(0,V.c4)(e.comments),o=e.comments.slice(1).reduce((e,t)=>t.isUnread?e+1:e,0),i=e.comments[0].client_meta?.selection_box_anchor;if(i&&e.comments[0].client_meta?.in_frame){let t=e.comments[0].client_meta,n=c.Mi.subtract(i,t);i=c.Mi.add(e.canvasPosition,n)}let r=!!e.isPendingFromSinatra;return{id:e.id,x:e.canvasPosition.x,y:e.canvasPosition.y,isOurs:e.comments[0].user_id===n?.id,pending:r,avatars:t,createdAt:new Date(Date.parse(e.comments[0].created_at)),onMouseEnter:()=>eo(e.id),onMouseLeave:()=>ei(e.id),previewMessageMeta:e.comments[0].message_meta,isUnread:e.comments[0].isUnread||o>0,numUnreadReplies:o,isDraggable:en.has(e.id)&&!r,isResolved:!!e.comments[0].resolved_at,label:e.comments[0].order_id||"",updatedAt:e.comments[e.comments.length-1].created_at,selectionBoxAnchor:i,type:I.kT.COMMENT_THREAD,numAttachments:e.comments.map(e=>e.attachments?.length||0).reduce((e,t)=>e+t,0),isPinnedToFile:!!e.commentPin}},[n,en,eo,ei]),ed=i.useMemo(()=>e.threads.reduce((e,t)=>{let{canvasPosition:n}=t;return n&&e.push({...t,canvasPosition:n}),e},[]),[e.threads]),ec=i.useCallback(e=>{X({viewport:m.getViewportInfo(),hasJumped:1===e})},[m]),eu=(0,N.A)(ec,a.rebuildClustersZoomDelay),em=i.useMemo(()=>{let e=new Set(ed.map(e=>e.id)),t=K.viewport,n=(0,Z.g)(ed,t,a,null).map(e=>eF(e,t,el,es)),o=new B.n(n,e,t.zoomScale);return o.applyInstant=K.hasJumped,o},[ed,K.viewport,K.hasJumped,a,el,es]);i.useEffect(()=>{if(w===K.viewport.zoomScale)return;let{width:e,height:t}=m.getViewportInfo();Math.abs(A)/w>.45||Math.abs(k)/e>.95||Math.abs(T)/t>.95?ec(1):eu(0)},[m,A,k,T,a.rebuildClustersZoomDelay,K.viewport,w,eu,ec]);let ep=!!e.activeThread,eh=e.activeThread?(0,V.c4)(e.activeThread.comments).length:1,{setActivePinSize:ef}=e;i.useEffect(()=>{if(!ep){ef(null);return}if(x){let e=eB(1);ef({height:e.height,width:e.width});return}ef({width:eB(eh).width,height:0})},[ef,ep,x,eh]);let eg=(0,R.k)();return(0,o.jsx)(H.p,{children:(0,o.jsx)(eO,{clientConfig:s,clusteredThreads:em,dimUnselectedPins:!!v,disableFilteringPinsOnViewportChanges:W,emphasizedPinIds:y,haveCommentsToShow:t,onContextMenu:ea,onDragEnd:ee.onDragEnd,onDragStart:ee.onDragStart,onDragUpdate:ee.onDragUpdate,onPinClicked:ee.onPinClicked,selectedPinId:C,shouldDisablePointerEvents:!eg&&s?.disableCommentsWhenHandToolEnabled&&p===S.NLJ.HAND||f||void 0!==Y&&Y!==S.QOV.DEFAULT})})}),eV=i.memo(function(e){return(0,o.jsx)(eU,{activeThread:e.activeThread,dragDisabledOverride:e.dragDisabledOverride,isCommunity:e.isCommunity,pageId:e.pageId,requestToDeselectCommentPin:e.requestToDeselectCommentPin,requestToSelectCommentPin:e.requestToSelectCommentPin,setActivePinSize:e.setActivePinSize,setClientMeta:e.setClientMeta,threads:e.threads,viewportPositionFromClientPosition:e.viewportPositionFromClientPosition},e.pageId)});var eq=n(548852),eH=n(921996),ez=n(449572),eZ=n(30899),eG=n(252112),eK=n(76404),eX=n(657878),eW=n(615782),eQ=n(59849),eJ=n(951002),eY=n(88314),e$=n(171704),e0=n(827695),e1=n(883765),e2=n(983500),e4=n(653899),e5=n(316862),e7=n(72138),e3=n(366535),e6=n(208045),e9=n(657687),e8=n(662771),te=n(222195),tt=n(406954),tn=n(968169),to=n(894210),ti=n(580868),tr=n(434155),ts=n(902141),ta=n(455401),tl=n(899103),td=n(928693),tc=n(687253),tu=n(841986),tm=n(774583),tp=n(87535),th=n(210793),tf=n(643330),tg=n(686549),t_=n(175100);function tv(e){let{editorRef:t,container:n,initialLocation:r,closeEditor:s}=e,[a,l]=i.useState(null),d=i.useCallback(e=>{l(e.target.value.trim())},[]),u=i.useCallback(()=>(s(),!0),[s]);(0,eK.O1)(u,eK.KD.LINK_TOOLTIP);let m=i.useCallback(e=>{"Enter"===e.key&&(e.preventDefault(),a?t.current?.onSubmitHyperlink(a):t.current?.onRemoveHyperlink(),t.current?.focus(),s())},[s,t,a]),p=i.useCallback(e=>{t.current?.onRemoveHyperlink(),t.current?.focus(),s(),e.stopPropagation()},[s,t]);i.useEffect(()=>{t.current&&l(t.current.getActiveHyperlinkForCurrentSelection())},[t]);let h=i.useMemo(()=>{if(n.current){let e=(0,tg.E)(n.current.getBoundingClientRect()),t=r.left-e.left,o=r.top-e.top;return new c.Mi(t+r.width/2,o)}return null},[n,r.left,r.top,r.width]);return h&&null!==a?(0,o.jsx)(t_.c,{url:a,location:h,onInputChange:d,onInputKeyDown:m,onBlur:()=>{s()},onClickTrash:p}):null}var tx=n(247259),tb=n(417439),tC=n(277770),ty=n(382827),tw=n(679359),tj=n(652539),tk=n(142914),tP=n(407644),tI=n(288747),tT=n(176203),tE=n(303369),tM=n(116553),tA=n(597318),tS=n(220812),tN=n(714843),tD=n(660587),tO=n(211498),tR=n(915516),tL=n(404343),tF=n(691138);let tB="feed_post_popover_modal--overlayIcon--SjGSf";var tU=n(452),tV=n(505e3);let tq=(0,e2.jz)(tL.qoo),tH=(0,e2.jz)(tL.u24),tz=(0,e2.jz)(tL.IuL);function tZ(e){let t=(0,r.d4)(e=>e.comments.activeThread?.source),n=(0,r.d4)(e=>e.comments.activeThread?.id),s=(0,r.d4)(e=>e.comments.threads),a=n&&s[n]||null,l=a?.reply.messageMeta||[],d=(0,r.d4)(e=>e.comments.editingComment),c=(0,tI.sZ)(),{dispatch:u}=e,{threadPosition:m,comments:p}=e.feedPost,f=(0,g.GH)(),v=i.useMemo(()=>f&&"loaded"===f.status&&f.data&&f?.feedApi?.reactionsApi?f.feedApi.reactionsApi.getReactionsForPost(e.feedPost.feedPostPublicUuid):{postReactions:[],commentReactions:{}},[f,e.feedPost.feedPostPublicUuid]),[x,...b]=p,C=(0,r.d4)(e=>"fullscreen"===e.selectedView.view&&e.selectedView.editorType===tT.nT.Whiteboard),[y,w]=(0,td.R)(),{feedPost:j}=e,k=j.id,P=i.useCallback(e=>{u(h.k7({threadId:k,messageMeta:e}))},[u,k]),T=i.useCallback(e=>{u(h.QD({threadId:k,attachmentId:e.id,attachment:e}))},[u,k]),E=i.useCallback((e,t)=>{u(h.QD({threadId:k,attachmentId:e,attachment:null})),t?t.then(()=>tE.J.delete(e)):tE.J.delete(e)},[u,k]),M=i.useCallback(()=>{a&&(u(tP.gX({postUuid:(0,tA.gk)(k),messageMeta:a.reply.messageMeta,attachmentIds:a.reply.attachments?Object.keys(a.reply.attachments):[]})),w(),P([]),u(h.q4({threadId:k,resetStatusOnly:!1})))},[u,k,a,w,P]),A=i.useRef(null),S=i.useCallback(()=>{A.current?.scrollToBottom(),P([])},[A,P]);i.useEffect(()=>{k&&A.current?.scrollToBottom()},[k,A]);let[N,D]=i.useState(!1),O=(0,_.t$)(),R=i.useCallback(()=>{u((0,e3.to)({type:tS.K,data:{postUuid:j.feedPostPublicUuid,inFileView:!0}})),u(h.UU({force:!0}))},[u,j.feedPostPublicUuid]),L=i.useRef(null),F=i.useRef(null),B=e.viewportInfo.height-2*tH;C&&(B-=tz);let U=B-tq,V=!t&&!e.mountUnfocused,q=[...new Set(j.comments.map(e=>e.user.handle))];return c?(0,o.jsxs)(e7.P,{ref:A,maxHeight:U,onMouseDown:e=>e.stopPropagation(),onPointerDown:e=>e.stopPropagation(),width:O,scrollingDisabled:!!e.hyperlinkLocation,allowScrollAndZoomOver:!0,"data-not-draggable":!0,children:[(0,o.jsx)("div",{className:tF.Q,role:"status","aria-live":"polite","aria-atomic":"true",children:y}),(0,o.jsxs)("div",{className:"feed_post_popover_modal--postColumn--2MySW",children:[(0,o.jsx)(tD.B,{date:x.created_at,user:x.user,size:tk.Pf.MEDIUM,shortDate:!1}),(0,o.jsxs)("div",{className:"feed_post_popover_modal--postThumbnailContainer--69nje",onMouseEnter:()=>D(!0),onMouseLeave:()=>D(!1),onClick:R,role:"button",tabIndex:0,children:[(0,o.jsx)("img",{src:j.feedPostThumbnail,alt:"placeholder",className:"feed_post_popover_modal--postThumbnail--jac1E",style:{backgroundColor:j.feedPostThumbnailBackground,padding:j.padFeedPostThumbnail?"8px":"0"}}),j.feedPostNumContent>1&&(0,o.jsx)("div",{className:"feed_post_popover_modal--numContent--S8q68 feed_post_popover_modal--postThumbnailOverlay--vDoKP",children:(0,o.jsx)(tj.B,{svg:tU.A,className:tB})}),N&&(0,o.jsx)("div",{className:"feed_post_popover_modal--expand--cHMgw feed_post_popover_modal--postThumbnailOverlay--vDoKP",children:(0,o.jsx)(tj.B,{svg:tV.A,className:tB})})]}),(0,o.jsxs)("div",{className:"feed_post_popover_modal--subtitleRow--kW-8f",children:[(0,o.jsx)("div",{className:"feed_post_popover_modal--postedToFeed--mHMFC",children:(0,ey.t)("fig_feed.posted_to_feed")})," "]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:"feed_post_popover_modal--postTitle--4GzeH",children:j.feedPostTitle}),(0,o.jsx)(tM.HH,{messageMeta:x.message_meta,commentId:e.feedPost.id,className:"feed_post_popover_modal--postDescription--j6YqM"})]}),(0,o.jsx)("div",{className:"feed_post_popover_modal--reactionSection--cxj-W",children:(0,o.jsx)(tO.Q$,{type:tO.Us.FULL,source:tO.zY.FILE_POPOVER,feedReactions:v.postReactions,postId:x.feed_id,postUuid:e.feedPost.feedPostPublicUuid})})]}),(0,o.jsx)("div",{className:"feed_post_popover_modal--postCommentlist--NUSo7",children:b.map(t=>(0,o.jsx)(tN.i,{attachments:t.attachments,commentId:t.feed_id,commentUser:t.user,commentUuid:t.uuid||"",createdAt:t.created_at,currentOrgId:c.id,mentionables:e.mentionables,messageMeta:t.message_meta,reactions:t.uuid&&v.commentReactions[t.feed_id]||[],user:e.user},t.id))}),e.isLoading&&(0,o.jsx)("div",{className:tR.wG,children:(0,o.jsx)(tw.kt,{size:"small"})}),(0,o.jsx)(tu.K,{allowAttachments:!0,attachments:a?.reply.attachments?Object.values(a.reply.attachments):[],authorNames:q,className:tR.MJ,deleteAttachment:E,dispatch:u,editingExistingComment:!1,editorOnClear:e.editorOnClear,editorOnInsert:e.editorOnInsert,editorRef:L,editorType:"comment-editor-reply",fileKey:e.feedPost.key,hideEmojiPicker:e.hideEmojiPicker,hyperlinkLocation:e.hyperlinkLocation,isDisabled:!!d,isEmojiPickerDisabled:!!e.comments.editingComment,mentionables:e.mentionables,messageMeta:l,mountInputFocused:V,onCancel:e.onCloseEsc,onComposeFocus:e.onComposeFocus,onEditStart:S,onSubmit:M,placeholderText:(0,ey.t)("comments.reply"),recordingKey:I.Dw.feedPopover,replyContainerRef:F,setHyperlinkEditorRef:e.setHyperlinkEditorRef,setHyperlinkLocation:e.setHyperlinkLocation,setIsEditorFocused:e.setIsEditorFocused,submitText:(0,ey.t)("comments.reply"),threadId:k,threadPosition:m,typeahead:e.comments.typeahead,updateAttachment:T,updateMessage:P,user:e.user,viewportPositionFromClientPosition:e.viewportPositionFromClientPosition})]}):null}var tG=n(889081),tK=n(67256),tX=n(769109),tW=n(495896),tQ=n(568590),tJ=n(420680),tY=n(281684),t$=n(58212),t0=n(443192),t1=n(520899),t2=n(111297),t4=n(863154),t5=n(719097),t7=n(796914),t3=n(404778);function t6(e){let t=(0,l.md)(t5.p9),n=(0,l.md)(y.yV),i=(0,t1.kJ)();return(0,tW.yo)({user:t,file:n,numPinnedCommentThreads:i})?i>0?(0,o.jsx)(t8,{id:e.id,commentPin:e.commentPin,numPinnedCommentThreads:i}):(0,o.jsx)(t9,{children:(0,o.jsx)(t8,{id:e.id,commentPin:e.commentPin,numPinnedCommentThreads:i})}):null}function t9(e){return(0,tW.k3)()?e.children:null}function t8(e){let t=!(0,l.md)(t4.wg),{pinApi:n}=(0,g.I_)(),i=(0,r.wA)(),s=!!e.commentPin,a=e.numPinnedCommentThreads>=10;async function d(){try{i(t0.b({has_toggled_comment_pin:!0})),s?await n?.removePin(e.id,e.commentPin.id):await n?.setPin(e.id)}catch(e){if(!e||e?.data?.status===422)return;e?.data?.i18n?i(t$.F.enqueue({message:(0,tY.J)(e,e.data.message),error:!0})):i(t$.F.enqueue({message:(0,ey.YD)("comments.pinning.err.fallback"),error:!0}))}}return(0,o.jsx)(t2.fu,{name:"Pin comment icon",properties:{isPinned:s},children:(0,o.jsx)(tJ.K,{disabled:!s&&a||t,htmlAttributes:{"data-onboarding-key":s?"unpin-comment-icon":"pin-comment-icon","data-testId":"pin-comment-button-thread-header","data-tooltip-type":to.Ib.TEXT,"data-tooltip":s?(0,ey.t)("comments.pinning.unpin_comment"):(0,ey.t)("comments.pinning.pin_comment")},"aria-label":(0,ey.t)("comments.pinning.pin_comment"),onClick:d,recordingKey:"threadHeader.pinCommentButton",children:(0,o.jsx)(tj.B,{svg:s?t3.A:t7.A})})})}var ne=n(784962);function nt(e){let t=i.useRef(null),n=i.useRef(null),s=(0,r.d4)(e=>e.comments.activeThread?.source);i.useEffect(()=>{if(s&&!e.mountUnfocused)switch(s){case I.Eq.prevButton:t.current?.focus();break;case I.Eq.nextButton:n.current?.focus();break;case I.Eq.accessibilityCommentPin:break;default:(0,eJ.xb)(s)}},[e.mountUnfocused,s]),(0,g.I_)(),(0,M.s)(),(0,tQ.Z)("comments_navigate");let a=(0,tW.U6)()&&!!e.thread.commentPin;return(0,o.jsxs)("div",{className:tR.F7,"data-testid":"thread-header-container",children:[(0,o.jsx)("div",{className:tR.xS,"data-onboarding-key":"thread-header-left-section","data-fullscreen-intercept":!0,children:(0,o.jsx)("h2",{children:(0,ey.tx)("comments.comment_n")})}),(0,o.jsxs)("div",{className:tR.eX,children:[e.thread.comments[0]&&(0,o.jsx)(ne.V,{comment:e.thread.comments[0],isUnread:e.thread.comments.some(e=>e.isUnread),label:(0,ey.t)("comments.thread_actions"),recordingKey:"threadHeader.moreActionsButton",thread:e.thread,possibleActions:e.overflowMenuActions,onDelete:e.onDelete,onCopyLink:e.onCopyLink}),(0,o.jsx)(t6,{id:e.thread.id,commentPin:e.thread.commentPin}),!e.hideResolve&&(0,o.jsx)(tp.K0,{disabled:a,"data-fullscreen-intercept":!0,"data-tooltip-type":to.Ib.TEXT,"data-tooltip":e.resolved?a?(0,ey.t)("comments.pinning.cannot_unresolve"):(0,ey.t)("comments.mark_as_unresolved"):a?(0,ey.t)("comments.pinning.cannot_resolve"):(0,ey.t)("comments.mark_as_resolved"),onClick:()=>{e.setResolved({thread:e.thread,resolved:!e.resolved})},recordingKey:"threadHeader.resolveButton",onMouseDown:e=>e.stopPropagation(),className:X()(e.resolved&&tR.aW,a&&tR.VM),children:e.resolved?(0,o.jsx)(tG.g,{}):(0,o.jsx)(tK.W,{})}),e.customIcon,(0,o.jsx)(tX.Jn,{className:tR.UR,recordingKey:"threadHeader",onClick:e.onClose,innerText:(0,ey.t)("comments.close"),"aria-label":(0,ey.t)("comments.close"),"data-fullscreen-intercept":!0})]})]})}var nn=n(249455);let no=(0,e2.hG)(tL.qoo),ni=(0,e2.hG)(tL.u24),nr=(0,e2.jz)(tL.M$q),ns=e=>{e.stopPropagation()},na=[],nl=[],nd=i.memo(e=>{let t=i.useContext(P.kw),n=(0,r.d4)(e=>e.comments.threads)[e.threadId],s=n?.discardAttempts||0,[a,l]=i.useState(0),{positionRef:d,disableCentering:c}=e;i.useEffect(()=>{s<=0||(async()=>{let e=d.current,n=t.getViewportInfo();e&&!c&&await t.navigateTo(e,n.zoomScale,{duration:600,ignoreVisibleTargets:!0}),l(s)})()},[l,d,c,s,t]);let{editorRef:u,editingCommentEditorRef:m}=e,p=i.useCallback(()=>{if(m.current){m.current.selectAll();return}u.current?.selectAll()},[u,m]);return(0,o.jsx)(tm.c,{wiggleCount:a,onWiggle:p,children:e.children})});function nc(e){let t=(0,eX.z3)(),n=(0,r.d4)(e=>e.comments.activeThread?.source),s=(0,r.d4)(e=>e.comments.activeThread?.id),a=(0,r.d4)(e=>e.comments.threads),d=(0,r.d4)(e=>e.comments.showResolved),u=(0,e9.Kq)(e.thread),m=s&&a[s]||null,p=m?.discardAttempts||0,f=m?.reply.messageMeta||na,g=m?.reply.attachments?Object.values(m?.reply.attachments):nl,v=(0,r.d4)(e=>e.comments.editingComment),[x,b]=i.useState(!1),C=(0,l.md)(z.R),[y,w]=i.useState((0,_.t$)()),[j,k]=i.useState(no),P=function(e){let t=i.useRef(e);return i.useEffect(()=>{t.current=e},[t,e]),t}(e.thread.canvasPosition),T=i.useRef(null),{legalLeft:E,legalRight:M,legalBottom:A,useLegalBounds:N}=function(){let e=(0,ty.sO)(),t=(0,F.ut)(S.Ez5?.singleSlideView().isInFocusedNodeView,!1),n=(0,tn.dP)(),o=(0,F.ut)(S.Ez5?.editorPreferences().speakerNotesHeight,0),i=S.Ez5?.singleSlideView().bottomToolbeltHeightInViewport()??0;return e&&t?{legalLeft:n+nr,legalRight:nr,legalBottom:o+i,useLegalBounds:!0}:{legalLeft:0,legalRight:0,legalBottom:0,useLegalBounds:!1}}(),D=i.useRef(!1),O=i.useCallback(n=>{let{x:o,y:i,width:r,height:s}=e.viewportInfo;if("fullscreen"===t&&!n.page)return new c.Mi(o,i);if(!n.threadPosition)return;if(e.useAbsolutePositioning)return new c.Mi(n.threadPosition.x,n.threadPosition.y);let a=n.threadPosition.x+o,l=n.threadPosition.y+i;if(N){let t=E+nr,n=o+r-M-y-nr;a=(0,eY.qE)(a,t,n);let d=T.current?T.current.getBoundingClientRect().height:j,c=e.viewportInfo.y+nr,u=i+s-A-d-nr;!D.current&&T.current&&(D.current=!0,U(null)),l=c>u?c:(0,eY.qE)(l,c,u)}return new c.Mi(a,l)},[t,e.viewportInfo,e.useAbsolutePositioning,N,E,M,A,y,j,nr]),R=(0,ta.Rf)(),L=i.useMemo(()=>{let t=e.viewportInfo.x+nr+R.xDelta,n=e.viewportInfo.y+nr+R.yDelta;return new c.Mi(t,n)},[e.viewportInfo.x,e.viewportInfo.y,R.xDelta,R.yDelta,nr]),[B,U]=i.useState(null),V=i.useMemo(()=>C?L:u?L:O(e.thread)||new c.Mi(0,0),[C,e.thread,u,L,O]),q=(0,W.ZC)(V);(0,i.useLayoutEffect)(()=>{if(B&&!C){let e=q?V.subtract(q):new c.Mi(0,0);e.equals(new c.Mi(0,0))||U(B.add(e))}},[V,B,q,C]);let H=(0,i.useMemo)(()=>B??V,[V,B]),{dispatch:Z,setIsPinned:G}=e,{threadPosition:K,comments:X}=e.thread;(0,e4.h)(()=>{let e=ev.sn.tryStop("view_comment_thread");e&&(0,e1.sx)("view_comment_thread",{elapsedMs:e},{forwardToDatadog:!0})});let Q=(0,te.kc)(),[J,Y]=i.useState(e.thread.comments.length),[$,ee]=i.useState(!1),et="communityHub"===t?Q:e.user,[en,eo]=(0,td.R)(),{submitReply:ei,thread:er}=e,es=er.id,ea=er.uuid,el=i.useCallback(()=>{let e=(0,e5.g)();ev.sn.start(`comment_reply_creation_${e}`),ei({threadId:es,threadUuid:ea??void 0,uuid:e}),eo()},[ei,es,ea,eo]);(0,e4.h)(()=>()=>{X.map(e=>{e.uuid&&e.isPendingFromSinatra&&ev.sn.tryStop(`comment_reply_creation_${e.uuid}`)})});let ed=i.useCallback(e=>{Z(h.k7({threadId:es,messageMeta:e}))},[Z,es]),ec=i.useRef(null),eu=i.useRef(null),em=i.useCallback(e=>{Z(h.QD({threadId:es,attachmentId:e.id,attachment:e}))},[Z,es]),ep=i.useCallback((t,n)=>{Z(h.QD({threadId:es,attachmentId:t,attachment:null})),1===g.length&&ec.current?.focus(),n?n.then(()=>tr.l.delete(e.thread.key,t)):tr.l.delete(e.thread.key,t)},[e.thread.key,Z,es,g.length]),eh=i.useRef(null),ef=i.useCallback(()=>{eh.current?.scrollToBottom(),ed([])},[eh,ed]),{updateCommentContent:eg}=e,e_=i.useCallback((e,t,n)=>{eg({comment:e,messageMeta:t,attachmentUpdates:n})},[eg]),eb=(0,e6.$)(),eC=(0,r.d4)(e=>e.mirror.appModel.activeCanvasEditModeType===S.m1T.COMMENTS),ew=eb&&eC,ej=i.useCallback(()=>{ew?ts.iZ?.focusPinById(es):document.getElementById(`accessibility-comment-pin-${es}`)?.focus()},[ew,es]),{setResolved:ek}=e,eP=i.useCallback(e=>{ek(e),ew&&(d?ts.iZ?.focusPinById(es):(0,e8.MJ)(es))},[ew,d,es,ek]),eI=i.useCallback(e=>{let t="keyboard"===e$.F.device||"screen-reader"===e$.F.device,n=null===e.parent_id;Z((0,e3.to)({type:th.E,data:{comment:e,onConfirm:()=>{Z(h.Mv({comment:e}))},onConfirmComplete:()=>{eb&&t&&requestAnimationFrame(()=>{n&&ew?(0,e8.MJ)(e.id):n||ec.current?.focus()})}}}))},[Z,eb,ew]),eT=i.useCallback(()=>{if(G(!1),ej(),!(0,ex.I)(f)){if(p&&ec.current?.isAllSelected()||(0,ex.Kx)(f)&&0===g.length){ed([]),Z(h.pD());return}return!1}},[ej,G,f,p,g.length,ed,Z]),eE=i.useCallback(()=>{G(!1),Z(h.UU({force:!0})),ej()},[Z,G,ej]),eM=(0,r.d4)(e=>e.universalInsertModal?.pinned===ti.t.PINNED_AND_DOCKED_LEFT),eA=(0,W.ZC)(L),eS=eA&&eA!==L,eN=eA&&H.equals(eA);i.useEffect(()=>{eS&&eN&&(G(!0),U(L))},[L,eS,eN,G]);let eD=H.equals(L),eO=(0,ta.sj)();i.useEffect(()=>{eO&&eD&&eO()},[eD,eO,Z]),i.useEffect(()=>{es&&eh.current?.scrollToBottom()},[es,eh]);let[eR,eL]=i.useState(null),[eF,eB]=i.useState(i.useRef(null)),eU=i.useMemo(()=>function(e){return(0,o.jsx)(nd,{editorRef:ec,editingCommentEditorRef:eu,positionRef:P,threadId:es,disableCentering:"communityHub"===t||"prototype"===t,children:e.children})},[es,P,ec,t]),[eV,eq]=i.useState(!1),[eH,ez]=i.useState(!1),eZ=i.useCallback(e=>{e?.stopPropagation(),G(!0),U(L),b(!0)},[G,L]),{modalRef:eG}=e;i.useEffect(()=>{eG&&(eG.current={popout:()=>eZ()})},[eG,eZ]),(0,tt.C_)(T),i.useEffect(()=>{if(n&&!e.mountUnfocused)switch(n){case I.Eq.accessibilityCommentPin:T.current?.focus();break;case I.Eq.prevButton:case I.Eq.nextButton:break;default:(0,eJ.xb)(n)}},[T,e.mountUnfocused,n]);let eK=i.useRef(null);(0,ta.UR)(tl.b.DOCK_STYLE);let eW=(0,ta.Y6)(),eQ=(0,ta.eW)();return(()=>{if(!H||e.thread.isCanvasMention)return null;let t=(0,_.vl)(e.viewportInfo,e.thread,!0,eQ.paddingRight),i={x:L.x-y,y:0,width:2*y+nr,height:window.innerHeight};eM&&(i.x-=y,i.width+=y);let r=(0,o.jsx)(tp.K0,{svg:nn.A,"data-tooltip-type":to.Ib.TEXT,"data-tooltip":(0,ey.t)("comments.dock_to_side"),recordingKey:"activeThread.dockToSideButton",onClick:eZ,onMouseDown:e=>e.stopPropagation(),"data-fullscreen-intercept":!0}),s=e.viewportInfo.height-2*ni,a=window.innerHeight-e.viewportInfo.y-e.viewportInfo.height+ni,l=e.viewportInfo.x+ni,d=window.innerWidth-e.viewportInfo.x-e.viewportInfo.width+ni;s+=eW.maxHeightDelta,a+=eW.minBottomMarginDelta,l+=eW.minLeftMarginDelta,d+=eW.minRightMarginDelta;let c=s-no,u=e.useAbsolutePositioning?tR.wC:x?tR.xe:tR.wb,m=!n&&!e.mountUnfocused,p=[...new Set(er.comments.map(e=>e.user.handle))];return(0,o.jsxs)(o.Fragment,{children:[$&&(0,o.jsx)(tC.ue,{registrationOrigin:tx.iX.COMMENT_REPLY}),(0,o.jsxs)(tf.od,{allowWheelPassthrough:!0,alwaysEnsureModalOnScreen:!0,autoflowHeight:!0,bounds:i,container:eU,containerClassName:u,dataOnboardingKey:tb.ym,dataTestId:"comment-thread-draggable-modal",disableDragging:e.disableDragging,frameStyle:{boxShadow:"var(--elevation-400-menu-panel, 0px 2px 14px rgba(0, 0, 0, .15), 0 0 0 0.5px rgba(0, 0, 0, .2))",pointerEvents:"auto"},height:j,maxHeight:s,minBottomMargin:a,minLeftMargin:l,minRightMargin:d,minTopMargin:e.viewportInfo.y+ni,onClose:eE,onDragEnd:e=>{ez(!1),G(!0);let t=tf.rk.CALL_ENSURE_MODAL_ON_SCREEN;return U(e),t},onDragStart:()=>{ez(!0),b(!1)},onEnterBound:()=>eq(!0),onLeaveBound:()=>eq(!1),position:H,recordingKey:"activeThreadDraggableModal",setHeight:k,setPosition:U,setWidth:w,shouldScrollToBottom:()=>{let t=J<e.thread.comments.length,n=e.thread.comments[e.thread.comments.length-1].user_id===e.user?.id,o=t&&n;return t&&Y(e.thread.comments.length),o&&ee(!0),o},width:y,children:[eR&&eF&&(0,o.jsx)(tv,{editorRef:eF,container:T,initialLocation:eR,closeEditor:()=>{eL(null)}}),(0,o.jsxs)("div",{ref:T,className:tR.OM,tabIndex:-1,"aria-label":(0,ey.t)("fullscreen.accessibility.comment_thread_label"),role:"region","data-fullscreen-intercept":!0,children:[(0,o.jsx)(nt,{customIcon:!eD&&e.showDockToSideButton?r:void 0,hideResolve:e.hideResolve,mountUnfocused:e.mountUnfocused,nextThread:e.nextThread,onClose:eE,onDelete:eI,prevThread:e.prevThread,resolved:!!X[0].resolved_at,setResolved:eP,thread:t}),er.sidebarItemType===I.kT.COMMENT_THREAD?(0,o.jsxs)(e7.P,{ref:eh,maxHeight:c,onMouseDown:ns,onPointerDown:ns,width:y,scrollingDisabled:!!eR,allowScrollAndZoomOver:!0,"data-not-draggable":!0,children:[(0,o.jsx)("div",{className:tF.Q,role:"status","aria-live":"polite","aria-atomic":"true",children:en}),X.map((n,i)=>(0,o.jsx)(tc.I,{allowAttachments:!0,comment:n,dispatch:Z,editingComment:e.comments.editingComment,editorOnClear:e.editorOnClear,editorOnInsert:e.editorOnInsert,editorRef:eu,editorType:"comment-editor-thread",hideEmojiPicker:e.hideEmojiPicker,hideReactions:e.hideReactions,hideResolve:e.hideResolve,hyperlinkLocation:eR,index:i,mentionables:e.mentionables,mountInputFocused:!0,onDelete:eI,prevAuthor:0===i?null:X[i-1].user_id,setHyperlinkEditorRef:eB,setHyperlinkLocation:eL,setIsEditorFocused:e.setIsEditorFocused,setResolved:eP,showEditedIndicator:!!(e.showEditedIndicators&&n.edited_at),submitEdit:e_,thread:t,threadPosition:t.threadPosition,typeahead:e.comments.typeahead,user:e.user,viewportPositionFromClientPosition:e.viewportPositionFromClientPosition},`thread-comment-${n.id}`)),e.isLoading&&(0,o.jsx)("div",{className:tR.wG,children:(0,o.jsx)(e0.k,{size:"sm"})}),!e.commentCreationDisabled&&(0,o.jsx)(tu.K,{allowAttachments:!0,attachments:g,authorNames:p,className:tR.MJ,deleteAttachment:ep,dispatch:Z,editingExistingComment:!1,editorOnClear:e.editorOnClear,editorOnInsert:e.editorOnInsert,editorRef:ec,editorType:"comment-editor-reply",fileKey:e.thread.key,hideEmojiPicker:e.hideEmojiPicker,hyperlinkLocation:eR,isDisabled:!!v,isEmojiPickerDisabled:!!e.comments.editingComment,mentionables:e.mentionables,messageMeta:f,mountInputFocused:m,onCancel:eT,onComposeFocus:e.onComposeFocus,onEditStart:ef,onSubmit:el,placeholderText:(0,ey.t)("comments.reply"),recordingKey:I.Dw.reply,replyContainerRef:eK,setHyperlinkEditorRef:eB,setHyperlinkLocation:eL,setIsEditorFocused:e.setIsEditorFocused,submitText:(0,ey.t)("comments.reply"),threadId:es,threadPosition:K,typeahead:e.comments.typeahead,updateAttachment:em,updateMessage:ed,user:et,viewportPositionFromClientPosition:e.viewportPositionFromClientPosition})]}):er.sidebarItemType===I.kT.FEED_POST?(0,o.jsx)(tZ,{comments:e.comments,dispatch:Z,editorOnClear:e.editorOnClear,editorOnInsert:e.editorOnInsert,feedPost:er,hideEmojiPicker:e.hideEmojiPicker,hyperlinkLocation:eR,isLoading:e.isLoading,mentionables:e.mentionables,mountUnfocused:e.mountUnfocused,onCloseEsc:eT,onComposeFocus:e.onComposeFocus,setHyperlinkEditorRef:eB,setHyperlinkLocation:eL,setIsEditorFocused:e.setIsEditorFocused,showEditedIndicators:e.showEditedIndicators,user:e.user,viewportInfo:e.viewportInfo,viewportPositionFromClientPosition:e.viewportPositionFromClientPosition}):er.sidebarItemType===I.kT.LITMUS_COMMENT_THREAD?null:void(0,eJ.xb)(er)]})]})]})})()}var nu=n(703630),nm=n(392260);function np(e){return(0,o.jsxs)("svg",{className:"anchor--anchorIcon--e1LTz",viewBox:"0 0 34 41",fill:"none","data-testid":"svg-comment-pin",children:[(0,o.jsx)("path",{fill:e.bodyColor,d:"M17 1C25.8366 1 33 8.16344 33 17C33 23.6257 27.6611 28.9662 17 39.6274C6.33887 28.9663 1.00001 23.6257 1 17C1 8.16344 8.16344 1 17 1Z"}),(0,o.jsx)("path",{fill:e.outlineColor,opacity:"0.4",d:"M17 40.3345L16.6261 39.9606C11.3156 34.6501 7.29362 30.6281 4.60457 27.1037C1.90336 23.5633 0.500006 20.4662 0.5 17C0.5 7.8873 7.8873 0.5 17 0.5C26.1127 0.5 33.5 7.8873 33.5 17C33.5 20.4662 32.0967 23.5633 29.3954 27.1037C26.7064 30.6281 22.6845 34.65 17.374 39.9605L17 40.3345ZM33 17C33 8.16344 25.8366 1 17 1C8.16344 1 1 8.16344 1 17C1.00001 23.552 6.22083 28.8474 16.6464 39.2738C16.7174 39.3447 16.7885 39.4159 16.8599 39.4873C16.9065 39.5339 16.9532 39.5806 17 39.6274C17.1185 39.5089 17.2364 39.391 17.3536 39.2738C27.7792 28.8474 33 23.552 33 17Z"}),e.isNew&&(0,o.jsx)("circle",{cx:"16.5",cy:"16.5",r:"2.25",fill:e.labelColor})]})}let nh={x:0,y:0};function nf(e){let t=(0,r.d4)(e=>e.selectedView),n=(0,j.iZ)(),s=i.useContext(P.kw),a="communityHub"!==t.view||e.thread.comments[0]?.user_id===n?.id,l=(0,r.wA)(),[d,u]=i.useState(null),[m,p]=function(){let e=i.useRef(null),t=i.useCallback(t=>{if(null===t){e.current=null;return}let n=e.current||{};e.current={...n,...t}},[e]);return[e,t]}(),f=i.useRef(e);f.current=e;let{viewportPositionFromClientPosition:g,offset:v}=e,x=i.useCallback(e=>{let t=m.current;if(!t)return;let n=f.current,o=g(new c.Mi(e.clientX,e.clientY)),i=Math.max(t.maxDist,c.Mi.distance(o,t.startPosition));if(p({...t,maxDist:i}),i<_.wB)return;let r=n.computeDropLocation(o,t.mouseOffset);if(!n.isInViewport(r))return;let s=c.Mi.add(o,t.mouseOffset);if(n.thread.id===I.hm){let e=n.viewport.current;if(!e)return;l(h.vV({anchorPosition:(0,L.$$)(e,s)}))}else a&&(l(h.UU()),u(s))},[m,g,p,l,a]),b=i.useCallback(e=>{let t=m.current;if(!t)return;let n=f.current;u(null);let o=g(new c.Mi(e.clientX,e.clientY)),i=n.viewport.current;if(!i)return;if(!(t.maxDist>_.wB)||!a)return p(null);let r=n.computeDropLocation(o,t.mouseOffset);if(!n.isInViewport(r))return p(null);let l=s.getCommentDestinationForCanvasPosition(r,n.pageId);return n.thread.id===I.hm||n.setClientMeta({thread:n.thread,clientMeta:{x:r.x,y:r.y,node_id:l?.nodeId,node_offset:l?.nodeOffset||void 0,viewport:i,page_id:n.pageId,in_frame:l?.inFrame,stable_path:l?.stablePath}}),p(null)},[m,g,a,s,p]),C=i.useCallback(e=>{if(0!==e.button)return;e.stopPropagation();let t=g(new c.Mi(e.clientX,e.clientY));p({startPosition:t,mouseOffset:c.Mi.subtract(v||nh,t),maxDist:0})},[g,p,v]);i.useEffect(()=>(document.addEventListener("pointermove",x),document.addEventListener("pointerup",b),()=>{document.removeEventListener("pointermove",x),document.removeEventListener("pointerup",b)}),[x,b]);let{type:y,resolved:w,active:k}=e,T=i.useCallback(()=>{if("face"===y)return{anchorOutlineColor:"",anchorBodyColor:"",anchorLabelColor:"",anchorClass:"anchor--facePinAnchor--JxEdi"};let e="anchor--anchor--P9sAD";w&&(e="anchor--resolvedAnchor--iU0Ct anchor--anchor--P9sAD");let t=nm.R3,n=nm.Dr;k&&(n="#0d99ff");let o=nm.QQ;return k&&(o=nm.Vm,e+=" anchor--activeAnchor--464Qe anchor--anchor--P9sAD"),{anchorOutlineColor:t,anchorBodyColor:n,anchorLabelColor:o,anchorClass:e}},[y,w,k]),{x:E,y:M}=d||e.offset||nh,A=`translate(${E}px, ${M}px)`,S=T();return(0,o.jsx)("div",{"aria-hidden":!0,style:{transform:A,WebkitTransform:A},className:`${S.anchorClass} ${O.Dm}`,onPointerDown:C,children:"face"===e.type?(0,o.jsx)("div",{className:"anchor--commentPinIcon--6I08n"}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(np,{isNew:e.isNew,bodyColor:S.anchorBodyColor,outlineColor:S.anchorOutlineColor,labelColor:S.anchorLabelColor}),(0,o.jsx)("span",{className:"anchor--anchorLabel--SUXKt",style:{color:S.anchorLabelColor},children:e.label})]})})}function ng(e){let t=(0,nu.H)(e.viewportInfo),n=e.thread,s=i.useContext(P.kw),a=i.useCallback((e,n)=>{let o=c.Mi.add(e,n);return(0,L.$$)(t.current,o)},[t]),l=i.useCallback(e=>{let n=s.getValidCommentsRect(),o=(0,L.Z0)(t.current,e);return(0,_.rN)(o,n)},[s,t]),d=(0,j.iZ)(),u=(0,te.kc)(),m="communityHub"===(0,r.d4)(e=>e.selectedView).view?u:d;return(0,o.jsx)(nf,{active:!0,computeDropLocation:a,entity:m,isInViewport:l,isNew:!0,offset:e.thread.anchorPosition||void 0,pageId:e.pageId,resolved:!1,setClientMeta:e.setClientMeta,thread:n,type:"face",viewport:t,viewportPositionFromClientPosition:e.viewportPositionFromClientPosition})}var n_=n(276800),nv=n(436991),nx=n(498349),nb=n(268389),nC=n(513785),ny=n(633065),nw=n(497463);class nj extends i.PureComponent{constructor(e){super(e),this.onMouseUpPos=e=>{nw.AU("mouseup",this.onMouseUpPos),nw.AU("mousemove",this.onMouseMovePos);let{onDragEnd:t}=this.props,{drag:n}=this.state;if(!n){this.setState({drag:null});return}let o=performance.now()-n.startedAt;t&&t({start:n.start,duration:o,position:e}),this.setState({drag:null})},this.onMouseDownPos=e=>{nw.on("mouseup",this.onMouseUpPos),nw.on("mousemove",this.onMouseMovePos),this.setState({drag:{start:e,startedAt:performance.now()}});let{onDragStart:t}=this.props;t&&t({start:e,position:e,duration:0})},this.onMouseMovePos=e=>{let{onDragUpdate:t}=this.props,{drag:n}=this.state;if(n&&t){let o=performance.now()-n.startedAt;t({start:n.start,duration:o,position:e})}},this.state={drag:null}}componentWillUnmount(){nw.AU("mouseup",this.onMouseUpPos),nw.AU("mousemove",this.onMouseMovePos)}render(){let e=this.state.drag?{pointerEvents:"none"}:void 0;return(0,o.jsx)("div",{role:"button",tabIndex:-1,style:{...e,...this.props.bounds,...this.props.useAbsolute&&{position:"absolute"}},className:"viewport_draggable--container---XH8-","data-forward-events-to-fullscreen":"true",onMouseUp:this.props.onMouseUp,onMouseDown:this.props.onMouseDown,onMouseMove:this.props.onMouseMove,onContextMenu:e=>{ny.eD||(e.stopPropagation(),e.preventDefault())},children:this.props.children})}}let nk={onMouseDownPos:()=>{},onMouseMovePos:()=>{},onMouseUpPos:()=>{}};function nP(e){let t=i.useRef(null),n=function(e){let[t,n]=i.useState(nk);return i.useEffect(()=>{e.current&&n({onMouseDownPos:e.current.onMouseDownPos,onMouseMovePos:e.current.onMouseMovePos,onMouseUpPos:e.current.onMouseUpPos})},[e,n]),function(e){let{onMouseDownPos:t,onMouseMovePos:n,onMouseUpPos:o}=e,r=i.useContext(P.kw),s=i.useCallback((e,t)=>{let n=r.getViewportInfo();return c.Mi.subtract({x:e,y:t},new c.Mi(n.x,n.y))},[r]),a=i.useCallback(e=>s(e.clientX,e.clientY),[s]),l=i.useCallback((e,t)=>{let n=a(e);o&&o(n,t)},[o,a]),d=i.useCallback((e,n)=>{if(e.button&&0!==e.button)return;let o=a(e);t&&t(o,n)},[t,a]),u=i.useCallback((e,t)=>{let o=a(e);n&&n(o,t)},[n,a]);return i.useMemo(()=>({onMouseUp:l,onMouseDown:d,onMouseMove:u}),[l,d,u])}(t)}(t),s=(0,r.d4)(e=>e.selectedView);return(0,o.jsx)(nj,{children:e.children,ref:t,bounds:e.bounds,onDragEnd:e.onDragEnd,onDragStart:e.onDragStart,onDragUpdate:e.onDragUpdate,onMouseDown:n.onMouseDown,onMouseMove:n.onMouseMove,onMouseUp:n.onMouseUp,useAbsolute:"communityHub"===s.view})}var nI=n(902257),nT=n(409757);let nE=(0,e2.hG)(tL.u24),nM=new nT.Z(nE);function nA(e){let{thread:t,viewportBounds:n,onSubmit:s,discardAttempts:l,allowAttachments:d=!0}=e,u=(0,r.wA)(),m=i.useRef(null),p=i.useRef(!1),f=i.useCallback(()=>{m.current&&m.current.scrollIntoView({block:"end"})},[m]),{anchorPosition:g}=t,[v,x]=i.useState(null),[b,C]=i.useState({x:0,y:0}),w=nv.ox(),j=c.Mi.add(g,b,v),k=(0,r.d4)(e=>e.comments.activeDragTarget),P=(0,nT._)(m,j,n,nM,_.hx,e.pinOffset);i.useEffect(()=>{f()},[f]);let T=t.id,E=e.thread.comments.length;i.useEffect(()=>{T!==I.hm&&f()},[f,T,E]);let[M,A]=i.useState(null),S=i.useCallback(e=>{u(h.Z5({messageMeta:e}))},[u]),N=i.useCallback(e=>{u(h.nb({attachmentId:e.id,attachment:e}))},[u]),D=(0,y.tS)(),R=(0,r.Pj)(),L=i.useCallback((t,n)=>{D&&(u(h.nb({attachmentId:t,attachment:null})),0===Object.keys(R.getState().comments.newComment.attachments||{}).length&&e.editorRef.current?.focus(),n?n.then(()=>tr.l.delete(D,t)):tr.l.delete(D,t))},[u,D,R,e.editorRef]),F=(0,nC.D)(),B=i.useCallback(()=>{s(e.thread),p.current&&requestAnimationFrame(()=>{F()})},[s,e.thread,F]),U=i.useCallback(()=>{let t=R.getState().comments.newComment;if((0,ex.I)(t.messageMeta)){p.current&&F();return}(l&&e.editorRef.current?.isAllSelected()||(0,ex.Kx)(t.messageMeta)&&0===Object.keys(t.attachments||{}).length)&&(u(h.Z5({messageMeta:[]})),p.current&&F())},[R,l,e.editorRef,u,F]),V=(0,r.d4)(e=>e.comments.threads),q=V[e.thread.id]?.state===I.EB.BUSY;if(!P)return null;let{x:H,y:z}=P,Z=`translate(${H}px, ${z}px)`,G=`calc(${e.viewportBounds.height}px - (2 * ${nE}px))`,K=!0===e.disablePointerEvents?"new_comment_container--translatedThreadContainerNoPointerEvents--9z1L5 new_comment_container--translatedThreadContainer--2xkOH":`new_comment_container--translatedThreadContainer--2xkOH ${O.Dm}`,X=e.thread.id===I.hm?"new_comment_container--newCommentContainerNext--bCfo7 new_comment_container--threadContainer--XIsVX text--fontPos11--2LvXf text--_fontBase--QdLsd overflow--overflowYAuto--nfK38 overflow--momentumScroll--qtsu7":"new_comment_container--threadContainer--XIsVX text--fontPos11--2LvXf text--_fontBase--QdLsd overflow--overflowYAuto--nfK38 overflow--momentumScroll--qtsu7",W=(0,ey.t)("comments.add_a_comment"),Q=(0,o.jsxs)(o.Fragment,{children:[M&&(0,o.jsx)(tv,{editorRef:e.editorRef,container:m,initialLocation:M,closeEditor:()=>{A(null)}}),(0,o.jsx)("div",{className:`${X} ${k?"new_comment_container--highlighted--wsvS9":""}`,style:{maxHeight:G},ref:m,onFocus:e=>{e.relatedTarget instanceof HTMLElement&&e.relatedTarget.hasAttribute("data-kb-comment-insertion-button")?p.current=!0:p.current=!1},children:(0,o.jsx)(nx.i,{children:(0,o.jsx)(nI.C,{allowAttachments:d,attachments:e.thread.attachments,deleteAttachment:L,dispatch:u,editingExistingComment:!1,editorOnClear:e.editorOnClear,editorOnInsert:e.editorOnInsert,editorRef:e.editorRef,editorType:"comment-editor-new",errorFallback:(0,o.jsx)(nI.e,{type:"new"}),fallback:null,fileKey:D,hideEmojiPicker:e.hideEmojiPicker,hyperlinkLocation:M,isDisabled:q,maxCommentLength:e.maxCommentLength,mentionables:e.mentionables,messageMeta:e.thread.messageMeta,mountInputFocused:!e.mountUnfocused,mountWithButtons:!0,onCancel:U,onComposeFocus:e.onComposeFocus,onSubmit:B,placeholderText:W,recordingKey:I.Dw.new,scrollToBottom:f,setHyperlinkEditorRef:n_.lQ,setHyperlinkLocation:A,setIsEditorFocused:e.setIsEditorFocused,submitText:(0,ey.t)("comments.post"),threadId:I.hm,threadPosition:e.thread.threadPosition,typeahead:e.typeahead,updateAttachment:N,updateMessage:S,user:e.user,viewportPositionFromClientPosition:e.viewportPositionFromClientPosition})})})]}),J={x:H+n.x,y:z};return(0,a.kc)().a11y_new_comments_to_fpl?(w.setPosition({x:J.x,y:J.y}),(0,o.jsx)(nv.bL,{onClose:n_.lQ,className:K,manager:w,children:(0,o.jsx)(tm.c,{wiggleCount:e.discardAttempts||0,onWiggle:e.onDiscardAttempt,children:(0,o.jsx)(nb.vo,{children:Q})})})):(0,o.jsx)(nP,{onDragUpdate:e=>{x(c.Mi.subtract(e.position,e.start))},onDragEnd:e=>{v&&(C(c.Mi.add(v,b)),x(null))},bounds:n,children:(0,o.jsx)("div",{style:{transform:Z,WebkitTransform:Z},className:K,children:(0,o.jsx)(tm.c,{wiggleCount:e.discardAttempts||0,onWiggle:e.onDiscardAttempt,children:Q})})})}function nS(e){let t=(0,r.d4)(e=>e.comments.newComment.discardAttempt),n=i.useRef(null),s=i.useCallback(()=>{n.current?.selectAll()},[n]),a=(0,L.th)(e.viewportInfo);return(0,o.jsxs)("div",{children:[(0,o.jsx)(ng,{thread:e.thread,pageId:e.pageId,viewportInfo:e.viewportInfo,viewportPositionFromClientPosition:e.viewportPositionFromClientPosition,setClientMeta:e.setClientMeta}),!e.hideComposer&&(0,o.jsx)(nA,{allowAttachments:e.allowAttachments,discardAttempts:t,editorOnClear:e.editorOnClear,editorOnInsert:e.editorOnInsert,editorRef:n,hideEmojiPicker:e.hideEmojiPicker,maxCommentLength:e.maxCommentLength,mentionables:e.mentionables,mountUnfocused:e.mountUnfocused,onComposeFocus:e.onComposeFocus,onDiscardAttempt:s,onSubmit:e.onSubmit,pageId:e.pageId,pinOffset:e.pinOffset,setClientMeta:e.setClientMeta,setIsEditorFocused:e.setIsEditorFocused,thread:e.thread,typeahead:e.typeahead,user:e.user,viewportBounds:a,viewportInfo:e.viewportInfo,viewportPositionFromClientPosition:e.viewportPositionFromClientPosition})]})}var nN=n(788965),nD=n(543651),nO=n(366815);let nR="comment_selection_box--selectionBox--bg--z";function nL(e){let t=(0,L.Z0)(e.viewportInfo,e.pinCanvasPosition),n=(0,L.Z0)(e.viewportInfo,e.selectionBoxAnchorCanvasPosition),[r,s]=i.useState(void 0),[a,l]=i.useState(void 0),[d,c]=i.useState(n.x-10),[u,m]=i.useState(n.y-10),[p,h]=i.useState(0),[f,g]=i.useState(0),[_,v]=i.useState(""),x=(0,ta.fG)(),b=i.useCallback(()=>{s({mousePosition:e.selectionBoxAnchorCanvasPosition,startZoomScale:e.viewportInfo.zoomScale}),c(n.x-10-2500),m(n.y-10-2500),h(5e3),g(5e3),v("translate(2500px, 2500px"),l(x(e.pinCanvasPosition,e.nodeId)||void 0)},[e.nodeId,e.pinCanvasPosition,e.selectionBoxAnchorCanvasPosition,e.viewportInfo,n,s,l,c,m,h,g,v,x]),{onSetNewSelectionBoxAnchor:C,viewportPositionFromClientPosition:y}=e,w=i.useCallback(t=>{if(!r)return;let o=nF(t.clientX,t.clientY,y,e.viewportInfo,a);s({mousePosition:o,startZoomScale:r.startZoomScale});let i=(0,L.Z0)(e.viewportInfo,o),l=i.x-n.x+2500,d=i.y-n.y+2500;v(`translate(${l}px, ${d}px)`)},[r,s,v,a,n.x,n.y,y,e.viewportInfo]),j=i.useCallback((e,t)=>{let n=(0,L.Z0)(e,t);s(void 0),l(void 0),c(n.x-10),m(n.y-10),h(0),g(0),v("")},[s,l,c,m,h,g,v]),k=i.useCallback(t=>{if(!r)return;let n=nF(t.clientX,t.clientY,y,e.viewportInfo,a);C(n),j(e.viewportInfo,n)},[r,a,C,y,j,e.viewportInfo]);i.useEffect(()=>{r||(c(n.x-10),m(n.y-10))},[n,r]),i.useEffect(()=>{r&&r.startZoomScale!==e.viewportInfo.zoomScale&&j(e.viewportInfo,e.selectionBoxAnchorCanvasPosition)},[r,e.viewportInfo,e.selectionBoxAnchorCanvasPosition,j]);let P=r?(0,L.Z0)(e.viewportInfo,r.mousePosition):n,I=Math.min(t.x,P.x),T=Math.min(t.y,P.y),E=Math.max(t.x-I,P.x-I),M=Math.max(t.y-T,P.y-T);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:nR,style:{left:I,top:T,width:E,height:M}}),e.canUpdateSelectionBoxAnchor&&(0,o.jsx)(nO.D8,{role:"button",tabIndex:-1,className:"comment_selection_box--selectionBoxAnchor--6twQJ",style:{left:d,top:u,width:p,height:f},onMouseDown:b,onMouseMove:w,onMouseUp:k,dataTestId:"comment-selection-box-anchor",recordingKey:"commentSelectionBox.anchor",children:(0,o.jsx)("div",{className:"comment_selection_box--selectionBoxAnchorIcon--iMwhF",style:{transform:_}})})]})}function nF(e,t,n,o,i){let r=n(new c.Mi(e,t)),s=(0,L.$$)(o,r);if(!i)return new c.Mi(s.x,s.y);let a=(0,ex.pV)(s,i);return new c.Mi(a.x,a.y)}var nB=n(454560);function nU(e){let t=(0,j.Pc)(),n=(0,r.wA)(),i=(0,r.d4)(e=>e.comments.typeahead);return(0,o.jsx)(nS,{dispatch:n,editorOnClear:e.editorOnClear,editorOnInsert:e.editorOnInsert,hideComposer:e.hideComposer,hideEmojiPicker:e.hideEmojiPicker,maxCommentLength:e.maxCommentLength,mentionables:e.mentionables,mountUnfocused:e.mountNewCommentUnfocused,onComposeFocus:e.onComposeFocus,onSubmit:e.submitNewComment,pageId:e.pageId,pinOffset:e.pinOffset,setClientMeta:e.setClientMeta,setIsEditorFocused:e.setIsEditorFocused,thread:e.thread,typeahead:i,user:t,viewportInfo:e.viewportInfo,viewportPositionFromClientPosition:e.viewportPositionFromClientPosition})}function nV({viewportBounds:e,isCommunityMentions:t=!1,children:n,activeDragTarget:i}){return(0,o.jsx)("div",{"data-forward-events-to-fullscreen":!0,className:`${i?"comments_modal--detailsContainerToFront--mQO8y comments_modal--detailsContainer--zHNy9":"comments_modal--detailsContainer--zHNy9"} ${O.Uu}`,style:{...t&&{position:"absolute"},top:e.y,left:e.x,height:e.height,width:e.width},children:n})}function nq(e){let t=(0,r.wA)(),n=(0,L._X)({subscribeToUpdates_expensive:!0}),s=(0,nB._B)(),a=(0,ta.eW)(),l=i.useMemo(()=>(0,_.vl)(n,e.thread,!0,a.paddingRight),[e.thread,n,a.paddingRight]),d=(0,eX._6)(),u="communityHub"===d.view,m=(0,_.eR)(e.thread.id),p=i.useRef(null),f=i.useRef(null),{onClear:g}=s,{submitReply:v,submitNewComment:x}=e,b=i.useCallback(e=>{v(e),g()},[v,g]),C=i.useCallback(()=>{x(),g()},[x,g]),y=(0,r.d4)(e=>e.comments.editingComment),w=(0,r.d4)(e=>e.comments.activeDragTarget),P=(0,nN.i)(),T=i.useCallback(()=>p.current?.visible?(p.current.clearDecorators(),!0):P?((0,nN.Dp)(),!0):!!y||(t(h.UU()),!0),[t,y,P]);(0,eK.O1)(T,eK.KD.MODAL);let{pinOffset:E}=e,M=i.useMemo(()=>{if(!E)return _.hx;let{width:e,height:t}=E;return{x:e+_.hx.x,y:_.hx.y-t}},[E]),A=(0,eZ.y)()&&l.sidebarItemType===I.kT.FEED_POST,S=u?eG.j:(0,k.zW)({feedPostUuid:A?l.feedPostPublicUuid:void 0}),N=i.useCallback(e=>{let t=e.comments[0].client_meta,n=e.comments[0].client_meta.selection_box_anchor,o=c.Mi.subtract(n,t);return c.Mi.add(e.canvasPosition,o)},[]),D=(0,r.d4)(e=>e.comments.newComment),O=i.useCallback(e=>{if(m)t(h.a$({selectionBoxAnchor:e}));else{if(!l.comments[0].client_meta?.selection_box_anchor)return;let n={...l.comments[0].client_meta};if(l.comments[0].client_meta.in_frame){let t=N(l),o=c.Mi.subtract(e,t);n.selection_box_anchor=c.Mi.add(n.selection_box_anchor,o)}else n.selection_box_anchor=e;t(h.hY({thread:l,clientMeta:n}))}},[t,l,m,N]),R="communityHub"===d.view,F=(0,j.TA)(),B=(0,j.Pc)(),U=(0,r.d4)(e=>e.comments),V="communityHub"===d.view,q=i.useMemo(()=>"communityHub"===d.view&&"hubFile"===d.subView&&(0,eW.t0)(d.fullscreenState),[d]),H=null;m?H=D.selectionBoxAnchor:l.comments[0].client_meta?.selection_box_anchor&&(l.comments[0].client_meta?.in_frame,H=l.selectionAnchorCanvasPosition??l.boundingBoxAnchorCanvasPosition??null);let z=!!(0,ez.Rs)((0,eQ.dDF)(m?null:{key:e.thread.key})).unwrapOr(!1),Z=F===l.comments[0]?.user_id;return null===n?null:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:`comments_modal--overlay--1hWXV ${w?"comments_modal--dimBackground--Vyo3f":""}`}),(0,o.jsxs)(nV,{viewportBounds:n,isCommunityMentions:u,activeDragTarget:w,children:[l.canvasPosition&&H&&(0,o.jsx)(nL,{nodeId:l.comments[0]?.client_meta?.node_id,selectionBoxAnchorCanvasPosition:H,pinCanvasPosition:l.canvasPosition,viewportInfo:n,onSetNewSelectionBoxAnchor:O,viewportPositionFromClientPosition:e.viewportPositionFromClientPosition,canUpdateSelectionBoxAnchor:!l.boundingBoxAnchorCanvasPosition&&(m||Z||z)}),m?(0,o.jsx)(nU,{editorOnClear:s.editorOnClear,editorOnInsert:s.editorOnInsert,hideComposer:e.hideComposer,hideEmojiPicker:R,maxCommentLength:e.maxCommentLength,mentionables:S,mountNewCommentUnfocused:e.mountNewCommentUnfocused,onComposeFocus:e.onComposeFocus,pageId:e.pageId,pinOffset:M,setClientMeta:e.setClientMeta,setIsEditorFocused:s.setIsEditorFocused,submitNewComment:C,thread:l,viewportInfo:n,viewportPositionFromClientPosition:e.viewportPositionFromClientPosition}):l.sidebarItemType===I.kT.COMMENT_THREAD||l.sidebarItemType===I.kT.FEED_POST&&(0,eZ.y)()?(0,o.jsx)(nc,{commentCreationDisabled:e.commentCreationDisabled,comments:U,disableDragging:V&&!q,dispatch:t,editorOnClear:s.editorOnClear,editorOnInsert:s.editorOnInsert,hideEmojiPicker:R,hideReactions:V,hideResolve:e.hideResolve||!(0,I.m)(l.sidebarItemType),ignoreThreadContainerScrollOnLoad:V,isLoading:e.isLoading,mentionables:S,modalRef:f,mountUnfocused:e.mountNewCommentUnfocused,nextThread:e.nextThread,onComposeFocus:e.onComposeFocus,prevThread:e.prevThread,setIsEditorFocused:s.setIsEditorFocused,setIsPinned:e.setIsPinned,setResolved:e.setResolved,showDockToSideButton:!1,showEditedIndicators:V,submitReply:b,thread:l,updateCommentContent:e.updateCommentContent,useAbsolutePositioning:V&&!q,user:B,viewportInfo:n,viewportPositionFromClientPosition:e.viewportPositionFromClientPosition}):void 0,(0,o.jsx)(nD.wV,{decoratorsRef:p,onClear:s.onClear,onInsert:s.onInsert,position:l.threadPosition||void 0,isCommunityMentions:u})]})]})}function nH({renderDetailContainerInPortal:e,detailContainerPortal:t,...n}){let i=(0,o.jsx)(nq,{...n});return e?t?(0,G.createPortal)(i,t):null:i}var nz=n(221586),nZ=n(489302),nG=n(25870);class nK{constructor(e,t=15){this.eventProvider=e,this.dragMin=t,this.dragInfo=null,this._dragCallbacks={},this._onMouseDownOverride=null,this.canvasPositionClick=(e,t)=>this._onCanvasPositionClick?.(e,{replace:t}),this.viewportPositionClick=(e,t)=>this._onViewportPositionClick?.(e,{replace:t}),this.onDown=e=>{if(this.dragInfo={id:`drag-at-${performance.now()}`,start:e,position:e},this._onMouseDownOverride){this._onMouseDownOverride(e),this.dragInfo.interrupted=!0;return}this._dragCallbacks.onDragStart?.(this.dragInfo)},this.onUp=(e,t)=>{if(!this.dragInfo){this._onViewportPositionClick?.(e,t);return}if(this.dragInfo.interrupted)return;let n=this.dragInfo;if(this.dragInfo=null,!(c.Mi.distance(e,n.start)>this.dragMin)||this._dragCallbacks.canDrag&&!this._dragCallbacks.canDrag()){this._dragCallbacks.onDragCancel?.(n.id),this._onViewportPositionClick?.(e,t);return}this._dragCallbacks.onDragEnd?.(n)},this.onMove=e=>{this.dragInfo&&!this.dragInfo.interrupted&&(this.dragInfo={...this.dragInfo,position:e},this._dragCallbacks.onDragUpdate?.(this.dragInfo))}}set onCanvasPositionClick(e){this._onCanvasPositionClick=e}set onViewportPositionClick(e){this._onViewportPositionClick=e}set onMouseDown(e){this._onMouseDownOverride=e}set dragCallbacks(e){this._dragCallbacks=e}subscribe(){return this.eventProvider.on("down",this.onDown),this.eventProvider.on("up",this.onUp),this.eventProvider.on("move",this.onMove),()=>{this.eventProvider.off("down",this.onDown),this.eventProvider.off("up",this.onUp),this.eventProvider.off("move",this.onMove)}}cancel(){this.dragInfo&&(this.dragInfo.interrupted=!0,this._dragCallbacks.onDragCancel?.(this.dragInfo.id))}}function nX(e){return{on:(t,n)=>{let o=e[t];o&&nw.on(o,n)},off:(t,n)=>{let o=e[t];o&&nw.AU(o,n)}}}let nW=nX({down:"mousedown",up:"mouseup",move:"mousemove"}),nQ=nX({}),nJ={subscribe:!0,touchEvents:!1};function nY(e){let t=i.useContext(P.kw),n=(0,ta.pC)(),s=(0,ta.gu)(),a=(0,ta.fG)(),l=(0,r.wA)(),d=(0,r.d4)(e=>e.selectedView.view),{dragEventHandler:c}=e,{canvasPositionClick:u}=c,[m,p]=i.useState(null),[f,g]=i.useState(null),[_,v]=i.useState(null),x=i.useMemo(()=>"communityHub"===d?{}:{canDrag:()=>l(h.UU()),onDragStart:e=>{let n=(0,L.$$)(t.getRawViewportInfo(),e.start);v(n),p((0,L.$$)(t.getRawViewportInfo(),e.position)),g(a(n))},onDragCancel:()=>{v(null),p(null),g(null)},onDragUpdate:e=>{if(!_||!m)return;let n=(0,L.$$)(t.getRawViewportInfo(),e.position);if(f){let e=(0,ex.pV)(n,f);(e.x!==m.x||e.y!==m.y)&&p(e);return}p(n)},onDragEnd:e=>{if(_&&m){if(n((0,L.$$)(t.getRawViewportInfo(),e.start))){s(),v(null),p(null),g(null);return}u(m,!0)&&l(h.a$({selectionBoxAnchor:(0,L.$$)(t.getRawViewportInfo(),e.start)})),v(null),p(null),g(null)}}},[t,n,a,s,l,u,d,m,p,f,g,_,v]);i.useEffect(()=>{c.dragCallbacks=x},[x,c]);let b=m?(0,L.Z0)(t.getRawViewportInfo(),m):null,C=_?(0,L.Z0)(t.getRawViewportInfo(),_):null;if(!b||!C)return null;let y=Math.min(C.x,b.x),w=Math.min(C.y,b.y),j=Math.max(C.x-y,b.x-y),k=Math.max(C.y-w,b.y-w);return(0,o.jsx)("div",{className:nR,style:{left:y,top:w,width:j,height:k}})}let n$={replace:!1};function n0(e){let{requestToDeselectCommentPin:t,requestToAddDraftCommentPin:n}=e,s=(0,L.ni)(),a=(0,r.d4)(e=>e.selectedView.view),d=(0,l.md)(z.R),c=void 0!==e.isActiveCommentPinned?e.isActiveCommentPinned:d,u=(0,r.d4)(e=>e.comments.editingComment),m=(0,r.d4)(e=>e.comments.emojiPicker),p=(0,r.wA)(),{activeId:f,commentCreationDisabled:g}=e,v=(0,r.d4)(e=>e.mirror.appModel.currentTool)===S.NLJ.COMMENTS&&"fullscreen"!==a,x=function(e,t,n,o,s){let{requestToDeselectCommentPin:a,eventPreferences:l,allowCompose:d,requestToAddDraftCommentPin:c}=o||{},u=i.useContext(P.kw),m=(0,ta.pC)(),p=(0,ta.gu)(),f=(0,r.wA)(),g=(0,F.ut)(S.Ez5?.singleSlideView().focusedNodeId,null),v=i.useRef(g);i.useEffect(()=>{g!==v.current&&(v.current=g,f(h.UU()))},[g,f]);let x=i.useCallback((o,i)=>{if(e&&(d||!t))return a?!0!==i&&(a(),!0):(n&&n(!1),!f(h.UU())||!0!==i)},[e,d,t,a,n,f]),{touchEvents:b}=l||{},C=i.useCallback((e,t)=>{let n=(0,L.Z0)(u.getViewportInfo(),e),{replace:o}=t||n$;if(!x(n,o)&&(!b||o)&&(0,_.rN)(n,u.getValidCommentsRect())){if(m(e)){p();return}return c?c?.({x:n.x,y:n.y,width:32*1.15,height:32*1.15}):(f(h.vV({anchorPosition:e})),f(h.CX())),e}},[x,c,b,u,m,p,f]),y=i.useCallback((e,t)=>C((0,L.$$)(u.getRawViewportInfo(),e),t),[u,C]);return function(e,t,n,o,r,s){let{touchEvents:a,subscribe:l}={...nJ,...o||{}},d=i.useCallback(()=>new nK(a?nQ:nW),[a]),[c,u]=i.useState(()=>d());return i.useEffect(()=>{u(d())},[d]),i.useEffect(()=>l?c.subscribe():()=>{},[c,l]),i.useEffect(()=>{a&&r&&s?.current?(r.updateTapGestureRecognizer(s.current,e=>{t(e)}),r.updateMultiTouchLongPressGestureRecognizer(s.current,e=>{t(e,{replace:!0})},1)):(c.onCanvasPositionClick=e,c.onViewportPositionClick=t)},[e,t,c,a,r,s]),i.useEffect(()=>{c.onMouseDown=n},[n,c]),c}(C,y,d?null:x,l,i.useContext(nZ.W),s)}(f,c,e.setIsPinned,{requestToAddDraftCommentPin:n,eventPreferences:{touchEvents:e.preferTouchOverMouseForComments},allowCompose:!0!==g||v,requestToDeselectCommentPin:t},e.gestureCanvasRef),b=i.createRef(),C=i.useCallback(t=>{if(t.keyCode===nz.Uz.ESCAPE&&(x.cancel(),!u&&e.activeId)){m&&m.visible&&p(h.RI({visible:!1}));return}},[p,u,e.activeId,m,x]),y=eb.v_(e.recordingKey,"keydown",C),w=i.useCallback(e=>{y(e.event)},[y]),j=i.useRef();if(i.useEffect(()=>{if(j.current&&"details"===e.mode&&!e.activeId){j.current();return}},[e.mode,j,e.activeId]),!s)return null;let{x:k,y:I,width:T,height:E}=s,M={left:e.positionRelativeToCanvas?0:k,top:e.positionRelativeToCanvas?0:I,width:T,height:E};return(0,o.jsx)(nG.vL,{name:"comments-view-canvas",focusOnMount:!1,propagateKeyboardFocus:!0,handleKeyDown:w,ref:b,focusFunctionRef:j,style:{position:"absolute"},children:(0,o.jsx)("div",{"data-forward-events-to-fullscreen":!0,className:"comments_view--viewContainer--gpOsy comments_view--_container--bDxcy",children:(0,o.jsxs)("div",{"data-allow-component-drop":!0,"data-forward-events-to-fullscreen":!0,className:"comments_view--outerAnchorContainer--ppSFh comments_view--_container--bDxcy",ref:e.forwardedRef,style:M,children:[(0,o.jsx)(nY,{dragEventHandler:x}),e.children]})})})}let n1=i.forwardRef((e,t)=>(0,o.jsx)(n0,{...e,forwardedRef:t}));function n2(e){let t=i.useRef(e);return i.useEffect(()=>{t.current=e},[e]),i.useCallback(e=>{let n=t.current,o=n.find(t=>t.id===e);if(o)return function(e,t){let n;if(!e.canvasPosition)return;let o=1/0;return t.forEach(t=>{t.id!==e.id&&t.canvasPosition&&t.page===e.page&&c.Mi.distance(e.canvasPosition,t.canvasPosition)<o&&(n=t,o=c.Mi.distance(e.canvasPosition,t.canvasPosition))}),n}(o,n)},[t])}function n4(e,t,n){if(0===e.comments.length)return!1;let o=e.comments[0]?.user_id===n,i=e.comments.some(e=>e.user_id===n||(0,_.F$)(e).includes(n));return t.canEdit||o||i}let n5=e=>{let t=(0,l.Xr)(z.R),n=(0,d.am)();return i.useCallback(o=>{t(o),o&&n("Comment Pinned",{parentCommentId:e})},[e,n,t])};function n7(e){var t;let{activeId:n}=e,s=i.useContext(P.kw),l=(0,r.d4)(e=>"communityHub"===e.selectedView.view),d=(0,j.iZ)(),u=(0,y.q5)(),m=(0,r.d4)(e=>e.selectedView.commentThreadId),p=(0,r.wA)(),h=i.useContext(A.hh),_=h.filteredThreads,v=(0,nB.WM)(_,e.pageId,n,e.showOnlyParticipatingComments,e.hideInactiveComments);t=_.status,(0,w.t)(e=>{"loaded"===t&&e("comments_rendered")},[t]);let x=(0,nB.hC)(h.threads,[]),b="loaded"===h.threads.status,C=(0,g.Le)(),k=m&&b&&x.some(e=>e.id===m),T=!!m&&b&&!k&&C,M=(0,nB.nq)(m,b,n,x,s,e.requestToSelectCommentPin);i.useEffect(()=>{(M||T)&&p(f.ST())},[M,T,p]);let S=(0,nB.uB)(n,e.pageId),N=(0,nB.zf)(v,s.getViewportInfo()),[D,O]=i.useMemo(()=>{let e=N.findIndex(e=>e.id===n);return -1===e?[void 0,void 0]:[N[e-1],N[e+1]]},[N,n]),R=d?.id&&S&&u?n4(S,u,d.id):null,L=e.hideResolve||!R,F=i.useRef(null),B=i.useCallback(e=>{if(F.current){let t=F.current.getBoundingClientRect();return e.subtract(new c.Mi(t.left,t.top))}return new c.Mi(0,0)},[]),[U,V]=i.useState(null),q=!(e.requestToSelectCommentPin&&S?.id!==I.hm),H=n5(S?.id);return(0,o.jsxs)(o.Fragment,{children:[(0,a.kc)().comments_react?(0,o.jsx)(eV,{activeThread:S,dragDisabledOverride:e.dragDisabledOverride,isCommunity:l,pageId:e.pageId,requestToDeselectCommentPin:e.requestToDeselectCommentPin,requestToSelectCommentPin:e.requestToSelectCommentPin,setActivePinSize:V,setClientMeta:e.setClientMeta,threads:v,viewportPositionFromClientPosition:B}):(0,o.jsx)(E.IN,{activeThread:S,dragDisabledOverride:e.dragDisabledOverride,isCommunity:l,pageId:e.pageId,requestToDeselectCommentPin:e.requestToDeselectCommentPin,requestToSelectCommentPin:e.requestToSelectCommentPin,setActivePinSize:V,setClientMeta:e.setClientMeta,threads:v,viewportPositionFromClientPosition:B}),(0,o.jsx)(n1,{ref:F,activeId:n,commentCreationDisabled:"pins"===e.mode||e.commentCreationDisabled,gestureCanvasRef:e.gestureCanvasRef,mode:e.mode,positionRelativeToCanvas:e.positionRelativeToCanvas,preferTouchOverMouseForComments:e.preferTouchOverMouseForComments,recordingKey:"commentsViewCanvas",requestToAddDraftCommentPin:e.requestToAddDraftCommentPin,requestToDeselectCommentPin:e.requestToDeselectCommentPin,setIsPinned:H,children:(0,o.jsx)(o.Fragment,{children:S&&q&&(0,o.jsx)(nH,{commentCreationDisabled:e.commentCreationDisabled,detailContainerPortal:e.detailContainerPortal,hideComposer:!!e.requestToAddDraftCommentPin,hideResolve:L,isLoading:e.isLoadingActiveThread,maxCommentLength:e.maxCommentLength,mountNewCommentUnfocused:e.mountNewCommentUnfocused,nextThread:O,onComposeFocus:e.onComposeFocus,pageId:e.pageId,pinOffset:U,prevThread:D,renderDetailContainerInPortal:e.renderDetailContainerInPortal,setClientMeta:e.setClientMeta,setIsPinned:H,setResolved:e.setResolved,submitNewComment:e.submitNewComment,submitReply:e.submitReply,thread:S,updateCommentContent:e.updateCommentContent,viewportPositionFromClientPosition:B})})})]})}function n3(e){let t=(0,k.Qt)(e.activeId);return(0,o.jsxs)(u.tH,{boundaryKey:"FileCommentsOverlay",team:s.e.WAYFINDING,fallback:u.H4.NONE_I_KNOW_WHAT_IM_DOING,children:[(0,o.jsx)(T.p,{featureFlag:"mobile_reply_upsell",children:(0,o.jsx)(eq.T,{})}),(0,o.jsx)(n6,{...e,usersOnFile:t})]})}function n6(e){let t=(0,g.wq)(),n=(0,M.s)(),s=(0,r.wA)(),a=function(){let e=(0,eH.Vi)(),t=(0,r.d4)(e=>e.mirror.appModel.showComments);return e?"details":!1===t?null:"pins"}(),{pageId:l,modeOverride:d}=e,c=i.useContext(P.kw),u=(0,nB.H6)(c,l),f=(0,g.I_)().writeAPI,_=i.useCallback(e=>{if(!f){console.error("Calling submitReply with no write API");return}"loaded"===t.status&&t.data.find(t=>t.id===e.threadId)&&(e.onCommentValidationFailure=(t,o,i,r)=>h.dB(f,s,t,o,i,r,e.uuid,n),s(h.lV({...e,commentsWriteApi:f,commentsConfiguration:n})),(0,m.YQ)({id:eq.w}))},[s,t,f,n]),y=i.useCallback(e=>{if(!f){console.error("Calling submitNewComment with no write API");return}e.onCommentValidationFailure=(e,t,n,o)=>h.C(s,e,t,n,o),s(h._v(e))},[s,f]),w=(0,r.d4)(e=>e.selectedView),j=(0,b.Yi)(w),k=(0,r.d4)(e=>"fullscreen"===e.selectedView.view),I=(0,v.aV)(),{isLoading:T}=(0,x._Z)(),E=d||a,A=(0,nB.hC)(t,[]);(0,C.d0)(e.activeId,A,c,k,u),(0,C.$P)(e.activeId,A,c,d,E);let S=(0,b.sc)(),N=i.useCallback(e=>{s(h.hY(e))},[s]),D=i.useCallback(e=>{s(h.hx(e))},[s]);if((0,p.Kv)()||k&&(I||T)||null===E||j)return null;let O=!k&&!!S?.requestToSelectCommentPin&&!!S?.requestToDeselectCommentPin&&!!S?.requestToAddDraftCommentPin;return(0,o.jsx)(n7,{activeId:e.activeId,detailContainerPortal:e.detailContainerPortal,dragDisabledOverride:S?.shouldDisableCommentDrag,gestureCanvasRef:e.gestureCanvasRef,hideInactiveComments:!1,mode:E,pageId:e.pageId,positionRelativeToCanvas:!1,preferTouchOverMouseForComments:O,renderDetailContainerInPortal:e.renderDetailContainerInPortal,requestToAddDraftCommentPin:S?.requestToAddDraftCommentPin,requestToDeselectCommentPin:S?.requestToDeselectCommentPin,requestToSelectCommentPin:S?.requestToSelectCommentPin,setClientMeta:N,setResolved:D,showOnlyParticipatingComments:e.showOnlyParticipatingComments,showResolvedComments:e.showResolvedComments,submitNewComment:()=>{u(),(0,m.YQ)({id:eq.w})},submitReply:_,updateCommentContent:y})}n7.displayName="CommentsOverlay"},409757:(e,t,n)=>{n.d(t,{Z:()=>s,_:()=>a});var o=n(716976),i=n(361170),r=n(198444);class s{constructor(e,t){this.guide=null;let n=0;"number"==typeof e&&(n=e),this.inset={top:e.top||e.vertical||n,bottom:e.bottom||e.vertical||n,left:e.left||e.horizontal||n,right:e.right||e.horizontal||n},t&&(this.guide=document.createElement("div"),this.guide.id="inset-guide",this.guide.style.position="fixed",this.guide.style.zIndex="10",this.guide.style.display="none",this.guide.style.pointerEvents="none",document.firstElementChild.append(this.guide))}_computePositionWithinInsetBounds(e,t,n,o,i){let r=n.top,s=n.bottom-this.inset.bottom,a={};t.y<r?a.y=r:t.y+e.clientHeight>s&&(a.y=s-e.clientHeight);let l=n.left,d=n.right;if(t.x<l?a.x=l:t.x+e.clientWidth>d&&(a.x=d-e.clientWidth),a.x&&o&&a.x<t.x){let n=Math.min(o.x-(i?.x||0),d)-e.clientWidth;n>l?a.x=n:a.x=t.x}return a}computePositionWithinInsetBounds(e,t,n,o,i,r){let s={top:this.inset.top,left:this.inset.left,right:n.width-this.inset.right,bottom:n.y+n.height-this.inset.bottom-(r??0)},a=this._computePositionWithinInsetBounds(e,t,s,o,i);if(this.guide){let e={top:n.y+this.inset.top,left:n.x+this.inset.left,width:n.width-this.inset.right-this.inset.left,height:n.height-this.inset.bottom-this.inset.top};this.guide.style.top=`${e.top}px`,this.guide.style.left=`${e.left}px`,this.guide.style.height=`${e.height}px`,this.guide.style.width=`${e.width}px`,this.guide.style.display="block",a.y||a.x?this.guide.style.border="1px solid red":this.guide.style.border="1px solid green"}return a}}function a(e,t,n,s,a,l){let{newCommentAdditionalBottomInset:d}=(0,r.s)(),c=e.current,u=o.useMemo(()=>t?i.Mi.add(t,l):null,[l,t]);return o.useMemo(()=>{if(!u)return null;if(!c||!s)return u;let e=s.computePositionWithinInsetBounds(c,u,n,t,a,d);return{...u,...e}},[u,c,s,n,t,a,d])}},483824:(e,t,n)=>{n.d(t,{g:()=>c,H:()=>a});var o=n(142462),i=n(292423),r=n(361170);class s{constructor(e,t,n){this.cellSize=e,this.neighborThreshold=t,this.sizeFn=n,this.grid=new Map,this.NEIGHBORING_CELL_DELTAS=[[0,0],[-1,0],[0,-1],[0,1],[1,0],[1,-1],[1,1],[-1,-1],[-1,1]]}add(e){let{x:t,y:n}=this.getCoords(e),o=this.toCellIndex(n),i=this.toCellIndex(t);this.getCell(o,i).push(e)}findNeighbor(e){let t=this.sizeFn(e),{x:n,y:o}=this.getCoords(e),i=this.toCellIndex(o),s=this.toCellIndex(n);for(let[n,o]of this.NEIGHBORING_CELL_DELTAS)for(let a of this.getCell(i+n,s+o))if(a!==e){let e=this.sizeFn(a);if((0,r.gt)(t,e)<=this.neighborThreshold)return a}return null}getCoords(e){let t=this.sizeFn(e);return{x:t.x+t.width/2,y:t.y+t.height/2}}getCell(e,t){let n=this.grid.get(e);n||(n=new Map,this.grid.set(e,n));let o=n.get(t);return o||(o=[],n.set(t,o)),o}toCellIndex(e){return Math.floor(e/this.cellSize)}}function a(e,t){return Math.max(e.minZoomPercentage/100-t,0)*e.zoomScaleOverlap}let l=(e,t)=>{t.forEach(t=>{let n=e.threads.length,o=t.threads.length,i=n+o,r=e.x*n/i+t.x*o/i,s=e.y*n/i+t.y*o/i;e.x=r,e.y=s,e.threads=e.threads.concat(t.threads)})};class d{constructor(e,t,n){let r=a(t,e.zoomScale),l=i.XC.getPinSize(3),d=Math.ceil(Math.max(o.u5,l.width,l.height)+r);this.distanceGrid=new s(d,r,n)}getNearbyNeighbor(e){return this.distanceGrid.findNeighbor(e)||void 0}onAddToResultCluster(e){this.distanceGrid?.add(e)}}function c(e,t,n,i){let r=[],s=[];for(let t of e)t.isActive||t.id===i?s.push(t):r.push({x:t.canvasPosition.x,y:t.canvasPosition.y,threads:[t]});let a=e=>o.ip.getClusterViewportRect(e,t);if(t.zoomScale<=n.minZoomPercentage/100){let e=new Map;do{e.clear();let o=new d(t,n,a),i=[];for(let t of r){let n=o.getNearbyNeighbor(t);n?e.has(n)?e.get(n).push(t):e.set(n,[t]):(o.onAddToResultCluster(t),i.push(t))}e.forEach((e,t)=>{l(t,e)}),r=i}while(e.size>0)}return s.forEach(e=>{let{canvasPosition:t}=e;t&&r.push({x:t.x,y:t.y,threads:[e]})}),r}},854855:(e,t,n)=>{n.d(t,{m:()=>F});var o=n(104076),i=n(716976),r=n(684742),s=n(689161),a=n(812714),l=n(511570),d=n.n(l),c=n(428710),u=n(561839),m=n(858959),p=n(498520),h=n(983468),f=n(265149),g=n(681398),_=n(641518),v=n(366815),x=n(652539),b=n(192075),C=n(122010),y=n(951002),w=n(173272),j=n(925912),k=n(572988),P=n(25493),I=n(194200);function T(e){let t="left"===e.side?P.A:I.A,n="left"===e.side?`6px 0 0 ${e.color}`:`-6px 0 0 ${e.color}`;return(0,o.jsx)(m.P.div,{style:{opacity:e.opacity,position:"relative",top:e.offset,zIndex:1},"aria-hidden":(0,a.kc)().figjam_a11y_spotlight,children:(0,o.jsx)("div",{style:{boxShadow:n,transition:`box-shadow ${k.Bn}s linear`},children:(0,o.jsx)(x.B,{svg:t,style:{fill:e.color,transition:`fill ${k.Bn}s linear`}})})})}function E(e){let{opacity:t,offset:n,color:i,children:r}=e;return(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"flex-start"},children:[(0,o.jsx)(T,{side:"left",opacity:t,offset:n,color:i}),(0,o.jsx)("span",{style:{zIndex:2},children:r}),(0,o.jsx)(T,{side:"right",opacity:t,offset:n,color:i})]})}function M(e){return(0,o.jsx)("div",{style:{borderRadius:"6px",overflow:"hidden"},children:e.children})}function A(e){let{color:t,docked:n,dockedStyle:i,dockedOffset:r,children:s}=e,a=(0,w.d)(1),l=(0,w.d)(0),d=!0===n?a:!1===n?l:n,c=(0,j.G)(d,[0,1],[0,1]),u=(0,j.G)(d,[0,1],["0px",`${r}px`]),p=(0,j.G)(d,[0,1],["6px","0px"]);switch(i){case"straight":return(0,o.jsx)(m.P.div,{style:{borderTopLeftRadius:p,borderTopRightRadius:p,borderBottomLeftRadius:"6px",borderBottomRightRadius:"6px",backgroundColor:t,overflow:"hidden"},children:s});case"inverted":return(0,o.jsx)(E,{opacity:c,offset:u,color:t,children:(0,o.jsx)(M,{children:s})});default:(0,y.xb)(i)}}var S=n(704728),N=n(851824);let D=({enabled:e})=>{let[t,n]=i.useState(0),o=i.useCallback(()=>{n(Date.now())},[]);return i.useEffect(()=>(e&&document.addEventListener("mousemove",o),()=>{document.removeEventListener("mousemove",o)}),[o,e]),t};function O({enabled:e,children:t}){let n=D({enabled:e}),r=(0,S.E)(),s=i.useCallback(()=>{r.start({opacity:1,transition:{duration:0}})},[r]),a=i.useCallback(()=>{r.start({opacity:0,transition:{duration:.5}})},[r]),l=(0,N.A)(a,5e3);return i.useEffect(()=>{s(),e?l():l.isPending()&&l.cancel()},[e,n,l,s]),(0,o.jsx)(m.P.div,{animate:r,children:t})}let R="multiplayer_bell--buttonContainer--4rypl";var L=n(821527);function F(e){let{color:t,useSecondaryColor:n,message:l,renderKey:C,progressBar:y,progressBarDurationMs:w,autoHide:j,button:P,secondaryButton:I,showCloseButton:T,onCloseCallback:E,docked:M,dockedBorderInfo:S,isTabAccessible:N}=e,[D,F]=i.useState(!1),U=g.Xb?"multiplayer_bell--buttonMobile--Z5j0F multiplayer_bell--button--QWm4n multiplayer_bell--multiplayerText--b-7-0 text--fontPos11--2LvXf text--_fontBase--QdLsd multiplayer_bell--multiplayerTextMobile--4qVD- multiplayer_bell--multiplayerText--b-7-0 text--fontPos11--2LvXf text--_fontBase--QdLsd text--fontPos14--OL9Hp text--_fontBase--QdLsd":"multiplayer_bell--button--QWm4n multiplayer_bell--multiplayerText--b-7-0 text--fontPos11--2LvXf text--_fontBase--QdLsd",V=g.Xb?"multiplayer_bell--messageMobile--Z1sCx multiplayer_bell--message--POM9v multiplayer_bell--multiplayerText--b-7-0 text--fontPos11--2LvXf text--_fontBase--QdLsd multiplayer_bell--multiplayerTextMobile--4qVD- multiplayer_bell--multiplayerText--b-7-0 text--fontPos11--2LvXf text--_fontBase--QdLsd text--fontPos14--OL9Hp text--_fontBase--QdLsd":"multiplayer_bell--message--POM9v multiplayer_bell--multiplayerText--b-7-0 text--fontPos11--2LvXf text--_fontBase--QdLsd",q=g.Xb?"multiplayer_bell--closeButtonMobile--s-kHx multiplayer_bell--closeButton--5Pbdu multiplayer_bell--multiplayerTextMobile--4qVD- multiplayer_bell--multiplayerText--b-7-0 text--fontPos11--2LvXf text--_fontBase--QdLsd text--fontPos14--OL9Hp text--_fontBase--QdLsd":"multiplayer_bell--closeButton--5Pbdu",H=t??p.ol.MULTIPLAYER_GRAY,z=i.useMemo(()=>{if("brand"===t)return{"--multiplayerBellBackgroundColor":n?"var(--color-bg-brand-hover)":"var(--color-bg-brand)","--multiplayerBellTextColor":"var(--color-text-onbrand)","--multiplayerBellButtonBackgroundColor":"var(--color-bg-menu)","--multiplayerBellButtonTextColor":"var(--color-text-menu)","--multiplayerBellButtonHoverColor":"var(--color-bg-menu-secondary)","--multiplayerBellProgressBackgroundColor":"var(--color-bg-brand-hover)"};{let e=(0,p.H0)(H),t=(0,h.Hd)(e,-.15),o=(0,h.Hd)(e,-.55),i=(0,h.Hd)(e,-.8),r=e&&(0,p.GL)(e),s=o&&(0,p.GL)(o);return{"--multiplayerBellBackgroundColor":n&&t?(0,c.colorToString)(t):H,"--multiplayerBellTextColor":r,"--multiplayerBellButtonBackgroundColor":o?(0,c.colorToString)(o):void 0,"--multiplayerBellButtonTextColor":s,"--multiplayerBellButtonHoverColor":i?(0,c.colorToString)(i):void 0,"--multiplayerBellProgressBackgroundColor":t?(0,c.colorToString)(t):void 0}}},[H,t,n]),Z=(0,i.useRef)(null),G=(0,i.useRef)(null),K=(0,f.wY)(Z),X=(0,f.wY)(G),W=K&&X?K.width+X.width:"auto";if(D)return null;let Q=w>=k.BI?"multiplayer_bell--progressBarAnimationSlow--Rfp9s":"multiplayer_bell--progressBarAnimationQuick--aBXRY";return(0,o.jsx)(O,{enabled:j,children:(0,o.jsx)(A,{color:z["--multiplayerBellBackgroundColor"],docked:M||!1,dockedStyle:0===(S?.width||0)?"straight":"inverted",dockedOffset:S?.width||0,children:(0,o.jsx)(B,{isTabAccessible:N,children:(0,o.jsx)(u.N,{initial:!1,children:(0,o.jsxs)("div",{className:"multiplayer_bell--multiplayerBell--MJNGX",style:{...z,transition:`background-color ${k.Bn}s linear`},children:[y&&(0,o.jsx)("div",{className:"multiplayer_bell--progressBarContainer--6yfl6",children:(0,o.jsx)("div",{className:d()("multiplayer_bell--progressBarFill--McozJ",Q),style:{animationDuration:`${w}ms`}})}),(0,o.jsx)("div",{className:"multiplayer_bell--messageAndButtonsContainer--SRFq4",children:(0,o.jsxs)(m.P.div,{animate:{width:W},className:"multiplayer_bell--messageAndButtonsVariableWidthContainer--6tqVI",transition:{duration:k.Uj,type:"easeOut"},children:[(0,o.jsx)("div",{style:{width:"fit-content"},ref:Z,"aria-live":"polite",children:l.onClick?(0,o.jsx)(r.E,{className:d()(V),recordingKey:_.Pt(e,"message"),onClick:l.onClick,children:(0,o.jsx)(s.T,{children:l.text})}):(0,o.jsx)(s.T,{className:d()(V),children:l.text})}),(0,o.jsx)("div",{style:{width:"fit-content"},ref:G,children:(0,o.jsxs)("div",{className:"multiplayer_bell--buttonsContainer--9CCwH",children:[(0,a.kc)().spotlight_zoom_override&&I&&(0,o.jsx)(m.P.div,{className:R,children:(0,o.jsx)(r.E,{className:d()(U),recordingKey:_.Pt(e,"button"),onClick:I.onClick,children:I.text})}),P&&(0,o.jsx)(m.P.div,{className:R,initial:{opacity:0},animate:{opacity:1},transition:{duration:k.Gy,delay:k.kS},children:(0,o.jsx)(r.E,{className:d()(U),recordingKey:_.Pt(e,"button"),onClick:P.onClick,children:P.text})}),T&&(0,o.jsx)("div",{className:R,children:(0,o.jsx)(v.GG,{className:d()(q),recordingKey:_.Pt(e,"closeButton"),onClick:()=>{E&&E(),F(!0)},"aria-label":(0,b.t)("collaboration.spotlight.bell.dismiss"),children:(0,o.jsx)(x.B,{svg:L.A})})})]})})]})})]},C)})})})})}function B({isTabAccessible:e,children:t}){return e?(0,o.jsx)(o.Fragment,{children:t}):(0,o.jsx)(C.m,{role:"region",children:t})}},844379:(e,t,n)=>{n.d(t,{s:()=>r});var o=n(104076),i=n(192075);function r({count:e}){let t;return t=e<10?60:e<100?68:72,(0,o.jsx)("div",{style:{minWidth:t,display:"flex",justifyContent:"center"},children:(0,i.tx)("collaboration.spotlight.bell.presenter.follower_count",{followerCount:e})})}},437595:(e,t,n)=>{n.d(t,{Y:()=>p});var o=n(104076),i=n(716976),r=n(511570),s=n.n(r),a=n(173272),l=n(925912),d=n(858959),c=n(854855),u=n(572988),m=n(424793);function p(e){let{borderInfo:t}=i.useContext(m.h),n=t.width,r=e.docked?0:8,p=(0,a.d)(r),h=(0,l.G)(p,[8,n,0],[0,0,1]),f=(0,l.G)(p,[8,0],[0,1]),g=0===t.width?f:h;return(0,o.jsx)(d.P.div,{className:s()({"positioned_multiplayer_bell--multiplayerBellContainer--Ad5kg":!0,"positioned_multiplayer_bell--ghost--vYS1y":e.ghost}),animate:{top:r},style:{top:p},initial:!1,transition:{type:"easeout",duration:u.lo},children:(0,o.jsx)(c.m,{...e,docked:!!e.docked&&g,dockedBorderInfo:t,recordingKey:"multiplayerBell",isTabAccessible:e.isTabAccessible})},e.renderKey)}},424793:(e,t,n)=>{n.d(t,{h:()=>o});let o=n(716976).createContext({borderInfo:{width:0,color:"transparent"},style:{}})},572988:(e,t,n)=>{n.d(t,{BI:()=>l,Bn:()=>a,Gy:()=>r,Uj:()=>i,kS:()=>s,lo:()=>o});let o=.2,i=.2,r=.05,s=.2-.05,a=.1,l=3e3},546547:(e,t,n)=>{n.d(t,{Mw:()=>ev,ON:()=>ec});var o=n(104076),i=n(716976),r=n(903927),s=n(293422),a=n(730481),l=n(790009),d=n(266808),c=n(812714),u=n(795033),m=n(190028),p=n(219199),h=n(755444),f=n(432099),g=n(11395),_=n(236631);n(967782);var v=n(221602),x=n(352630),b=n(192075),C=n(58212),y=n(475477),w=n(873289),j=n(369049),k=n(910223);let P="interacted_with_slack_and_teams_announcement";var I=n(549571),T=n(458769),E=n(915707),M=n(443192),A=n(244205),S=n(373547),N=n(551037),D=n(376165),O=n(107507),R=n(374618),L=n(484495),F=n(211862),B=n(592726),U=n(248043),V=n(944350),q=n(331497),H=n(904017),z=n(299640),Z=n(532096),G=n(19877),K=n(423128),X=n(380494),W=n(511570),Q=n.n(W),J=n(836982),Y=n(816565),$=n(101880),ee=n(259161),et=n(111297),en=n(501883),eo=n(737139);let ei="announcement--announcementAppImg--l9gG8",er="announcement--announcementBrandImg--H6L6b",es="announcement--imageNoPaddingTop--YSxed";function ea(e){return e.link?(0,o.jsx)("div",{children:(0,o.jsx)(ee.Ph,{trackingProperties:{text:e.mainButtonTitle},href:e.link,newTab:!0,children:e.children})}):(0,o.jsx)("div",{className:_.s.wFull.$,children:(0,o.jsx)(x.$z,{variant:"secondary",onClick:e.onClick,disabled:e.disabled,children:e.children})})}function el(e){let t=(0,B.iZ)(),n=(0,F.MY)(),i=(0,r.wA)(),s=(0,L.w)(),a=()=>{let t=e.asset.bg?{backgroundColor:e.asset.bg}:void 0;return"image"===e.asset.type?(0,o.jsx)(Y.oW,{src:e.asset.src,className:Q()("brand"===e.layoutStyle?er:ei,{[es]:e.asset.noPaddingTop}),alt:e.asset.alt,style:t}):(0,o.jsx)("video",{src:e.asset.src,className:Q()("brand"===e.layoutStyle?er:ei,{[es]:e.asset.noPaddingTop}),"aria-label":e.asset.alt,style:t,autoPlay:!0,loop:!0,muted:!0})},l=X.Qw.useTransform(n,e=>t?.id===e?.creatorId?"owner":e?.canEdit?"editor":"viewer");return(0,o.jsx)(et.fu,{name:e.trackingContextName,properties:{userId:t?.id,jobTitle:s,userRole:l.unwrapOr("viewer")},enabled:e.trackingDisabled&&"loaded"===l.status,children:(0,o.jsx)(J.k,{name:"announcement_panel",children:(0,o.jsxs)(eo.Zk,{className:"announcement--announcementPanel--Ds9Bn",children:[(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:"announcement--announcementTitleRow--bQu8l",children:[(0,o.jsx)(en.Q,{extended:!0,doNotReserveSpaceForChevron:!0,children:(0,o.jsx)("div",{className:_.s.with({ml8:!0}).$,children:e.title})}),(0,o.jsx)("div",{className:"announcement--announcementCloseButton--vgH6U",children:(0,o.jsx)(x.Me,{"aria-label":(0,b.t)("general.close"),onClick:e.onDismiss?e.onDismiss:()=>{i(M.b({[e.userFlagName]:!0}))},trackingProperties:{action:"close"},children:(0,o.jsx)(K.A,{})})})]}),"app"===e.layoutStyle&&e.description,"brand"===e.layoutStyle&&a()]}),"app"===e.layoutStyle&&a(),"brand"===e.layoutStyle&&e.description,e.mainButtonOverride,!e.mainButtonOverride&&e.mainButtonTitle&&(0,o.jsx)(ea,{link:e.ctaHref,onClick:e.onCtaClick,disabled:e.isLoading,mainButtonTitle:e.mainButtonTitle,children:(0,o.jsx)($.x,{isLoading:e.isLoading,className:"announcement--loading--KRjaH",children:()=>(0,o.jsx)(o.Fragment,{children:e.mainButtonTitle})})})]})})})}(0,h.ck)("a553882986986c96fc7d298a674e9e0522d05b53");let ed=(0,O.ck)();var ec=(e=>(e.DESIGN="Design",e.PROTOTYPE="Prototype",e.INSPECT="Inspect",e.HANDOFF="Handoff",e.COMMENTS="Comments",e))(ec||{});let eu={assetSrc:(0,h.ck)("828793d9a2d4cff784587a20da2cd458dceddfe9"),backgroundColor:"#F5F5F5",imageNoPaddingTop:!0},em={assetSrc:(0,h.ck)("fb12393ac78bdda14d77f2be682d3f2e67fe7f6f"),backgroundColor:"#383838",imageNoPaddingTop:!0},ep=e=>{let t=e?.currentPlanUser?.draftsFolderId??void 0;return{folderId:t,isDraftsFolder:void 0!==t}},eh=(e,t)=>{let n=new Date(e);return n.setDate(n.getDate()+t),n},ef=new Date,eg=[{userFlagName:"dismissed_figma_make_prototype_announcement",AnnouncementComponent:function({userFlagName:e}){let t=(0,r.wA)(),n=(0,F.q5)(),i="dark"===(0,S.DP)(),{folderId:s,isDraftsFolder:a}=ep(n),d=(0,E.$)({folderId:s,isDraftsFolder:a,editorType:V._Y.FIGMAKE,forceOpenNewTab:!0,newFileFrom:z.f6.FIGMAKE_PROTOTYPE_ANNOUNCEMENT,contextClicked:"figmake_prototype_announcement_created"}),c={type:"video",src:i?(0,h.ck)("001c68beb7c3ebcc9c080f1104272404696c536b"):(0,h.ck)("8aa3d03397da517c320149f5e387c1030ceebe13"),alt:(0,b.t)("upsell.figma_make_prototype_announcement.image_alt"),bg:i?"#2D2E46":"#F7F6FF",noPaddingTop:!0};return(0,o.jsx)(el,{asset:c,description:(0,b.t)("upsell.figma_make_prototype_announcement.description"),layoutStyle:"brand",mainButtonOverride:(0,o.jsx)(l.J,{brand:"seascape",children:(0,o.jsx)(x.lR,{variant:"primary",onClick:d,trackingProperties:{trackingDescriptor:A.c.TRY_FIGMA_MAKE},children:(0,b.t)("upsell.figma_make_prototype_announcement.button_title")})}),onDismiss:()=>{t(M.b({[e]:!0}))},title:(0,b.t)("upsell.figma_make_prototype_announcement.title"),trackingContextName:"Figma Make Prototype Announcement",userFlagName:e})},panelName:"Prototype",additionalDisplayBlocker:({canCreateFigmakeFileInTargetFolder:e})=>!e},{userFlagName:"seen_mobile_proto_announcement",AnnouncementComponent:function(){let e=(0,r.wA)();return(0,u.md)(R.NE)?(0,o.jsx)(el,{asset:{type:"image",src:(0,h.ck)("b50fba0faeea245feed92fe60337297d827e4984"),alt:(0,b.t)("cross_sell.mobile_app_prompt.comment_image_alt_text")},description:(0,b.t)("mobile_download_prompts.play_mobile_prototypes"),isLoading:!1,layoutStyle:"app",mainButtonTitle:(0,b.t)("mobile_download_prompts.email_me"),onCtaClick:()=>{f.Ay.post("/api/send_mobile_download_email",{type:"prototype"}),e(C.F.enqueue({message:(0,b.t)("rcs.mobile_comment_reply_upsell.email_sent")})),e(M.b({seen_mobile_proto_announcement:!0}))},title:(0,b.t)("mobile_download_prompts.run_prototypes_from_your_phone"),trackingContextName:"Mobile App Prototype Announcement",trackingDisabled:!0,userFlagName:"seen_mobile_proto_announcement"}):(0,o.jsx)(o.Fragment,{})},panelName:"Prototype",additionalDisplayBlocker:({userAnalyticsData:e,userFlags:t,selectedView:n})=>!(0,c.kc)().mobile_download_proto_sidebar||e?.is_active_mobile_user||!!t.seen_mobile_proto_download_modal_prompt||(0,Z.$A)(n)},{userFlagName:"seen_mobile_comment_announcement",AnnouncementComponent:function(){let e=(0,r.wA)();return(0,o.jsx)(el,{asset:{type:"image",src:(0,h.ck)("5b8af9ed88cb76b20858a7a8ac9fed784e5cbeb7"),alt:(0,b.t)("cross_sell.mobile_app_prompt.comment_image_alt_text")},description:(0,b.t)("mobile_download_prompts.join_team_conversations"),isLoading:!1,layoutStyle:"app",mainButtonTitle:(0,b.t)("mobile_download_prompts.email_me"),onCtaClick:()=>{f.Ay.post("/api/send_mobile_download_email",{type:"comment"}),e(C.F.enqueue({message:(0,b.t)("rcs.mobile_comment_reply_upsell.email_sent")})),e(M.b({seen_mobile_comment_announcement:!0}))},title:(0,b.t)("mobile_download_prompts.meet_your_team"),trackingContextName:"Mobile App Comments Announcement",trackingDisabled:!0,userFlagName:"seen_mobile_comment_announcement"})},panelName:"Comments",additionalDisplayBlocker:({userAnalyticsData:e,userFlags:t,selectedView:n})=>!(0,c.kc)().mobile_download_comment_sidebar||e?.is_active_mobile_user||!!t.seen_mobile_comment_download_modal_prompt||(0,Z.$A)(n)},{userFlagName:"dev_mode_dismissed_properties_panel_announcement",AnnouncementComponent:function({userFlagName:e,lifecycle:t}){let n=(0,r.wA)(),i=(0,G.U)("announcement"),s="dark"===(0,S.DP)(),a=()=>{t?(0,D._Z)(t):n(M.b({[e]:!0}))},{assetSrc:d,backgroundColor:c,imageNoPaddingTop:u}=s?em:eu;return(0,o.jsx)(el,{asset:{type:"image",src:d,alt:(0,b.t)("inspect_panel.code.promo_image_alt"),bg:c,noPaddingTop:u},description:(0,b.t)("inspect_panel.properties.dev_mode_upsell_message"),layoutStyle:"brand",mainButtonOverride:(0,o.jsx)("div",{className:_.s.wFull.$,children:(0,o.jsx)(l.J,{brand:"dev-handoff",children:(0,o.jsx)(x.lR,{variant:"primary",onClick:()=>{a(),i("handoff")},children:(0,b.t)("dev_handoff.paywall.blocking_modal.button.request_access")})})}),onDismiss:a,title:(0,b.tx)("dev_handoff.paywall.banner.title"),trackingContextName:"Dev Mode announcement",userFlagName:e})},panelName:"Inspect",lifecycle:{userFlagName:"dev_mode_dismissed_properties_panel_announcement",maxTimes:3,cooldown:"MONTH_AND_A_HALF"},additionalDisplayBlocker:({selectedView:e,isRecovery:t,isReadOnly:n,canAccessDevMode:o})=>!function({isDevHandoffView:e,isRecovery:t,isReadOnly:n,canAccessDevMode:o}){return!t&&n&&!o&&!e}({isDevHandoffView:(0,Z.$A)(e),isRecovery:t,isReadOnly:n,canAccessDevMode:o})},{userFlagName:P,AnnouncementComponent:function(){let{filteredSidebarItems:e}=i.useContext(w.hh);return 0===i.useMemo(()=>"loaded"===e.status&&e.data||[],[e]).length?null:(0,o.jsx)(j.u,{className:"dev_handoff_comments_panel_slack_teams_hint--hintPanel--cjNDL",idForTests:"hintFigmaForSlackTeams",userFlag:P,title:(0,b.t)("dev_handoff.comments_panel.slack_teams_hint.title"),icon_DEPRECATED:k.A,hintText:(0,b.tx)("dev_handoff.comments_panel.slack_teams_hint",{figmaForSlackLink:(0,o.jsx)(y.N,{href:"https://figma.slack.com/apps/A01N2QYSA81-figma-and-figjam?tab=more_info",newTab:!0,trusted:!0,children:(0,b.tx)("dev_handoff.comments_panel.slack_teams_hint.slack_link")}),figmaForTeamsLink:(0,o.jsx)(y.N,{href:"https://appsource.microsoft.com/en-us/product/office/WA200004521?exp=ubp8",newTab:!0,trusted:!0,children:(0,b.tx)("dev_handoff.comments_panel.slack_teams_hint.teams_link")})})})},panelName:"Comments",additionalDisplayBlocker:({selectedView:e})=>!(0,Z.$A)(e)},{userFlagName:T.xb,AnnouncementComponent:T.FO,panelName:"Handoff",additionalDisplayBlocker:({userFlags:e})=>!e.dev_handoff_seen_config_wizard||eh(e.dev_handoff_seen_config_wizard.updatedAt,3)<ef},{userFlagName:"dev_mode_demo_file_props_panel_upsell_dismissed",AnnouncementComponent:function(){let e=(0,r.wA)(),t=(0,h.tl)().dev_mode_demo_file_key;return t?(0,o.jsx)(el,{asset:{type:"image",src:(0,h.ck)("0381fb8f01b5e71da6e1f3d65e2bab6be47de673"),alt:(0,b.t)("inspect_panel.code.promo_image_alt")},description:(0,b.t)("dev_mode_demo_file.check_out_our_interactive_test"),layoutStyle:"brand",mainButtonOverride:(0,o.jsx)(l.J,{brand:"dev-handoff",children:(0,o.jsx)(x.lR,{variant:"primary",onClick:()=>{t&&p.Ay.redirect((0,U.jN)({file:{key:t},isDevHandoff:!0}),"_blank"),e(M.b({dev_mode_demo_file_props_panel_upsell_dismissed:!0}))},children:(0,b.t)("dev_mode_playground_file.try_it_now")})}),title:(0,b.tx)("dev_mode_playground_file.want_to_try_dev_mode"),trackingContextName:"Dev Mode Demo Props Upsell",userFlagName:"dev_mode_demo_file_props_panel_upsell_dismissed"}):null},panelName:"Inspect",additionalDisplayBlocker:({userFlags:e,isEngineer:t,canAccessDevMode:n,plan:o})=>!e.dev_mode_dismissed_properties_panel_announcement||n||!t||o?.tier===V.Ag.STARTER}],e_=(0,u.eU)(e=>{let t={};return eg.forEach(n=>{n.lifecycle&&(t[n.userFlagName]=e((0,D.eC)(n.lifecycle)))}),t});function ev(e){let t=(0,F.q5)(),n=t?.editorType,l=(0,H.S2)().unwrapOr(null),h=l?.figjamDisabledAt||null,f=(0,r.d4)(e=>e.userFlags),_=(0,u.md)(e_),x=(0,B.iZ)(),C=(0,r.d4)(e=>e.userAnalyticsData),y=(0,r.d4)(e=>e.selectedView),w=x?.created_at,j=(0,m.A)(w).add(14,"day").isSameOrAfter((0,m.A)()),k=(0,N.k)(),P=(0,g.WN)(),T=i.useMemo(()=>"prototype"===y.view?void 0:d.Ez5,[y.view]),E=(0,q.ut)(T?.uiState().isRecovery,!1),M="developer"===(0,L.w)(),A=(0,I._I)(),{folderId:S}=ep(t),{data:O,status:R}=(0,v.nt)(S),U=l?.tier===V.Ag.STARTER&&!(0,c.kc)().bake_starter_limit,z=null!==O&&(0,v.d6)(O,V._Y.FIGMAKE)&&!U,Z={Prototype:"loading"===R},G={};if(k)return(0,o.jsxs)("div",{className:"announcement--loggedOutSignupCta--qrt2V",children:[(0,o.jsx)(a.f,{}),(0,b.t)("auth.create_account_to_view_reply_comments"),(0,o.jsx)(s.$n,{variant:"link",onClick:()=>P("SIGN_UP_CTA_COMMENTS_PANEL"),children:(0,b.t)("auth.sign_up")})]});if(n===V._Y.WHITEBOARD||n===V._Y.SLIDES||"fullscreen"!==y.view||null!=h||j||"Comments"===e.panelName&&"fullscreen"===y.view&&n===V._Y.DESIGN&&f.claimed_invite_with_pending_user_mention&&!f.has_closed_comment&&p.Ay.location.hash)return null;let K=Date.now()-2592e5;if(eg.some(e=>{let t=f[e.userFlagName];return!!t&&t.updatedAt>new Date(K)}))return null;let X=eg.find(n=>{if(ed||n.panelName!==e.panelName||Z[e.panelName])return!1;if(n.lifecycle){let e=_[n.userFlagName];if(e?.status!=="loaded"||(0,D.$1)({...e.data,lifecycleConfig:n.lifecycle}))return!1}let o=f[n.userFlagName];return(!!n.lifecycle||!o)&&!n.additionalDisplayBlocker?.({currentUser:x,openFile:t,userAnalyticsData:C,userFlags:f,selectedView:y,isRecovery:E,isEngineer:M,isReadOnly:!t?.canEdit,canAccessDevMode:A,experiments:G,plan:l,canCreateFigmakeFileInTargetFolder:z})});if(X){let e=X.AnnouncementComponent;return(0,o.jsx)(e,{userFlagName:X.userFlagName,lifecycle:X.lifecycle})}return null}},548852:(e,t,n)=>{n.d(t,{T:()=>A,w:()=>M});var o=n(104076),i=n(716976),r=n(903927),s=n(276800),a=n(812714),l=n(795033),d=n(883765),c=n(432099),u=n(192075),m=n(58212),p=n(90844),h=n(422872),f=n(477536),g=n(235711),_=n(143277),v=n(856520),x=n(739801),b=n(10411),C=n(441030),y=n(755444),w=n(659062),j=n(920712),k=n(781018);function P(){return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{style:w.sx.add({backgroundColor:"#5551ff"}).$,children:(0,o.jsx)(j.Gv,{src:(0,y.ck)("a553882986986c96fc7d298a674e9e0522d05b53"),width:"100%"})}),(0,o.jsx)(j.ak,{children:(0,u.tx)("rcs.mobile_comment_reply_upsell_page1.description")})]})}function I(){return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{style:w.sx.flex.alignCenter.wFull.borderBox.p18.h200.add({backgroundColor:"#5551ff"}).$,children:(0,o.jsx)(k.T,{})}),(0,o.jsx)(j.ak,{children:(0,u.tx)("rcs.mobile_comment_reply_upsell_page2.description")})]})}let T="dismissed_mobile_replies_upsell",E=(0,g.r1)(T),M="commentSubmitted";function A(){let e=(0,l.md)(E),t=(0,r.d4)(e=>e.userAnalyticsData?.is_active_mobile_user),n=(0,h.e)({overlay:C.$T1,priority:_.N.DEFAULT_MODAL},[e]);(0,p.E)(n.uniqueId,M,(0,i.useCallback)(()=>{!t&&(0,a.kc)().mobile_reply_upsell&&n.show({canShow:e=>!e})},[t,n]));let g=(0,f.A)({numSteps:2,onComplete:n.complete}),y=(0,i.useCallback)(e=>({onClickBehavior:"function",label:e,onClick:e=>{c.Ay.post("/api/send_mobile_download_email"),(0,d.sx)("post_comment_mobile_app_download_prompt_email_me_cta_clicked"),n.complete(),e(m.F.enqueue({message:(0,u.t)("rcs.mobile_comment_reply_upsell.email_sent")}))},textForTracking:()=>e}),[n]),w=(0,i.useMemo)(()=>[{element:P,additionalButton:y((0,u.t)("rcs.mobile_comment_reply_upsell.email_me")),ctaText:(0,u.t)("rcs.mobile_comment_reply_upsell.download_via_qr_code"),ctaOnClick:()=>{(0,d.sx)("post_comment_mobile_app_download_prompt_qr_code_cta_clicked")},onManualDismiss:()=>{(0,d.sx)("post_comment_mobile_app_download_prompt_dismissed")}},{element:I,additionalButton:y((0,u.t)("rcs.mobile_comment_reply_upsell.email_me_instead")),ctaText:(0,u.t)("rcs.rcs_shared.done"),ctaOnClick:s.lQ,onManualDismiss:s.lQ}],[y]),j=(0,i.useMemo)(()=>w.map((e,t)=>(0,o.jsx)(x.h,{additionalButton:e.additionalButton,ctaText:e.ctaText,currentStepIndex:t,defaultLocation:b.LN.BOTTOM_RIGHT,element:e.element,hideStepCounter:!0,isShowing:n.isShowing,modalType:b.q3.DRAGGABLE,onClickPrimaryCta:()=>{g.next(),e.ctaOnClick()},onClose:s.lQ,onManualDismiss:()=>{n.complete(),e.onManualDismiss()},title:()=>(0,u.t)("rcs.mobile_comment_reply_upsell.title"),totalNumSteps:2,trackingContextName:"mobile_reply_upsell",userFlagOnShow:T},t)),[w,n,g]);return(0,o.jsx)(v.U,{currentStep:g.currentStep,isShowing:n.isShowing,children:j})}},781018:(e,t,n)=>{n.d(t,{T:()=>s});var o=n(104076),i=n(755444),r=n(659062);function s(){return(0,o.jsxs)("div",{style:r.sx.flex.columnGap32.flexRow.alignCenter.justifyCenter.wFull.$,children:[(0,o.jsx)("img",{alt:"Android QR code",src:(0,i.ck)("259b16f36c4afa958c6185b07e9b78f3e2b4cc4d")}),(0,o.jsx)("img",{alt:"IOS QR code",src:(0,i.ck)("d32c8c72eda223d979ca672dacb3ead939ac63a3")})]})}},323440:(e,t,n)=>{n.d(t,{F:()=>Z});var o=n(104076),i=n(903927),r=n(638004),s=n(420680),a=n(423128),l=n(790009),d=n(812714),c=n(511570),u=n.n(c),m=n(716976);function p(e){let{className:t,maxWidth:n,dep:i,children:r}=e,s=(0,m.useRef)(null),a=(0,m.useRef)(null);return(0,m.useLayoutEffect)(()=>{if(!s.current||!a.current)return;s.current.style.width="unset";let e=Math.ceil(a.current.getBoundingClientRect().width);s.current.style.width=`${e}px`},[i]),(0,o.jsx)("div",{className:t,ref:s,style:{maxWidth:n},children:(0,o.jsx)("span",{ref:a,children:r})})}var h=n(352630),f=n(192075),g=n(542663),_=n(351625),v=n(549571),x=n(366535),b=n(459494),C=n(244205),y=n(111297),w=n(819851),j=n(75923),k=n(225417),P=n(211862),I=n(215853),T=n(795033);n(120440);var E=n(911990),M=n(142914),A=n(171660),S=n(871898),N=n(502907),D=n(649693),O=n(781611),R=n(377026),L=n(563554),F=n(19233),B=n(813166),U=n(846935);function V({roleRequests:e,upgradeRequests:t,markRequestsAsRead:n,editRequestPermissionsData:s}){let d=(0,i.wA)(),c=(0,P.tS)(),u=(0,g.L)(r.e.MONETIZATION_EXPANSION),m=s.file?.key??c,p=e[0],_=(0,T.Xr)(U._),v=new Set([...e.map(e=>e.requesterUserId),...t.map(e=>e.userId)]).size;if(0===v)return null;let b=e[0]?.requesterUser??t[0]?.user;if(!b)return null;let w=1===v&&t.length&&!!t[0],j=w?t[0]:void 0,I=j&&(0,D.a_)((0,O.Zx)(j.request?.billableProductKey??"view"))?(0,O.Zx)(j.request?.billableProductKey??"view"):D.Gu.VIEW,V=null;if(1===e.length&&p&&p.requesterUser&&0===t.length){let{id:e,level:t,requesterUserId:n,requesterUser:i}=p,{handleApprove:r,handleDeny:a}=(0,F.iF)(d,s,"file-and-seat-requests-tooltip",!0)({roleRequestId:e,requestType:t,handle:i.handle}),l={fileKey:c,userId:n,fileRoleRequestId:e,requestType:(0,F.aD)(t)};V=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(h.$z,{trackingOptions:u,trackingProperties:{...l,trackingDescriptor:C.c.DECLINE},onClick:a,variant:"destructiveSecondary",children:(0,f.t)("file_request_tooltip.decline")}),(0,o.jsx)(h.$z,{trackingOptions:u,trackingProperties:{...l,trackingDescriptor:C.c.APPROVE},onClick:r,variant:"primary",children:(0,f.t)("file_request_tooltip.approve")})]})}else m&&(V=(0,o.jsx)(h.$z,{trackingOptions:u,trackingProperties:{numFileRoleRequests:e.length,numUpgradeRequests:t.length,fileKey:m,trackingDescriptor:C.c.REVIEW,upgradeRequestId:j?.id??void 0,upgradeRequestUserId:j?.userId??void 0},variant:"secondary",onClick:()=>{w&&_(t[0]),d((0,x.to)({type:B.g_,data:{fileKey:m,source:k.nk.editRequestTooltip,tabToOpen:w?R.A5.APPROVE_SEAT_REQUEST:R.A5.REQUESTS}}))},children:(0,f.t)("file_request_tooltip.review")}));let q=(e=(0,f.t)("user_notifications.community.someone"))=>(0,o.jsx)(A.E,{color:"onbrand",fontWeight:"bold",truncate:!0,children:e.length<=18?e:`${e.slice(0,18).trim()}...`}),H=q(b.handle);v>1&&(H=(0,o.jsx)(A.E,{color:"onbrand",fontWeight:"regular",truncate:!0,children:(0,f.tx)("file_request_tooltip.and",{userHandle:q(b.handle),othersText:(0,o.jsx)(A.E,{color:"onbrand",fontWeight:"bold",children:(0,f.t)("file_request_tooltip.other_people",{numOthers:v-1})})})}));let z=w&&I!==D.Gu.VIEW?(0,f.t)("file_request_tooltip.wants_a_seat_to_edit",{seatType:(0,N.JT)(I)}):(0,f.t)("file_request_tooltip.wants_to_edit",{numUsers:v});return(0,o.jsx)(y.fu,{name:L.e0.FILE_ROLE_AND_SEAT_REQUESTS_TOOLTIP,trackingOptions:u,children:(0,o.jsx)(l.J,{mode:"dark",children:(0,o.jsxs)(E.Y,{direction:"horizontal",verticalAlignItems:"center",padding:0,spacing:8,height:32,children:[(0,o.jsxs)("div",{className:"x1n2onr6 xvy4d1p xxk0z11",children:[(0,o.jsx)(M.H8,{user:{...b,email:b.email??""},size:24}),w?(0,o.jsx)("div",{className:"x10l6tqk x1kky2od xgzdjil xsugpx9 x16rqkct x1vjfegm x1yjdb4r",children:(0,o.jsx)(S.B,{type:I,removeBackgroundColor:!0,size:"16"})}):(0,o.jsx)("div",{className:"x10l6tqk x13vifvy x3m8u43 x1v4s8kt xols6we xorixrz xw84gpf"})]}),(0,o.jsxs)(E.Y,{direction:"vertical",height:32,spacing:0,children:[H,(0,o.jsx)(A.E,{color:"onbrand-secondary",truncate:!0,children:z})]}),(0,o.jsx)(E.Y,{direction:"horizontal",width:"auto",horizontalAlignItems:"center",verticalAlignItems:"center",spacing:8,children:V}),(0,o.jsx)("div",{className:"x1kz6nyh xe0pwq x19ypqd9",children:(0,o.jsx)(E.Y,{direction:"horizontal",verticalAlignItems:"center",height:48,padding:{left:8},children:(0,o.jsx)(h.Me,{onClick:()=>n(!0),"aria-label":(0,f.t)("file_request_tooltip.close"),trackingProperties:{trackingDescriptor:C.c.CLOSE},trackingOptions:u,children:(0,o.jsx)(a.A,{})})})})]})})})}var q=n(619348);let H="edit_request_tooltip--avatar--RW6OW",z="edit_request_tooltip--buttonContainer--h3Mpx";function Z({target:e,windowPadding:t,trackingProperties:n}){let i=(0,q.Bj)(500),r=(0,b.dI)(),{unreadFileRoleRequests:s,unreadUpgradeRequests:a,markRequestsAsRead:l}=(0,q.lf)(),d=(0,q.c4)(s.slice(0,2)),c=(0,j.RC)(),u=(0,w.m0)(),m=(0,v._I)();return i&&d&&(0!==s.length||0!==a.length&&r())&&c&&(!u||m)?(0,o.jsx)(G,{target:e,unreadFileRoleRequests:s,unreadUpgradeRequests:a,markRequestsAsRead:l,editRequestPermissionsData:c,windowPadding:t,trackingProperties:n}):null}function G({target:e,unreadFileRoleRequests:t,unreadUpgradeRequests:n,markRequestsAsRead:i,editRequestPermissionsData:s,windowPadding:a,trackingProperties:l}){let d=(0,q.ic)(e),c=(0,b.dI)(),u=(0,g.L)(r.e.MONETIZATION_EXPANSION);return d?(0,o.jsx)(y.fu,{name:"Edit Request Tooltip",properties:l,trackingOptions:u,children:(0,o.jsx)(I.Cf,{className:"edit_request_tooltip--tooltipContainer--rhLGf",targetRect:d,disableDropdownScrollContainer:!0,propagateCloseClick:!0,windowPadding:a,maxWidth:1e3,children:n&&c()?(0,o.jsx)(V,{roleRequests:t,upgradeRequests:n,markRequestsAsRead:i,editRequestPermissionsData:s}):(0,o.jsx)(K,{requests:t,markRequestsAsRead:i,editRequestPermissionsData:s})},t.length+"-"+n?.length)}):null}function K({requests:e,markRequestsAsRead:t,editRequestPermissionsData:n}){return(0,o.jsx)(l.J,{mode:"dark",children:(0,o.jsxs)("div",{className:"edit_request_tooltip--contentContainer--IClWV","data-testid":"edit-request-tooltip",children:[(0,o.jsx)(X,{requests:e}),(0,o.jsx)(W,{requests:e}),(0,o.jsx)(Q,{requests:e,editRequestPermissionsData:n}),(0,o.jsx)(s.K,{onClick:()=>t(!0),"aria-label":(0,f.t)("general.close"),children:(0,o.jsx)(a.A,{})})]})})}function X({requests:e}){let t=e.length<=2?e.length:1,n=e.length-t;return(0,o.jsxs)("div",{className:"edit_request_tooltip--avatarContainer--wTOHq",children:[e.slice(0,t).map((e,t)=>(0,o.jsx)(_.e,{adtlClassName:H,size:24,entity:{id:e.requesterUserId,name:e.requesterUser?.handle,img_url:e.requesterUser?.imgUrl},style:{zIndex:-t}},e.id)),n>0&&(0,o.jsx)(_.e,{adtlClassName:u()(H,"edit_request_tooltip--avatarRemainder--AP7l3"),size:24,entity:{id:"-1",name:n.toString()},style:{zIndex:-t}})]})}function W({requests:e}){let t=(e=(0,f.t)("user_notifications.community.someone"))=>(0,o.jsx)("b",{children:e.length<=18?e:`${e.slice(0,18).trim()}...`}),n=(()=>{switch(e.length){case 1:return(0,f.tx)("role_request.edit_request_tooltip.user_wants_to_request_type",{userHandle:t(e[0].requesterUser?.handle),requestType:(0,F.zg)(e[0].level)});case 2:return(0,f.tx)("role_request.edit_request_tooltip.user1_and_user2_request_access",{userHandle1:t(e[0].requesterUser?.handle),userHandle2:t(e[1].requesterUser?.handle)});default:return(0,f.tx)("role_request.edit_request_tooltip.user_and_others_request_access",{userHandle:t(e[0].requesterUser?.handle),othersText:(0,o.jsx)("b",{children:(0,f.tx)("role_request.edit_request_tooltip.othersText",{numOthers:e.length-1})})})}})(),i=1===e.length?137:158;return(0,o.jsx)(p,{className:"edit_request_tooltip--textContainer--OU1YR",maxWidth:i,dep:e,children:(0,d.kc)().edit_request_reformat?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{children:(()=>{switch(e.length){case 1:return t(e[0].requesterUser?.handle);case 2:let n=t(e[0].requesterUser?.handle),i=t(e[1].requesterUser?.handle);if(e[0].requesterUser?.handle.length&&e[1].requesterUser?.handle.length&&e[1].requesterUser?.handle.length+e[0].requesterUser?.handle.length>18)return(0,f.tx)("role_request.edit_request_tooltip.user1_and_user2",{userHandle1:t(e[0].requesterUser?.handle),userHandle2:(0,o.jsx)("b",{children:(0,f.tx)("role_request.edit_request_tooltip.othersText",{numOthers:e.length-1})})});return(0,f.tx)("role_request.edit_request_tooltip.user1_and_user2",{userHandle1:n,userHandle2:i});default:return(0,f.tx)("role_request.edit_request_tooltip.user1_and_user2",{userHandle1:t(e[0].requesterUser?.handle),userHandle2:(0,o.jsx)("b",{children:(0,f.tx)("role_request.edit_request_tooltip.othersText",{numOthers:e.length-1})})})}})()}),(0,o.jsx)("div",{children:(()=>{if(1!==e.length)return(0,f.tx)("role_request.edit_request_tooltip.request_access");{let t=(0,F.zg)(e[0].level);return(0,f.tx)("role_request.edit_request_tooltip.wants_to_request_type",{requestType:t})}})()})]}):(0,o.jsx)(o.Fragment,{children:n})})}function Q({requests:e,editRequestPermissionsData:t}){let n=(0,i.wA)(),s=(0,P.tS)(),a=t.file?.key??s,l=(0,g.L)(r.e.MONETIZATION_EXPANSION),d=e[0];return 1===e.length&&d&&d.requesterUser?(0,o.jsx)("div",{className:z,children:(0,o.jsx)(J,{id:d.id,level:d.level,requesterUserId:d.requesterUserId,userHandle:d.requesterUser.handle,editRequestPermissionsData:t})}):a?(0,o.jsx)("div",{className:z,children:(0,o.jsx)(h.$z,{trackingOptions:l,trackingProperties:{numFileRoleRequests:e.length,trackingDescriptor:C.c.VIEW_SHARE_MODAL},onClick:()=>{a&&n((0,x.to)({type:B.g_,data:{fileKey:a,source:k.nk.editRequestTooltip}}))},variant:"secondary",children:(0,f.tx)("role_request.edit_request_tooltip.view_button_text")})}):null}function J(e){let{id:t,level:n,requesterUserId:s,userHandle:a,editRequestPermissionsData:l}=e,d=(0,g.L)(r.e.MONETIZATION_EXPANSION),c=(0,i.wA)(),u=(0,P.tS)(),{handleApprove:m,handleDeny:p}=(0,F.iF)(c,l,"edit-request-tooltip")({roleRequestId:t,requestType:n,handle:a}),_={fileKey:u,userId:s,fileRoleRequestId:t,requestType:(0,F.aD)(n)};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(h.$z,{trackingOptions:d,trackingProperties:{..._,trackingDescriptor:C.c.DENY},trackingEventName:"Edit Request Tooltip - Request Denied",onClick:p,variant:"destructiveLink",children:(0,f.tx)("request_row.deny")}),(0,o.jsx)(h.$z,{trackingOptions:d,trackingProperties:{..._,trackingDescriptor:C.c.APPROVE},onClick:m,variant:"secondary",children:(0,f.tx)("request_row.approve")})]})}},619348:(e,t,n)=>{n.d(t,{Bj:()=>f,c4:()=>b,ic:()=>g,lf:()=>x});var o=n(716976),i=n(903927),r=n(638004),s=n(550209),a=n(75923),l=n(74620),d=n(592726),c=n(457975),u=n(490279),m=n(610029);let p="read-file-requests",h="read-upgrade-requests";function f(e){let[t,n]=(0,o.useState)(!1),i=(0,l.aV)();return(0,o.useEffect)(()=>{if(i)return;let t=setTimeout(()=>n(!0),e);return()=>clearTimeout(t)},[i,e]),t}function g(e){let[t,n]=(0,o.useState)(),i=(0,l.aV)();return(0,o.useLayoutEffect)(()=>{if(i)return;let t=()=>{let t=e.getBoundingClientRect(),o=new DOMRect(t.left,t.top,t.width,t.height);o.x+=6,o.y+=6,n(o)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[i,e]),t}function _(e,t,n,i){let a=(0,d.TA)(),l=function(e){try{return new Set(JSON.parse(localStorage.getItem(e)??"[]"))}catch(t){return(0,s.$D)(r.e.MONETIZATION_EXPANSION,Error(`Failed to parse read file requests from storage: ${t}`)),localStorage.removeItem(e),null}}(t);return(0,o.useMemo)(()=>null===l?[]:e.filter(e=>!l.has(e.id)&&n(e)!==a),[e,l,a,n,i])}function v(e,t){let n=new Set(e.map(e=>e.id));localStorage.setItem(t,JSON.stringify([...n]))}function x(){let[e,t]=(0,o.useState)(0),n=(0,a.Yx)(),r=(0,c.U)(),s=(0,i.d4)(e=>e.modalShown?.type===u.j),l=_(n,p,e=>e.requesterUserId,e),d=_(r,h,e=>e.userId,e),m=(0,o.useCallback)(e=>{v(n,p),v(r,h),e&&t(e=>e+1)},[n,r]);return(0,o.useEffect)(()=>{s&&(l.length>0||d.length>0)&&m(!0)},[s,m,l.length,d.length]),{unreadFileRoleRequests:l,unreadUpgradeRequests:d,markRequestsAsRead:m}}function b(e){let t=e.map(e=>e.requesterUser?.imgUrl??null),n=0===e.length;return(0,m.x)(n,t)}},782803:(e,t,n)=>{n.d(t,{s:()=>u});var o=n(104076),i=n(716976),r=n(812714),s=n(858959),a=n(561839),l=n(328341),d=n(565854),c=n(228439);function u({featured:e,quickAccess:t,onUserClick:n,maxVisibleUsers:u,totalUserCount:m}){let p={ease:"easeOut",duration:.15},h=t.filter(t=>t.sessionID!==e?.sessionID);h.reverse();let f=h.length+(e?1:0),g=d.pl,_=Math.min(u,h.length+(e?1:0))*g,v=(0,l.ZC)(m);v&&m!==v&&(p.duration=.3);let x=(0,i.useCallback)(e=>{if(0===e)return"multiplayer-observation-nux-key"},[]),b=(0,r.kc)().spotlight_disable_fade?1:.5,C=e&&(0,o.jsx)(s.P.span,{initial:{opacity:0,scale:b},animate:{opacity:1,scale:1},exit:{opacity:0,scale:b},transition:p,style:{pointerEvents:"all"},children:(0,o.jsx)(c.Q,{user:e,isOverflow:!1,onUserClick:n,hasBorder:!0})}),y=h.map((e,t)=>(0,o.jsx)(s.P.span,{style:{marginLeft:"-8px",pointerEvents:"all"},initial:{opacity:0,scale:b},animate:{opacity:1,scale:1},transition:p,layout:"position",children:(0,o.jsx)(c.Q,{onboardingKey:x(t),user:e,isOverflow:!1,onUserClick:n,hasBorder:!0})},e.sessionID));return(0,o.jsx)("div",{style:{width:_,clipPath:void 0,position:"relative",height:"100%",pointerEvents:"none"},"data-onboarding-key":"multiplayer-avatars",children:(0,o.jsx)(s.P.div,{style:{width:u*g,position:"absolute",right:"-8px",display:"flex",flexDirection:"row-reverse",justifyContent:f>u!=!0?"flex-start":"flex-end"},layout:!0,layoutRoot:!0,children:(0,o.jsx)(a.N,{initial:!1,mode:"popLayout",children:(0,o.jsxs)(o.Fragment,{children:[y,C]})})})})}},814664:(e,t,n)=>{n.d(t,{n:()=>i});let o=new(n(150156)).KH({keys:["name"],threshold:.1});function i(e,t){return o.set(t),o.search(e)}},819574:(e,t,n)=>{n.d(t,{$:()=>d});var o=n(104076),i=n(511570),r=n.n(i),s=n(449572),a=n(111297),l=n(59849);function d({fileKey:e,isLegacyPosition:t}){let n=0,i=(0,s.Rs)(l.OCJ,{fileKey:e});if(i&&"loaded"===i.status&&i.data.file?.fileRoleRequests&&(n=i.data.file.fileRoleRequests.length),0===n)return null;let d=r()("badge--shareButtonBadge--zXKJj",{"badge--legacyPosition--58g-I":t});return(0,o.jsx)(a.fu,{name:"Share Button Badge",properties:{numRequests:n},children:(0,o.jsx)("div",{className:d})})}},263222:(e,t,n)=>{n.d(t,{r:()=>r});var o=n(104076),i=n(340063);function r(){return(0,o.jsx)("div",{className:"open_sessions_icon--container--Lveob","data-testid":"openSessionsIcon",children:(0,o.jsx)(i.I,{})})}},428758:(e,t,n)=>{n.d(t,{q:()=>A});var o=n(104076),i=n(716976),r=n(795033),s=n(949701),a=n(449572),l=n(236631),d=n(352630),c=n(192075),u=n(142914),m=n(260745),p=n(459494),h=n(111297),f=n(819851),g=n(958251),_=n(657878),v=n(59849),x=n(382137),b=n(946996),C=n(113139);let y=new class{notifyViewerRestrictedDraftShared(e){return C._5.validate(({xr:t})=>t.put(`/api/viewer_restricted_draft/${e}/notify`))}dismissViewerRestrictedDraftShared(e){return C._5.validate(({xr:t})=>t.put(`/api/viewer_restricted_draft/${e}/dismiss`))}};var w=n(215853),j=n(619348),k=n(864813),P=n(213733),I=n(227180),T=n(373224);function E(){return(0,o.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",className:"shared_vr_draft_tooltip--svg--6colb",children:[(0,o.jsx)("path",{d:"M16 8C16 12.4183 12.4183 16 8 16C3.58172 16 0 12.4183 0 8C0 3.58172 3.58172 0 8 0C12.4183 0 16 3.58172 16 8Z",fill:"#FFCD29"}),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.30796 4.53016V9.09594H8.6777V4.53016H7.30796Z",fill:"black"}),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.9925 10.2382C8.49683 10.2382 8.90566 10.6471 8.90566 11.1514V11.214C8.90566 11.7183 8.49683 12.1272 7.9925 12.1272C7.48818 12.1272 7.07935 11.7183 7.07935 11.214V11.1514C7.07935 10.6471 7.48818 10.2382 7.9925 10.2382Z",fill:"black"})]})}let M=[k.D.type,I.HY.type,P.t.type];function A({file:e,target:t}){let n=(0,j.Bj)(500),i=(0,f.m0)(),l=(0,a.Rs)(v.lrh,{fileKey:e.key,orgId:e.parentOrgId||null,teamId:e.teamId||null}),d=(0,g.wR)(e.editorType),{handleUpgrade:c,getUpgradeEligibility:u}=(0,x.wH)({entryPoint:m.tc.IN_EDITOR_RESTRICTED_DRAFT}),p=(0,r.md)(_.yF);if(p&&M.includes(p)||!n||"loaded"!==l.status)return null;let h=(0,s.oA)(l.data.viewerRestrictedDraftAccessLog);if(!h||i||!e.parentOrgId&&!e.teamId||!l.data.file?.isDraftFile)return null;let C=l.data.currentUser?.baseOrgUser,y=l.data.currentUser?.teamUser;if(!(e.parentOrgId?C:y)||h.dismissedAt||u(d)!==b.q.CAN_UPGRADE)return null;let w=h.viewerUser?.name,k=c({licenseType:d,upgradeReason:T.i.DRAFTS_SHARE,entryPoint:m.tc.IN_EDITOR_RESTRICTED_DRAFT});return(0,o.jsx)(S,{target:t,viewerUserName:w,file:e,orgUser:C,teamUser:y,handleUpgrade:k})}function S({target:e,viewerUserName:t,file:n,orgUser:r,teamUser:s,handleUpgrade:a}){let u=(0,j.ic)(e),m=(0,p.Xt)(!!r),[f,g]=(0,i.useState)(!1);if(!m||f||!u)return null;let _=r?.org??s?.team;if(!_)return null;let v=()=>{y.dismissViewerRestrictedDraftShared(n.key),g(!0)},x=(0,c.tx)("viewer_restricted_tooltip.teammates_cant_access_this_file"),b=t?(0,c.tx)("viewer_restricted_tooltip.to_collaborate_in_this_draft",{fileOpenerName:t}):(0,c.tx)("viewer_restricted_tooltip.to_collaborate_in_this_draft_no_name");return(0,o.jsx)(h.fu,{name:"VR Draft Share Notification Tooltip",children:(0,o.jsx)(w.Cf,{targetRect:u,disableDropdownScrollContainer:!0,showPoint:!0,propagateCloseClick:!0,maxWidth:384,children:(0,o.jsxs)("div",{className:l.s.flex.flexRow.gap14.mb4.mt4.ml8.mr8.$,"data-testid":"SharedVrDraftTooltipView",children:[(0,o.jsx)(N,{plan:_}),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:l.s.colorTextOnbrand.fontBold.$,children:x}),(0,o.jsx)("div",{className:l.s.colorTextOnbrandSecondary.mt2.$,children:b}),(0,o.jsxs)("div",{className:l.s.flex.flexRow.mt8.gap8.$,children:[(0,o.jsx)(d.e6,{className:"shared_vr_draft_tooltip--ignoreButton---wVA0",onClick:v,children:(0,c.tx)("viewer_restricted_tooltip.ignore")}),(0,o.jsx)(d.lR,{variant:"primary",type:"submit",onClick:e=>{g(!0),a(e),v()},children:(0,c.tx)("viewer_restricted_tooltip.get_upgraded_seat")})]})]})]})})})}function N({plan:e}){let t={imgUrl:e.imgUrl??void 0,id:e.id,name:e.name};return(0,o.jsxs)("div",{className:"shared_vr_draft_tooltip--svgContainer--SousN",children:[(0,o.jsx)(u.nl,{team:t,size:u.Pf.LARGE}),(0,o.jsx)(E,{})]})}},809635:(e,t,n)=>{n.d(t,{W:()=>o});let o=`data:image/svg+xml;utf8,<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M15 23L18 9L17.0222 8.79047L14.0222 22.7905L15 23ZM12.304 12.2072L8.414 16.0962L12.303 19.9852L11.596 20.6922L7 16.0962L7.354 15.7432L11.596 11.5002L12.304 12.2072ZM24.546 15.7432L20.304 11.5002H20.303L19.596 12.2072L23.486 16.0962L19.596 19.9852L20.303 20.6922L24.9 16.0962L24.546 15.7432Z" fill="black" fill-opacity="0.3"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M5.92869 31.7293L6.18693 30.7632C6.7641 30.9175 7.37164 31 8 31H9.77778V32H8C7.28368 32 6.58934 31.9059 5.92869 31.7293ZM22.2222 32V31H24C24.6284 31 25.2359 30.9175 25.8131 30.7632L26.0713 31.7293C25.4107 31.9059 24.7163 32 24 32H22.2222ZM28.0006 30.9294L27.4998 30.0638C28.5625 29.449 29.449 28.5625 30.0638 27.4998L30.9294 28.0006C30.227 29.2147 29.2147 30.227 28.0006 30.9294ZM32 9.77778H31V8C31 7.37164 30.9175 6.7641 30.7632 6.18693L31.7293 5.9287C31.9059 6.58934 32 7.28368 32 8V9.77778ZM30.9294 3.99936L30.0638 4.50017C29.449 3.43754 28.5625 2.55101 27.4998 1.93619L28.0006 1.07063C29.2147 1.77305 30.227 2.78535 30.9294 3.99936ZM9.77778 0H8C7.28368 0 6.58934 0.0941465 5.9287 0.270741L6.18693 1.23682C6.7641 1.08254 7.37164 1 8 1H9.77778V0ZM3.99936 1.07063L4.50017 1.93619C3.43754 2.55101 2.55101 3.43754 1.93619 4.50017L1.07063 3.99936C1.77305 2.78535 2.78535 1.77305 3.99936 1.07063ZM0 22.2222H1V24C1 24.6284 1.08254 25.2359 1.23682 25.8131L0.270741 26.0713C0.0941465 25.4107 0 24.7163 0 24V22.2222ZM1.07063 28.0006L1.93619 27.4998C2.55101 28.5625 3.43754 29.449 4.50017 30.0638L3.99936 30.9294C2.78535 30.227 1.77305 29.2147 1.07063 28.0006ZM0 20.4444H1V16.8889H0V20.4444ZM0 15.1111H1V11.5556H0V15.1111ZM0 9.77778H1V8C1 7.37164 1.08254 6.7641 1.23682 6.18693L0.270741 5.92869C0.0941466 6.58934 0 7.28368 0 8V9.77778ZM11.5556 0V1H15.1111V0H11.5556ZM16.8889 0V1H20.4444V0H16.8889ZM22.2222 0V1H24C24.6284 1 25.2359 1.08254 25.8131 1.23682L26.0713 0.270741C25.4107 0.0941466 24.7163 0 24 0H22.2222ZM32 11.5556H31V15.1111H32V11.5556ZM32 16.8889H31V20.4444H32V16.8889ZM32 22.2222H31V24C31 24.6284 30.9175 25.2359 30.7632 25.8131L31.7293 26.0713C31.9059 25.4107 32 24.7163 32 24V22.2222ZM20.4444 32V31H16.8889V32H20.4444ZM15.1111 32V31H11.5556V32H15.1111Z" fill="black" fill-opacity="0.3"/>
</svg>
`},196497:(e,t,n)=>{n.d(t,{J:()=>o});let o=`data:image/svg+xml;utf8,<svg width="208" height="124" viewBox="0 0 208 124" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="208" height="124" rx="8" fill="white"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M108.986 49.0056L102.891 73.3875L105.801 74.1151L111.897 49.7332L108.986 49.0056ZM91.0944 60.4997L97.1898 54.4042L99.3111 56.5256L94.2763 61.5604L99.3111 66.5952L97.1898 68.7165L91.0944 62.621L90.0337 61.5604L91.0944 60.4997ZM123.693 60.4997L117.598 54.4042L115.476 56.5256L120.511 61.5604L115.476 66.5952L117.598 68.7165L123.693 62.621L124.754 61.5604L123.693 60.4997Z" fill="black" fill-opacity="0.3"/>
<rect x="0.5" y="0.5" width="207" height="123" rx="7.5" stroke="black" stroke-opacity="0.3" stroke-dasharray="4 4"/>
</svg>`},215239:(e,t,n)=>{n.d(t,{q:()=>y});var o=n(104076),i=n(716976),r=n(903927),s=n(623411),a=n(293422),l=n(475477),d=n(700411),c=n(852980),u=n(275219),m=n(441513),p=n(419278),h=n(991373),f=n(328341),g=n(755444),_=n(681398),v=n(192075),x=n(297869),b=n(521255),C=n(894210);function y(e){let{onSuccess:t}=e,n=m.z.object({link:m.z.string()}),{manager:d}=c.lV.useForm({schema:n}),g=d.watch("link"),C=!(0,p.KJ)(g),y=(0,f.ZC)(g);i.useEffect(()=>{y!==g&&d.methods.clearErrors("link")},[y,g,d]);let j=(0,r.wA)(),k=i.useCallback(({link:e})=>{let[n]=(0,h.Cg)(j,e);if(n?.valid){d.methods.clearErrors("link"),t();return}(0,p.CV)(j,e,x.WJ.MODAL).valid?(d.methods.clearErrors("link"),t()):d.setError("link",(0,v.t)("whiteboard.embeds.insert_embed_modal.invalid_link_error_message"))},[j,t,d]),P=i.useId(),I=!b.Kx()?.shouldOptimizeForIpadApp;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(c.lV,{manager:d,onSubmit:k,children:(0,o.jsxs)(c.lV.Row,{name:"link",label:(0,o.jsx)(s.h,{htmlFor:P,children:(0,v.t)("whiteboard.embeds.insert_embed_modal.public_link_label")}),children:[(0,o.jsxs)("div",{className:"insert_media_modal--linkInputRow--FODZc",children:[(0,o.jsx)(u.k,{id:P,autoComplete:"off",autoFocus:I,placeholder:(0,v.t)("whiteboard.embeds.insert_embed_modal.paste_a_public_link"),type:"url"}),(0,o.jsx)(a.$n,{type:"submit",disabled:C,children:(0,v.tx)("whiteboard.embeds.insert_embed_modal.add")})]}),(0,o.jsx)(c.lV.Helper,{children:(0,o.jsx)("div",{children:(0,v.tx)("whiteboard.embeds.insert_embed_modal.add_media_from_across_the_web",{learnMoreLink:(0,o.jsx)(l.N,{href:"https://help.figma.com/hc/articles/4414079911575",newTab:!0,trusted:!0,children:(0,v.tx)("whiteboard.embeds.insert_embed_modal.learn_more")})})})})]})}),!_.Ay.isIpadNative&&(0,o.jsx)(w,{})]})}function w(){return(0,o.jsxs)("div",{className:"insert_media_modal--examplesContainer--G4gFh",children:[(0,o.jsx)("div",{className:"insert_media_modal--exampleHeader--j6rti",children:(0,v.tx)("whiteboard.embeds.insert_embed_modal.try_linking_to_sites_like")}),(0,o.jsx)("div",{className:"insert_media_modal--iconsContainer--oOP2I",children:[{key:"figma",name:(0,v.t)("whiteboard.embeds.insert_embed_modal.figma"),url:"https://figma.com/",srcColor:(0,g.ck)("7ea1b6f90b29ea190de9f069109ba70cdb731c3e")},{key:"youtube",name:(0,v.t)("whiteboard.embeds.insert_embed_modal.youtube"),url:"https://youtube.com/",srcColor:(0,g.ck)("27da640990b84fd2d3133d90c7af66d8cf212a41")},{key:"vimeo",name:(0,v.t)("whiteboard.embeds.insert_embed_modal.vimeo"),url:"https://vimeo.com/",srcColor:(0,g.ck)("7ef2e69ffc73f6e90f9fa5e90d485e623c69ed10")},{key:"loom",name:(0,v.t)("whiteboard.embeds.insert_embed_modal.loom"),url:"https://loom.com/",srcColor:(0,g.ck)("097eb54967f52a9ad067434278365eba38bca3c3")},{key:"spotify",name:(0,v.t)("whiteboard.embeds.insert_embed_modal.spotify"),url:"https://spotify.com/",srcColor:(0,g.ck)("1c81468ec0a9eccd0c0cdd21b9d4f6a6477dcc8a")},{key:"codepen",name:(0,v.t)("whiteboard.embeds.insert_embed_modal.codepen"),url:"https://codepen.io/",srcColor:(0,g.ck)("76ecbaf33bb0485666ef32e5afaf73b4add66fd7")},{key:"asana",name:(0,v.t)("whiteboard.embeds.insert_embed_modal.asana"),url:"https://asana.com/",srcColor:(0,g.ck)("67c0efb6b111e5fd5b3153057bbddb000ec04fca")}].map(e=>(0,o.jsx)("div",{className:"insert_media_modal--icon--66XmK",children:(0,o.jsx)(d._,{className:"insert_media_modal--iconLink--XCWwX",href:e.url,htmlAttributes:{"data-tooltip-type":C.Ib.TEXT,"data-tooltip-show-immediately":!0,"data-tooltip-hide-immediately":!0,"data-tooltip":e.name},newTab:!0,children:(0,o.jsx)("img",{className:"insert_media_modal--iconImage--HHKPc",src:e.srcColor,alt:e.name})})},e.key))})]})}},147799:(e,t,n)=>{n.d(t,{p:()=>T});var o=n(104076),i=n(716976),r=n(903927),s=n(511570),a=n.n(s),l=n(686549),d=n(219199),c=n(208882),u=n(350819),m=n(555013),p=n(652539),h=n(192075),f=n(50536),g=n(366535),_=n(111297),v=n(710211),x=n(959834),b=n(956359),C=n(643330),y=n(132078),w=n(337726);let j="share_link_modal--section--JsLVR";var k=n(75936),P=n(391205);function I({fileKey:e,onRequestClose:t,alreadyCopied:n}){let s=(0,r.wA)(),x=v.M4.File.useValue(e).data,C=x?.url||"",y=(0,r.d4)(e=>!e.user),[I,T]=(0,i.useState)(!!n),E=()=>{I||(T(!0),s(f.S({url:C})))};return(0,i.useEffect)(()=>{if(I){let e=setTimeout(()=>{T(!1)},5e3);return()=>clearTimeout(e)}},[I]),(0,o.jsxs)(_.fu,{name:"Share Link Modal",children:[(0,o.jsx)("div",{className:j,children:(0,h.tx)("figjam_try.share_link_modal.title")}),(0,o.jsx)("div",{className:j,children:(0,o.jsx)(m.ks,{readOnly:!0,value:C,onClick:E,className:"share_link_modal--input--GQgxB"})}),(0,o.jsx)("div",{className:a()(y&&j),children:(0,o.jsx)(m.vd,{fullWidth:!0,onClick:E,trackingProperties:{buttonContext:"Copy link"},children:(0,o.jsxs)("span",{className:"share_link_modal--buttonContent--xZNXo",children:[(0,o.jsx)(p.B,{svg:k.A,className:"share_link_modal--linkIcon--lwYrP"}),I?(0,h.t)("figjam_try.link_copied"):(0,h.t)("figjam_try.copy_link")]})})}),y&&(0,o.jsxs)("div",{className:"share_link_modal--anonymousUserSection--tS-rc",children:[(0,o.jsx)(p.B,{svg:P.A,className:"share_link_modal--teamIcon--1LdNm"}),(0,o.jsxs)("span",{children:[(0,h.tx)("figjam_try.share_link_modal.cta_description")," ",(0,o.jsx)(m.Us,{role:"button",onClick:()=>{t(),s(c.Ts({origin:"figjam_try_share_modal",formState:u.qB.SIGN_UP,redirectUrl:(0,l.dR)(d.Ay.location.pathname,{[w.ao.key]:w.ao.value}),signedUpFromOpenSession:!0})),s(g.to({type:b.x,data:{headerText:(0,h.t)("fullscreen.toolbar.create_an_account_to_do_more_with_fig_jam")}}))},trackingProperties:{buttonContext:"Create account"},trusted:!0,children:(0,h.tx)("figjam_try.share_link_modal.cta")})]})]})]})}let T=(0,x.Ju)(function({fileKey:e,alreadyCopied:t}){let n=(0,r.wA)(),i=()=>{n(g.Ce())};return(0,o.jsx)(y.CR,{targetKey:w.v4,width:300-2*y.uv,shouldCenterArrow:C.EL.FALLBACK,topPadding:4,dismissModal:i,hideCloseButton:!0,animateQuickly:!0,children:(0,o.jsx)(I,{fileKey:e,onRequestClose:i,alreadyCopied:t})})},"ShareLinkModal")},437984:(e,t,n)=>{n.d(t,{r:()=>a});var o=n(104076),i=n(700411),r=n(236631),s=n(192075);let a=(0,n(560201).ex)("share_button_disabled_personal_draft",function(e){let{isCurrentUserFileOwner:t}=e;return t?(0,o.jsxs)("div",{className:r.s.cursorDefault.colorTextTooltip.$,children:[(0,o.jsx)("span",{children:(0,s.tx)("fullscreen.toolbar.multiplayer.sharing_disabled_for_personal_drafts")}),(0,o.jsx)("div",{className:r.s.bl1.hFull.inline.bSolid.colorBorderMenu.ml8.mr8.$}),(0,o.jsx)(i._,{href:"/files/drafts-to-move",className:r.s.cursorPointer.noUnderline.fontBold.colorTextTooltip.$,children:(0,s.tx)("fullscreen.toolbar.multiplayer.sharing_disabled_visit_drafts_to_move_link")})]}):(0,s.tx)("fullscreen.toolbar.multiplayer.sharing_disabled_while_file_is_being_moved")},e=>{let t=e.getAttribute("data-tooltip-is-current-user-file-owner");return{isCurrentUserFileOwner:!!t&&JSON.parse(t),unconstrainWidth:!0}})},297753:(e,t,n)=>{n.d(t,{A:()=>m});var o=n(104076),i=n(941347);let r=(0,n(716976).memo)(function(e){return(0,o.jsx)("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",...e,children:(0,o.jsx)("path",{fill:"var(--fpl-icon-color, var(--color-icon))",fillRule:"evenodd",d:"M13 7v1.879l1-1V7a2 2 0 1 0-4 0v4.879l1-1V7a1 1 0 1 1 2 0m.996 5.125-1.87 1.871a2 2 0 0 0 1.87-1.87M8.5 12c0 .413.071.809.203 1.176l-.764.764A4.5 4.5 0 0 1 7.5 12v-.5a.5.5 0 0 1 1 0zm2.324 3.297-.764.764c.444.213.93.355 1.44.412V18h-2a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-2v-1.527a4.5 4.5 0 0 0 4-4.473v-.5a.5.5 0 0 0-1 0v.5a3.5 3.5 0 0 1-4.676 3.297m7.03-8.443a.5.5 0 0 0-.708-.708l-11 11a.5.5 0 0 0 .708.708z",clipRule:"evenodd"})})});var s=n(491224),a=n(192075),l=n(55557);let d="voice_svg--voiceAudioBar--bWITN",c="voice_svg--voiceAudioBarStroke--MEsT8 voice_users--voiceAudioBarStroke--MKNsx",u="voice_svg--mutedLine--A9TnC",m={Unmuted:()=>(0,o.jsx)(i.P,{}),Muted:()=>(0,o.jsx)(r,{}),UnmutedBars:({volume:e,className:t,alwaysShowVoiceBars:n,userName:i})=>{if((e||0)<l.q){if(!0!==n)return null;e=0}let r=[7*(e=Math.pow(e||0,.5))*.4,7*e,7*e*.4].map(e=>.8*e+e*(.4*Math.random()-.2));return(0,o.jsxs)("svg",{width:"24",viewBox:"-5 -8 18 16",fill:"none",className:t,"aria-label":(0,a.t)("collaboration.voice.unmuted_user",{user_name:i}),children:[(0,o.jsx)("line",{className:c,x1:"1",y1:0,x2:"7",y2:0,strokeWidth:"5",color:"red",strokeLinecap:"round"}),(0,o.jsx)("line",{className:c,x1:"1",y1:-r[0],x2:"1",y2:r[0],strokeWidth:"4",strokeLinecap:"round"}),(0,o.jsx)("line",{className:d,x1:"1",y1:-r[0],x2:"1",y2:r[0],stroke:"#1BC47D",strokeWidth:"2",strokeLinecap:"round"}),(0,o.jsx)("line",{className:c,x1:"4",y1:-r[1],x2:"4",y2:r[1],strokeWidth:"4",strokeLinecap:"round"}),(0,o.jsx)("line",{className:d,x1:"4",y1:-r[1],x2:"4",y2:r[1],stroke:"#1BC47D",strokeWidth:"2",strokeLinecap:"round"}),(0,o.jsx)("line",{className:c,x1:"7",y1:-r[2],x2:"7",y2:r[2],strokeWidth:"4",strokeLinecap:"round"}),(0,o.jsx)("line",{className:d,x1:"7",y1:-r[2],x2:"7",y2:r[2],stroke:"#1BC47D",strokeWidth:"2",strokeLinecap:"round"})]})},HeadphonesIcon:({className:e})=>(0,o.jsx)(s.D,{className:e}),MutedMini:({userName:e})=>(0,o.jsxs)("svg",{width:"13",height:"16",viewBox:"0 0 13 16",fill:"none","aria-label":(0,a.t)("collaboration.voice.muted_user",{user_name:e}),children:[(0,o.jsx)("path",{className:"voice_svg--iconBorder--tkPMY",d:"M4 6V4.5C4 2.567 5.567 1 7.5 1H10C11.1046 1 12 1.89543 12 3V5C12.5523 5 13 5.44772 13 6V8.75736C13 9.55301 12.6839 10.3161 12.1213 10.8787L11 12V14C11 14.5523 10.5523 15 10 15H5C4.44772 15 4 14.5523 4 14V13L1.20711 10.2071C0.816583 9.81658 0.816582 9.18342 1.20711 8.79289L4 6Z"}),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.33306 3.25234C8.09478 3.09295 7.8083 3 7.5001 3C6.67168 3 6.0001 3.67157 6.0001 4.5V5.58529L6.40341 5.18198L8.33306 3.25234ZM5.47386 10.3542L6.1952 9.63284C6.57505 9.86573 7.0219 10 7.50011 10C8.88081 10 10.0001 8.88074 10.0001 7.50003V7H11.0001V7.50003C11.0001 9.26326 9.69624 10.722 8.0001 10.9646V12H9.0001V13H7.5001H6.0001V12H7.0001V10.9646C6.437 10.884 5.91714 10.6694 5.47386 10.3542ZM6.93722 8.89081L9.0001 6.82793V7.5C9.0001 8.32843 8.32853 9 7.5001 9C7.30104 9 7.11103 8.96122 6.93722 8.89081Z",fill:"#F24822",className:u}),(0,o.jsx)("path",{d:"M10.5009 2.49847L11.2081 3.20558L3.92834 10.4853L3.22123 9.77819L10.5009 2.49847Z",fill:"#F24822",className:u})]})}},828127:(e,t,n)=>{n.d(t,{S:()=>l,i:()=>d});var o=n(104076),i=n(765846),r=n(305651),s=n(297753),a=n(560823),l=(e=>(e[e.NONE=0]="NONE",e[e.DEFAULT=2]="DEFAULT",e[e.MINI=1]="MINI",e))(l||{});function d({userId:e,userName:t,microphoneStyle:n,call:i,volumeIconMutedState:l,alwaysShowVoiceBars:d,className:u}){return n===r.bU.HEADPHONES?(0,o.jsx)(s.A.HeadphonesIcon,{size:24,className:a.AL}):n!==r.bU.NONE&&i?(0,o.jsx)(c,{userId:e,call:i,className:u,volumeIconMutedState:l||0,alwaysShowVoiceBars:d,userName:t}):(0,o.jsx)(o.Fragment,{})}function c({userId:e,call:t,volumeIconMutedState:n,alwaysShowVoiceBars:r,className:l,userName:d}){let c=(0,i.Wl)(e,t);if(!c)return null;if(c.isMuted){if(2===n)return(0,o.jsx)(s.A.Muted,{});if(1===n){let e=a.Nn;return l&&(e+=" "+l),(0,o.jsx)("span",{className:e,children:(0,o.jsx)(s.A.MutedMini,{userName:d})})}return null}return(0,o.jsx)(s.A.UnmutedBars,{alwaysShowVoiceBars:r,className:l,volume:c?.volumeLevel,userName:d})}},49875:(e,t,n)=>{n.d(t,{K:()=>u});var o=n(104076),i=n(903927),r=n(293422),s=n(684742),a=n(377692),l=n(249586),d=n(211862),c=n(55557);function u(e){let t=(0,i.wA)(),n=(0,i.Pj)(),u=(0,i.d4)(e=>e.voice.showWidget),m=(0,d.q5)(),p=(0,i.d4)(t=>!!t.voice.activeCall[e.fileKey]),h=!!m&&!!p,f={onClick:async()=>{e.hidePopover&&e.hidePopover(),u&&h?u&&t(a.jT()):((0,l.ds)("Context Viewed",e.fileKey,n.getState(),{name:"should-close-open-audio-nux"}),await c.h.createInstance(),h&&(0,l.ds)("voice_widget_minimized_toggle",e.fileKey,n.getState(),{minimized:!1}),t(a.Pp(!0)))},"data-tooltip-show-below":!0,"data-dropdown-tooltip":e["data-tooltip"],"data-tooltip-type":e["data-tooltip-type"],"data-tooltip":e["data-tooltip"],"aria-label":e["data-tooltip"],"data-fullscreen-intercept":!0};if(e.isJoinWidget){let{onClick:t,"aria-label":n,...i}=f;return(0,o.jsx)("div",{"data-onboarding-key":e["data-onboarding-key"],children:(0,o.jsx)(r.$n,{onClick:t,"aria-label":n,variant:"signup",htmlAttributes:{...i},children:e.children})})}return(0,o.jsx)(s.E,{...f,className:e.className,children:e.children})}},440104:(e,t,n)=>{n.d(t,{U:()=>i});var o=n(9109);let i=new(n(722458)).b({name:"react_scenegraph",dependencies:[],exports:{"./lazy_root":"./lazy_root.tsx","./jsx_panel":"./jsx_panel.tsx","./chart/import_data_modal":"./chart/import_data_modal.tsx","./jsx_props":"./jsx_props.ts"},friendFiles:[],routeHints:["react_scenegraph"],eslint:{rules:{"react/jsx-no-literals":["error",{elementOverrides:{Text:{allowElement:!0},Line:{allowElement:!0},UnorderedList:{allowElement:!0},OrderedList:{allowElement:!0},Sticky:{allowElement:!0}}}]}}}).createLazyComponent(()=>Promise.all([n.e(357),n.e(7128),n.e(5568),n.e(9890),n.e(4216),n.e(6517)]).then(n.bind(n,140395)).then(e=>e.ReactScenegraphRoot),{componentName:"LazyReactScenegraphRoot",error:o.H4.NONE})},813141:(e,t,n)=>{n.d(t,{G:()=>l,a:()=>a});var o=n(266808),i=n(795033),r=n(185245);let s=[o.Nfd.CODE,o.Nfd.DAKOTA,o.Nfd.SETTINGS];function a(e){return s.includes(e)}function l(){return a((0,i.md)(r.s0))}},914837:(e,t,n)=>{n.d(t,{HD:()=>A,NT:()=>N,ws:()=>D});var o=n(716976),i=n(903927),r=n(812714),s=n(783728),a=n.n(s),l=n(518016),d=n.n(l),c=n(738180),u=n.n(c),m=n(621592),p=n.n(m),h=n(17140),f=n(4033),g=n(141773),_=n(411017),v=n(444878),x=n(815698),b=n(710211),C=n(912610),y=n(303986),w=n(806054),j=n(395556),k=n(96213),P=n(249915),I=n(314788),T=n(481173),E=n(642617);let M=b.M4.Query({fetch:async e=>(await E.d.getDefaultCollageItems({orgId:e})).data.meta});var A=(e=>(e[e.LIBRARY_ITEM=0]="LIBRARY_ITEM",e[e.WIDGET=1]="WIDGET",e[e.PLUGIN=2]="PLUGIN",e[e.TEMPLATE=3]="TEMPLATE",e[e.FACE_STAMP=4]="FACE_STAMP",e[e.WHITEBOARD_TOOL=5]="WHITEBOARD_TOOL",e))(A||{});let S=new Set([y.Ph,y.T0]);function N(){let e=function(){let{productComponents:e}=(0,v.g5)(k.$A.FigJam),t=(0,f.op)(),n=(0,g.eE)(k.$A.FigJam),r=(0,f.qr)(),s=(0,I.qK)(),l=function(){let e=(0,i.d4)(e=>e.recentlyUsed.whiteboardTools),t=(0,T.o)();return o.useMemo(()=>t?e.figjam.map(e=>e.id):[],[t,e])}(),c=(0,i.d4)(x.s),m=(0,i.d4)(e=>e.recentlyUsed);return(0,o.useMemo)(()=>(function(e,t,n,o,i,r,s,l){let c=t.templates.figjam.reduce((e,t)=>(e[(0,w.X2)(t)]=t,e),{}),m={...d()(t.libraryItems.figjam,"key"),...d()(t.plugins.figjam,"id"),...c,...d()(t.widgets.figjam,"id"),...d()(t.faceStamps.figjam,"user.id"),...d()(t.whiteboardTools?.figjam,"id")},p=[...n.map(t=>({type:0,item:t,id:t.id,lastAddedAt:m["component"===t.type?t.component_key:t.key]?.last_added_at_by_user_id?.[e]})),...o.map(t=>({type:2,item:t,id:t.plugin_id,lastAddedAt:m[t.plugin_id]?.last_added_at_by_user_id?.[e]})),...i.map(t=>{let n=(0,_.gp)(t);return{type:3,item:t,id:t.template.id,lastAddedAt:m[n]?.last_added_at_by_user_id?.[e]}}),...r.map(t=>({type:1,item:t,id:t.plugin_id,lastAddedAt:m[t.plugin_id]?.last_added_at_by_user_id?.[e]})),...s.map(t=>({type:4,item:t,id:t.id,lastAddedAt:m[t.id]?.last_added_at_by_user_id?.[e]})),...l.map(t=>({type:5,item:t,id:t,lastAddedAt:m[t]?.last_added_at_by_user_id?.[e]}))],[h,f]=u()(p,e=>!!e.lastAddedAt);return[...h.sort((e,t)=>(t.lastAddedAt||0)-(e.lastAddedAt||0)),...function(e){let t={1:0,0:1,3:2,2:3,4:4,5:5};return function(e){let t=[],n=Math.max(...e.map(e=>e.length));for(let o=0;o<n;o++)e.forEach(e=>{o<e.length&&t.push(e[o])});return t}(Object.entries(a()(e,"type")).sort(([e],[n])=>(t[e]??100)-(t[n]??100)).map(([,e])=>e))}(f)].slice(0,4)})(c,m,e,t,n,r,s,l),[c,m,e,t,n,r,s,l])}(),t=function(){let e=(0,h.q8)(),t=(0,i.d4)(e=>e.currentUserOrgId),[n]=(0,b.IT)(M(t));return(0,o.useMemo)(()=>"loaded"!==n.status?[]:function(e){let t=[];return e.plugins.forEach(e=>{let n=(0,C.uF)(e);t.push({type:2,item:n,id:n.plugin_id})}),e.widgets.forEach(e=>{let n=(0,C.uF)(e);t.push({type:1,item:n,id:n.plugin_id})}),e.components.forEach(e=>{t.push({type:0,item:e,id:e.id})}),e.templates.forEach(e=>{t.push({type:3,item:{type:j.n.HubFile,template:e},id:e.id})}),t}(n.data),[n]).filter(t=>!!(0,r.kc)().jamgpt_recents_pin&&!e||t.id&&!S.has(t.id))}(),n=function(e){let t=(0,h.q8)();if(!(0,r.kc)().jamgpt_recents_pin||t)return null;for(let t of e)if(t.id&&S.has(t.id))return t;return null}(t),s=(0,h.q8)();return(0,o.useMemo)(()=>{let o=[];n?(o.push(n),e.forEach(e=>{e.id!==n.id&&o.push(e)})):o=e,s&&(o=o.filter(e=>!(s&&S.has(e.id||""))));let i=[...o,...t].filter(e=>e.id);return p()(i,"id").slice(0,4)},[t,n,e,s])}function D(e){return(0,P.mk)(e,[])}},851669:(e,t,n)=>{n.d(t,{E:()=>Z,h:()=>z});var o=n(104076),i=n(716976),r=n(903927),s=n(511570),a=n.n(s),l=n(686549),d=n(983500),c=n(816565),u=n(125746),m=n(475034),p=n(411017),h=n(220411),f=n(841e3),g=n(695203),_=n(114400),v=n(238077),x=n(635148),b=n(380388),C=n(944350),y=n(436648),w=n(96213),j=n(894210),k=n(82483),P=n(874216),I=n(674355),T=n(994847),E=n(705292),M=n(942147),A=n(809635),S=n(196497),N=n(583669),D=n(914837),O=n(789528),R=n(404343);let L="dlt_universal_insert_item--recentItem--Jci7m",F="dlt_universal_insert_item--recentItemImage--vvIrT",B=(0,d.jz)(R.MNc);function U(e){return`data:image/svg+xml;utf8,${encodeURIComponent(e)}`}let V=U(`<svg width="68" height="41" viewBox="0 0 68 41" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect x="0.858643" y="0.297363" width="66.9565" height="40" fill="#F5F5F5"/>
<path d="M6.24878 6.57568L61.5614 35.8461" stroke="#E6E6E6" stroke-width="2"/>
</svg>`),q=U(`<svg width="47" height="47" viewBox="0 0 47 47" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect x="0.795898" y="0.795898" width="46" height="46" rx="4" fill="#F5F5F5"/>
<path d="M6.05078 6.43506L42.0168 41.4843" stroke="#E6E6E6" stroke-width="2"/>
</svg>`);function H(e,t){let[n,o]=(0,i.useState)(0),[r,s]=(0,i.useState)(0);return(0,i.useEffect)(()=>{if(e){let t=new Image;t.addEventListener("load",function(){o(t.naturalWidth),s(t.naturalHeight)}),t.src=e}},[e]),!e||n*r>25e5?t:e}function z(e,t,n){let{item:o,type:i}=e;if(!o)return null;switch(i){case D.HD.LIBRARY_ITEM:return(n&&o.thumbnail_url?(0,l.NQ)(o.thumbnail_url,"fuid",n):o.thumbnail_url)||null;case D.HD.WIDGET:return o.redirect_snapshot_url||S.J;case D.HD.PLUGIN:return o.redirect_icon_url||A.W;case D.HD.TEMPLATE:return t(o).imageUrl||null;case D.HD.FACE_STAMP:return o.img_url||null;case D.HD.WHITEBOARD_TOOL:return(0,b.AE)(o)}}function Z({item:e,width:t,height:n,disableTooltips:r}){let s=(0,p.fG)(),a=(0,i.useCallback)(e=>z(e,s),[s]);if(!e.item)return null;switch(e.type){case D.HD.LIBRARY_ITEM:return(0,o.jsx)(I.lX,{draggable:{sourceForTracking:"universal-insert-figjam-collage"},height:n||B,isDragged:r,isFigJam:!0,item:e.item,noBackground:!0,shouldHideDescription:!0,showName:!1,tooltipShownAbove:!0,width:t||B});case D.HD.WIDGET:return(0,o.jsx)(G,{widget:e.item,disableTooltips:r,imgSrc:a(e)});case D.HD.PLUGIN:return(0,o.jsx)(K,{plugin:e.item,disableTooltips:r,imgSrc:a(e)});case D.HD.TEMPLATE:return(0,o.jsx)(X,{template:e.item,disableTooltips:r,width:t||B,imgSrc:a(e)});case D.HD.FACE_STAMP:return(0,o.jsx)(E.I,{mini:!0,hideName:!0,user:e.item,triggeredFrom:(0,y.Vq)(T.p.RECENTS_COLLAGE)});case D.HD.WHITEBOARD_TOOL:return(0,o.jsx)(W,{tool:e.item,onInsertableResourcePointerDown:(0,M.Yx)(e.item).insertToolWithDragAction,disableTooltips:r});default:return null}}function G({widget:e,disableTooltips:t,imgSrc:n}){let i=H(n,e.redirect_icon_url||q);return(0,o.jsx)("div",{className:L,"data-tooltip-type":t?void 0:j.Ib.TEXT,"data-tooltip":t?void 0:e.name,"data-tooltip-timeout-delay":t?void 0:500,"data-tooltip-show-above":!t||void 0,children:(0,o.jsx)(P._,{src:i,widget:e,analytics:{triggeredFrom:"universal-insert-figjam-collage"},fillContainer:!0,clickToInsert:!1,context:C._Y.WHITEBOARD})})}function K({plugin:e,disableTooltips:t,imgSrc:n}){let{dragState:i,onInsertableResourcePointerDown:r}=(0,v.c)({clickToInsert_DEPRECATED:!1,triggeredFrom:(0,y.Vq)(T.p.RECENTS_COLLAGE),resource:e}),s=H(n,q);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:L,"data-tooltip-type":t?void 0:j.Ib.TEXT,"data-tooltip":t?void 0:e.name,"data-tooltip-timeout-delay":t?void 0:500,"data-tooltip-show-above":!t||void 0,onPointerDown:r,role:"button",tabIndex:0,children:(0,o.jsx)("div",{className:"dlt_universal_insert_item--recentPluginImageContainer--j2z08",children:(0,o.jsx)("img",{src:s,alt:e.name,className:F,draggable:!1})})}),(0,o.jsx)(g.z,{dragState:i})]})}function X({template:e,disableTooltips:t,width:n,imgSrc:i}){let r;let{dragState:s,onInsertableResourcePointerDown:l}=(0,x.B)({resource:e,clickToInsert_DEPRECATED:!1,triggeredFrom:"universal-insert-figjam-collage"}),{name:d,clientMeta:c,thumbnailIsSet:m,hubFileId:f,resizedThumbnailUrls:g}=(0,p.fG)()(e);if(g){let e=Object.keys(g).map(e=>Number(e)).sort()[0];e&&(r=g[e])}let v=H(r||i,V);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:a()(L,{[O.J]:!!s}),"data-tooltip-type":t?void 0:j.Ib.TEXT,"data-tooltip":t?void 0:d,"data-tooltip-timeout-delay":t?void 0:500,"data-tooltip-show-above":!t||void 0,onPointerDown:l,role:"button",tabIndex:0,style:{width:n,height:.6*n},children:(0,o.jsx)(k.WM,{backgroundColor:(0,h.Cn)(c),removeBorder:!0,className:a()("dlt_universal_insert_item--recentTemplateCommunityCard--0w4xu",{"dlt_universal_insert_item--recentTemplateCommunityCardInnerImage--nDAlH":!m}),children:(0,o.jsx)(N.Ho,{image:v,isSet:!!m,isWhiteboard:!0,hubFileId:f,alt:d,draggable:!1,resizedThumbnailUrls:g,thumbnailContext:u.O7.UNIVERSAL_INSERT})})}),(0,o.jsx)(_.S,{dragState:s})]})}function W({tool:e,onInsertableResourcePointerDown:t,disableTooltips:n}){let s=(0,r.wA)(),a=(0,r.d4)(e=>e.user?.id),l=i.useCallback(()=>{s(m.ay({currentUserId:a,storeInRecentsKey:w.$A.FigJam,item:{id:e,type:w.vt.WhiteboardTool}}))},[a,s,e]),{dragState:d,onInsertableResourcePointerDown:u}=(0,b.Ik)({resource:e,insertAction:t,clickToInsert_DEPRECATED:!1,triggeredFrom:(0,y.Vq)(T.p.RECENTS_COLLAGE),afterSuccessfulInsert:l}),p=(0,b.AE)(e);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:L,"data-tooltip-type":n?void 0:j.Ib.TEXT,"data-tooltip":n?void 0:(0,b.E)(e),"data-tooltip-timeout-delay":n?void 0:500,"data-tooltip-show-above":!n||void 0,onPointerDown:u,role:"button",tabIndex:0,children:(0,o.jsx)("div",{className:"dlt_universal_insert_item--recentTool--fZfmo",children:(0,o.jsx)(c.oW,{src:p,alt:(0,b.E)(e),className:F,draggable:!1})})}),(0,o.jsx)(f.M,{dragState:d})]})}},281772:(e,t,n)=>{n.d(t,{e:()=>u});var o=n(582789),i=n(983500),r=n(692042),s=n(454040),a=n(199984),l=n(404343);let d=a.V3*a.w,c=(0,i.jz)(l.rY4)+16;function u(e,t,n){let o=e.guid,i=e.absoluteBoundingBox,a=t.getViewportInfo();return Math.max(i.w,i.h)*a.zoomScale<=170?(0,r.QZ)({nodeId:o,minSizePx:170,alwaysPan:!1}):(0,r.QZ)({...s.B5,nodeId:o,nodeAbsoluteBounds:"vote"===n?p(i,a):m(i),viewportRect:h(a,c)})}let m=e=>o.r.fromOriginAndSize(e.x,e.y,e.w,e.h),p=(e,t)=>{let n=d/t.zoomScale,i=a.HG/t.zoomScale;return o.r.fromOriginAndSize(e.x,e.y-n,e.w+i,e.h+n)},h=(e,t)=>({origin:{x:0,y:0},size:{x:e.width-t,y:e.height}})},279915:(e,t,n)=>{n.d(t,{m:()=>l,v:()=>a});var o=n(104076),i=n(192075),r=n(141524),s=n(826160);function a({userId:e,user:t,loading:n,size:i,defaultClassName:r,loadingClassName:a}){return t?(0,o.jsx)(s.Ro,{size:i,entity:t,className:r}):n?(0,o.jsx)("div",{className:a,style:{width:i,height:i}}):(0,o.jsx)(s.Ro,{size:i,entity:{id:e},className:r})}function l({userId:e,user:t,loading:n,defaultClassName:s,loadingClassName:a}){return t?(0,o.jsx)("span",{className:s,children:t.handle}):n?(0,o.jsx)("span",{className:a}):(0,r.Fl)(e)?(0,o.jsx)("span",{className:s,children:(0,i.tx)("voting.voter_username.visitor")}):(0,o.jsx)("span",{className:s,children:(0,i.tx)("voting.voter_username.unavailable")})}},362073:(e,t,n)=>{n.d(t,{r:()=>u});var o=n(716976),i=n(903927),r=n(266808),s=n(967782),a=n(675477),l=n(92063),d=n(249586),c=n(488922);function u(e,t){let n=(0,i.wA)();return(0,o.useCallback)(()=>{(0,s.YQ)({id:"figjam-saves"}),e?(n(l.KE()),r.glU?.triggerActionInUserEditScope("set-tool-default",{source:c.fK})):(r.glU?.triggerActionInUserEditScope("clear-tool",{source:c.fK}),n(a.jD()),n(l.En({initialX:0,initialY:0,initialTab:t})),(0,d.Cu)({source:c.fK},c.tV))},[e,t,n])}},340063:(e,t,n)=>{n.d(t,{I:()=>i});var o=n(104076);let i=(0,n(716976).memo)(function(e){return(0,o.jsx)("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",...e,children:(0,o.jsx)("path",{fill:"var(--fpl-icon-color, var(--color-icon))",fillRule:"evenodd",d:"M9.5 6H7a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1zm5-1H17a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h2.5v-.5A1.5 1.5 0 0 1 11 3h2a1.5 1.5 0 0 1 1.5 1.5zm-1 0v-.5A.5.5 0 0 0 13 4h-2a.5.5 0 0 0-.5.5V5zM12 12a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3m1.212.687a2.5 2.5 0 1 0-2.424 0A4 4 0 0 0 8 16.5a.5.5 0 0 0 1 0 3 3 0 1 1 6 0 .5.5 0 0 0 1 0 4 4 0 0 0-2.788-3.813",clipRule:"evenodd"})})})},186437:(e,t,n)=>{n.d(t,{A:()=>s});var o=n(104076),i=n(716976),r=n(933135);let s=(0,i.memo)(function(e){return(0,r.O)()?(0,o.jsx)("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",...e,children:(0,o.jsx)("path",{fill:"var(--fpl-icon-color, var(--color-icon))",fillRule:"evenodd",d:"M12.354 6.146a.5.5 0 0 0-.708 0l-3 3a.5.5 0 1 0 .708.708L11.5 7.707V13.5a.5.5 0 0 0 1 0V7.707l2.146 2.147a.5.5 0 0 0 .708-.708zM7 13.5a.5.5 0 0 0-1 0v3A1.5 1.5 0 0 0 7.5 18h9a1.5 1.5 0 0 0 1.5-1.5v-3a.5.5 0 0 0-1 0v3a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5z",clipRule:"evenodd"})}):(0,o.jsx)("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",...e,children:(0,o.jsx)("path",{fill:"var(--fpl-icon-color, var(--color-icon))",fillRule:"evenodd",d:"M11.854 6.146a.5.5 0 0 0-.708 0l-3 3a.5.5 0 1 0 .708.708L11 7.707V13.5a.5.5 0 0 0 1 0V7.707l2.146 2.147a.5.5 0 0 0 .708-.708zM7 13.5a.5.5 0 0 0-1 0v3A1.5 1.5 0 0 0 7.5 18h8a1.5 1.5 0 0 0 1.5-1.5v-3a.5.5 0 0 0-1 0v3a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5z",clipRule:"evenodd"})})})}}]);

//# debugId=db1c13c9-9679-5265-9b40-e01842e4abaf

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/28dab713df8540b3d43dc354be7a3770760bcd78/6591-105f018adc9a0573.min.js.map