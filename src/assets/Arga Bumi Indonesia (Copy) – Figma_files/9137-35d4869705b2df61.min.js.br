"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="3c6cb0ea-809d-5cc9-9d00-767bc605e36f")}catch(e){}}();
(globalThis.webpackChunk_figma_web_bundler=globalThis.webpackChunk_figma_web_bundler||[]).push([[9137],{974528:(e,t,n)=>{n.d(t,{DL:()=>i,DX:()=>r,JM:()=>o,Zg:()=>s,lE:()=>l});let r="editable_typeahead--wrapperBase--rwdvD",i="editable_typeahead--wrapperDefault--G1MoY",l="editable_typeahead--mention--yPPjQ",o="editable_typeahead--hyperlink--JH0Ig",s="editable_typeahead--emoji--vp6nb"},710361:(e,t,n)=>{n.r(t),n.d(t,{CommentsSubmitButton:()=>tw,ThreadCommentComposer:()=>tj});var r=n(104076),i=n(716976),l=n(903927),o=n(951002),s=n(420680),a=n(293422),u=n(816317),c=n(829838);let d=(0,i.memo)(function(e){return(0,r.jsx)("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",...e,children:(0,r.jsx)("path",{fill:"var(--fpl-icon-color, var(--color-icon))",fillRule:"evenodd",d:"M12 6a6 6 0 1 0 0 12 .5.5 0 0 1 0 1 7 7 0 1 1 7-7v.5a2.5 2.5 0 0 1-4.62 1.326A3 3 0 1 1 14 9.764V9.5a.5.5 0 0 1 1 0v3a1.5 1.5 0 0 0 3 0V12a6 6 0 0 0-6-6m2 6a2 2 0 1 0-4 0 2 2 0 0 0 4 0",clipRule:"evenodd"})})});var f=n(870611),g=n(812714),h=n(795033),p=n(511570),m=n.n(p),y=n(873304),_=n(883765),x=n(686549),E=n(466890),b=n(653899),T=n(681398),C=n(999521),k=n(641518),I=n(361170),A=n(876621),v=n(157869),S=n(192075),O=n(58212),M=n(814082),D=n(443192),L=n(459494),N=n(819851),K=n(551037),F=n(249586),w=n(876862),R=n(229150),j=n(76404),P=n(610973),B=n(211862),U=n(592726),J=n(174730),W=n(944350),H=n(338891),q=n(821359),$=n(298056),Y=n(894210),z=n(366535),X=n(434155),G=n(261524),Q=n(789837),V=n(907469);function Z(e){let t=(0,l.wA)(),{attachments:n}=e,i=e=>{t((0,z.to)({type:G.q,data:{attachments:n,selectedIdx:n.map(e=>e.thumbnailUrl).indexOf(e),onUpdateAltText:o,canEdit:!0}}))},o=(t,r)=>{let i=n[r];return e.fileKey?X.l.put(e.fileKey,i.id,t).then(n=>(200===n.status&&e.onUpdate({...i,altText:t}),n)):Promise.resolve(void 0)};return(0,r.jsx)("div",{className:V.kG,onClick:e.focusComposer,children:n.map(t=>(0,r.jsx)(Q.v,{thumbnailUrl:t.thumbnailUrl,altText:(0,S.t)("comments.attachment_thumbnail_alt_text_default"),onClick:i,isUploading:t.isUploading,onDelete:()=>e.onDelete(t)},t.id))})}var ee=n(696781),et=n(753703),en=n(624180),er=n(849894),ei=n(571861),el=n(240803),eo=n(601393),es=n(883187),ea=n(465428),eu=n(723309),ec=n(856434),ed=n(942942),ef=n(816154),eg=n(436919),eh=n(697872);n(120440);var ep=n(328341),em=n(675477),ey=n(977899),e_=n(17057),ex=n(633065),eE=n(129215),eb=n(321259),eT=n(801519),eC=n(974528);class ek extends eE.k_{static getType(){return"custom-auto-link"}constructor(e,t,n){super(e,t,n),this.editorType=t.editorType}static clone(e){return new ek(e.__url,{isUnlinked:e.__isUnlinked,rel:e.__rel,target:e.__target,title:e.__title,editorType:e.editorType},e.__key)}createDOM(e){let t=document.createElement("span");this._setAttributes(t),t.className=eC.JM;let n=super.createDOM(e);return t.appendChild(n),t}updateDOM(e,t,n){let r=t.firstChild;return null===r||(e.__url!==this.__url&&this._setAttributes(t),super.updateDOM(e,r,n),!1)}_setAttributes(e){e.setAttribute("data-testid",`implicit-hyperlink-${this.__url}`),e.setAttribute("data-tooltip",Y.MW.HYPERLINK_POPUP),e.setAttribute("data-tooltip-can-edit","false"),e.setAttribute("data-tooltip-interactive","true"),e.setAttribute("data-tooltip-precise","true"),e.setAttribute("data-tooltip-show-above","true"),e.setAttribute("data-tooltip-type",Y.Ib.SPECIAL),e.setAttribute("data-tooltip-unconstrain-width","true"),e.setAttribute("data-tooltip-url-string",this.__url),e.setAttribute("spellCheck","false")}static importJSON(e){let{url:t,rel:n,target:r,title:i,isUnlinked:l,editorType:o}=e;return eI(t,{rel:n,target:r,title:i,isUnlinked:l,editorType:o})}exportJSON(){return{...super.exportJSON(),editorType:this.editorType,type:"custom-auto-link"}}}function eI(e,t={}){return(0,eT.pT)(new ek(e,t))}class eA extends eT.Ey{static getType(){return"emoji"}static clone(e){return new eA(e.__text,e.__shortcode,e.__key)}constructor(e,t,n){super(e,n),this.__shortcode=t}getUnicode(){return this.__text}getShortcode(){return this.__shortcode}createDOM(e){let t=super.createDOM(e);return t.className="x1c6ngcr",t.setAttribute("spellcheck","false"),t}updateDOM(){return!1}static importJSON(e){let{text:t,shortcode:n}=e;return ev(t,n)}exportJSON(){return{...super.exportJSON(),type:"emoji",shortcode:this.__shortcode,version:1}}isSegmented(){return!0}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}isTextEntity(){return!0}}function ev(e,t){return new eA(e,t)}class eS extends eE.Db{static getType(){return"custom-link"}constructor(e,t,n){super(e,t,n),this.editorType=t.editorType}static clone(e){return new eS(e.__url,{rel:e.__rel,target:e.__target,title:e.__title,editorType:e.editorType},e.__key)}createDOM(e){let t=document.createElement("span");this._setAttributes(t),t.className=eC.JM;let n=super.createDOM(e);return t.appendChild(n),t}updateDOM(e,t,n){let r=t.firstChild;return null===r||(e.__url!==this.__url&&this._setAttributes(t),super.updateDOM(e,r,n),!1)}_setAttributes(e){e.setAttribute("data-tooltip",Y.MW.HYPERLINK_POPUP),e.setAttribute("data-tooltip-can-edit","true"),e.setAttribute("data-tooltip-entity-key",this.getKey()),e.setAttribute("data-tooltip-interactive","true"),e.setAttribute("data-tooltip-precise","true"),e.setAttribute("data-tooltip-show-above","true"),e.setAttribute("data-tooltip-target-ref-key",this.editorType??""),e.setAttribute("data-tooltip-type",Y.Ib.SPECIAL),e.setAttribute("data-tooltip-unconstrain-width","true"),e.setAttribute("data-tooltip-url-string",this.__url),e.setAttribute("spellCheck","false")}static importJSON(e){let{url:t,rel:n,target:r,title:i,editorType:l}=e;return eO(t,{rel:n,target:r,title:i,editorType:l})}exportJSON(){return{...super.exportJSON(),editorType:this.editorType,type:"custom-link"}}static importDOM(){return{a:e=>{let t=e.getAttribute("data-tooltip-url-string");return t?{conversion:e=>{var n;return{node:eO(t,{rel:(n=e).getAttribute("rel"),target:n.getAttribute("target"),title:n.getAttribute("title")})}},priority:2}:null}}}}function eO(e,t={}){return(0,eT.pT)(new eS(e,t))}function eM(e){return e instanceof eS}class eD extends eT.Ey{static getType(){return"mention"}static clone(e){return new eD(e.__text,e.__userId,e.__profileId,e.__userAnnotated,e.__key)}constructor(e,t,n,r,i){super(e,i),this.__userId=t,this.__profileId=n,this.__userAnnotated=r}static importJSON(e){let{userId:t,profileId:n,userAnnotated:r,text:i}=e;return eN({displayText:i,userId:t,profileId:n,userAnnotated:r})}exportJSON(){return{...super.exportJSON(),userId:this.__userId,profileId:this.__profileId,userAnnotated:this.__userAnnotated,type:"mention"}}createDOM(e){let t=super.createDOM(e);return t.className=eC.lE,t.setAttribute("spellcheck","false"),this.__userId&&t.setAttribute("data-mention-user-id",this.__userId),this.__profileId&&t.setAttribute("data-mention-profile-id",this.__profileId),t}exportDOM(){let e=document.createElement("a");return e.setAttribute("data-lexical-mention","true"),this.__userId&&e.setAttribute("data-mention-user-id",this.__userId),this.__profileId&&e.setAttribute("data-mention-profile-id",this.__profileId),e.textContent=this.__text,{element:e}}static importDOM(){return{a:e=>e.hasAttribute("data-mention-user-id")||e.hasAttribute("data-mention-profile-id")?{conversion:eL,priority:3}:null}}isToken(){return!0}isTextEntity(){return!0}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}getUserId(){return this.__userId}getProfileId(){return this.__profileId}getUserAnnotated(){return this.__userAnnotated}getDisplayText(){return this.__text}}function eL(e){let t=e.getAttribute("data-mention-user-id")??void 0,n=e.getAttribute("data-mention-profile-id")??void 0;return{node:eN({displayText:e.textContent??"",userId:t,profileId:n})}}function eN({displayText:e,userId:t,profileId:n,userAnnotated:r}){let i=new eD(e,t,n,r);return i.setMode("token"),(0,eT.pT)(i)}let eK={text:{bold:"x1s688f",italic:"x1k4tb9n",strikethrough:"xmqliwb"},list:{ol:"x1717udv x1ghz6dp x43c9pm x3yw8vx",ul:"x1717udv x1ghz6dp x43c9pm xtaz4m5",listitem:"x400o59"}};function eF({editorState:e,editorType:t,editable:n}){return{editorState:e,editable:n,namespace:"lexical-editable-typeahead",onError(e){throw e},theme:eK,html:{import:{span:()=>({conversion:ew,priority:1})}},nodes:[eT.Ey,eA,eD,eS,ek,{replace:eE.Db,with:e=>eO(e.__url,{editorType:t}),withKlass:eS},{replace:eE.k_,with:e=>eI(e.__url,{editorType:t}),withKlass:ek},eb.v5,eb.YW]}}function ew(e){return{forChild:function(e){let t=e.fontWeight,n=parseInt(t,10),r=e.textDecoration.split(" "),i=isNaN(n)?"bold"===t:n>=600,l=r.includes("line-through"),o="italic"===e.fontStyle;return e=>((0,eT.kF)(e)&&(i&&!e.hasFormat("bold")&&e.toggleFormat("bold"),l&&!e.hasFormat("strikethrough")&&e.toggleFormat("strikethrough"),o&&!e.hasFormat("italic")&&e.toggleFormat("italic")),e)}(e.style),node:null}}var eR=n(983016),ej=n(372868),eP=n(750802),eB=n(116553),eU=n(695370),eJ=n(479929);let eW={b:"bold",i:"italic",s:"strikethrough"};function eH(e){let t=[];return e.read(()=>{let e=(0,eT.Ni)();!function(e){let t=e.getChildren();if(1!==t.length)return!1;let n=t[0];return(0,eT.bS)(n)&&0===n.getChildren().length}(e)&&e.getChildren().forEach(e=>(function e(t,n){if((0,eb.HY)(t)){let r=t.getListType(),i=[];t.getChildren().forEach(t=>{e(t,i)}),e$({styles:["number"===r?"ol":"ul"],children:i},n)}else if((0,eb.Mz)(t)){let r=[];t.getChildren().forEach(t=>{e(t,r)}),e$({children:r},n)}else if((0,eT.bS)(t)){let r=n[n.length-1];r&&!ez(r)&&e$({t:"\n"},n);let i=t.getChildren();i.length?i.forEach(t=>e(t,n)):e$({t:""},n)}else if(t instanceof eD){let e=t.getUserId(),r=t.getProfileId(),i=t.getUserAnnotated(),l={};r?(l.profile_id=r,l.t=t.getDisplayText()):e&&i&&(l.user_id=e,l.user_annotated=i),e$(l,n)}else if(t instanceof eA)e$({t:t.getShortcode()},n);else if(t instanceof ek||eM(t)){let e=t.getURL();e$({t:(0,eP.F)(t.getTextContent())??"",link:e},n)}else if((0,eT.kF)(t)){let e=(0,eP.F)(t.getTextContent())??"",r=function(e){let t=[];for(let[n,r]of Object.entries(eW))e.hasFormat(r)&&t.push(n);return t}(t),i={t:e};r.length>0&&(i.styles=r),e$(i,n)}else(0,eT.wH)(t)&&e$({t:"\n"},n)})(e,t))}),t}function eq(e,t){let n=(0,eR.D)({nodes:eF({editorState:null,editorType:"headless-editor"}).nodes,onError:e=>{console.error("Error creating Lexical EditorState:",e)}});return n.update(()=>{let n=(0,eT.Ni)();n.clear(),function e(t,n,r){let i=(0,eU.lZ)(t),l=r;for(let t of i){if(t.children&&t.children.length>0){let i;if(ez(t)){let e=eY(t)?"bullet":"number";i=(0,eb.DE)(e)}else i=(0,eb.i)();r.append(i),e(t.children,n,i),l=r;continue}if((0,eT.hV)(l)&&(l=(0,eT.lJ)(),r.append(l)),t.user_annotated||t.profile_id)(function(e,t){let n;let r=(0,eP.F)(e.t)??"";if(e.profile_id){let t=r.startsWith("@")?r:`@${r}`;n=eN({profileId:e.profile_id,displayText:t})}else if(e.user_id&&e.user_annotated){let t=(0,eP.F)(e.user_annotated.handle)??"";n=eN({userId:e.user_id,userAnnotated:e.user_annotated,displayText:t})}else{let e=(0,eT.sT)(r);t.append(e);return}t.append(n)})(t,l);else if(t.link&&(0,eJ.$x)((0,eB.xT)(t.link)))(function(e,t,n){if(!e.link||!(0,eJ.$x)((0,eB.xT)(e.link)))return;let r=(0,eP.F)(e.t)??"",i=eO(e.link,{editorType:n}),l=(0,eT.sT)(r);eX(l,e),i.append(l),t.append(i)})(t,l,n);else if(null!=t.t){let e=(0,eP.F)(t.t)??"";if((0,ej.Lg)(e))(function(e,t,n){for(let r of(0,ej.wd)(e)){let e="",i="";if((0,ej.xM)(r)){(0,ej.UF)(r).forEach(t=>{e+=t.unicode,i+=t.meta});let t=ev(e,i);n.append(t)}else{let e=(0,eT.sT)(r);eX(e,t),n.append(e)}}})(e,t,l);else{let n=(0,eT.sT)(e);eX(n,t),l.append(n),e.endsWith("\n")&&(n.setTextContent(e.slice(0,-1)),l=(0,eT.lJ)(),r.append(l))}}}if((0,eT.hV)(r)&&!r.getChildren().length){let e=(0,eT.lJ)();r.append(e)}}(e,t,n)},{discrete:!0}),n.getEditorState()}function e$(e,t){if(null!=e.t){let n=t[t.length-1];n?.t!=null&&1===Object.keys(n).length&&1===Object.keys(e).length?n.t+=e.t:t.push(e)}else t.push(e)}function eY(e){return Array.isArray(e.styles)&&e.styles.includes("ul")}function ez(e){return eY(e)||Array.isArray(e.styles)&&e.styles.includes("ol")}function eX(e,t){if(t.styles&&t.styles.length>0)for(let n of t.styles){let t=eW[n];t&&e.toggleFormat(t)}}let eG=[e=>{let t=(0,eJ.Vt)(e)[0];if(!t)return null;let n=new URL(t.href).toString();return{index:t.start,length:t.end-t.start,text:t.value,url:n}}];function eQ(e){return(0,eJ.$x)(e)&&eJ.oh.test(e)}function eV(e,t,n){let r=eO(e,{editorType:n}),i=(0,eT.sT)(t);return r.append(i),r}function eZ(){let e=(0,eT.vJ)();if(!(0,eT.I2)(e))return null;let t=e.getNodes().filter(e=>!e6(e));if(t.length<1)return null;let n=e0(t[0]);return n&&t.every(e=>e0(e)===n)?n:null}function e0(e){return eM(e)?e.getURL():eM(e.getParent())?e.getParent().getURL():null}function e1(e,t,n){let r="next"===n?e7:e5,i=[],l=r(e,eM);for(;l&&e8(l,t);)"next"===n?i.push(l):i.unshift(l),l=r(l,eM);return i}function e2(e){if(!eZ())return;let t=e.getNodes(),n=t[0],r=t[t.length-1];if(!n||!r)return;let i=e0(n);if(!i)return;let l=e1(n,i,"previous"),o=e1(r,i,"next"),s=[...l,...t.map(e=>(function(e,t){if(e8(e,t))return e;let n=e?.getParent();return n&&e8(n,t)?n:null})(e,i)).filter(e=>null!==e),...o],a=s[0],u=s[s.length-1];if(!a||!u)return;let c=e.clone();c.anchor.set(a.getKey(),0,"element"),c.focus.set(u.getKey(),u.getTextContentSize?.()||0,"element"),(0,eT.n1)(c)}function e6(e){return(0,eT.bS)(e)||(0,eb.HY)(e)||(0,eb.Mz)(e)}function e5(e,t){return e9(e,t,"previous")}function e7(e,t){return e9(e,t,"next")}function e9(e,t,n){let r=null,i=e;for(r=e3(i,n);!r&&i;)r=e3(i=i.getParent(),n);return r&&t(r=function e(t,n){return t&&e6(t)?e("next"===n?t.getFirstChild():t.getLastChild(),n):t}(r,n))?r:null}function e3(e,t){return e?"next"===t?e.getNextSibling():e.getPreviousSibling():null}function e8(e,t){return eM(e)&&e.getURL()===t}var e4=n(371868),te=n(909581);function tt(){let[e]=(0,e4.DF)();return(0,r.jsx)(te.G,{editor:e})}var tn=n(873337),tr=n(130689),ti=n(484655),tl=n(403206),to=n(335963);function ts({anchorNode:e,replacementNode:t,end:n,matchText:r,selection:i,start:l}){let o=i.anchor.offset===e.getTextContent().length;for(let i of e.splitText(l,n))i.getTextContent()===r&&(i.replace(t),t.selectEnd());o&&ta()}function ta(){let e=(0,eT.vJ)();(0,eT.I2)(e)&&e.insertText(" ")}var tu=n(735212);function tc(e,t=!0){setTimeout(()=>{e.focus(),t&&e.update(()=>{(0,eT.Ni)().selectEnd()})},0)}let td=(0,eT.gu)();function tf({dispatch:e,onUpdateTextArea:t}){let[n]=(0,e4.DF)(),r=(0,i.useRef)(null);return(0,i.useEffect)(()=>n.registerUpdateListener(({editorState:n})=>{n.read(()=>{let n=(0,eT.vJ)();if((0,eT.I2)(n)){let i=n.anchor.getNode();if(i instanceof eT.Ey){let l=i.getTextContent(),o=n.anchor.offset,s=l.substring(0,o).match(to.n);if(s){let n=s[1];if(n!==r.current){r.current=n;let i=(0,q.oQ)(n);i?(e(M.We(i)),t()):e(M.We(null))}}else null!==r.current&&(r.current=null,e(M.We(null)))}else null!==r.current&&(r.current=null,e(M.We(null)))}})}),[n,e,t]),null}function tg(e){return tu.sY?e.metaKey:e.ctrlKey}function th(e,t){if((0,eb.Mz)(e)){let n=e.getParent();if((0,eb.HY)(n))return n.getListType()===t}let n=e.getParent();if((0,eb.Mz)(n)){let e=n.getParent();if((0,eb.HY)(e))return e.getListType()===t}return!1}function tp({onEscape:e,onSubmit:t,delegateEscapeHandling:n,hasTypeahead:r,submitOnEnter:l}){return function({onEscape:e,onSubmit:t,delegateEscapeHandling:n,hasTypeahead:r,submitOnEnter:l}){(function({delegateEscapeHandling:e,onEscape:t}){let[n]=(0,e4.DF)();(0,i.useEffect)(()=>e?()=>{}:n.registerCommand(eT.Q$,e=>(t(),!0),eT.d),[e,n,t])})({delegateEscapeHandling:n,onEscape:e}),function({hasTypeahead:e}){let[t]=(0,e4.DF)();(0,i.useEffect)(()=>(0,tu.Sd)(...[eT.UD,eT.bb,eT.AX,eT.JM].map(n=>t.registerCommand(n,tm(e),eT.d))),[t,e])}({hasTypeahead:r}),function({hasTypeahead:e}){let[t]=(0,e4.DF)();(0,i.useEffect)(()=>t.registerCommand(eT.OX,tm(e),eT.d),[t,e])}({hasTypeahead:r}),function({onSubmit:e,submitOnEnter:t}){let[n]=(0,e4.DF)();(0,i.useEffect)(()=>n.registerCommand(eT.if,r=>{if(t&&!r?.shiftKey||r&&(r.altKey||r.metaKey))return e(),r?.preventDefault(),!0;let i=(0,eT.vJ)();if(!(0,eT.I2)(i))return!1;if(null!==r){if((tu.pz||tu.Yw||tu.Dz)&&tu.aT)return!1;r.preventDefault()}return n.dispatchCommand(eT.XK,void 0)},eT.d),[n,e,t])}({onSubmit:t,submitOnEnter:l}),function(){let[e]=(0,e4.DF)();(0,i.useEffect)(()=>e.registerCommand(eT.Wu,()=>{let e=(0,eT.vJ)();if(!(0,eT.I2)(e))return!1;let t=function(e){let t=e.anchor.getNode();return t===e.focus.getNode()?{node:t,point:e.anchor}:null}(e);if(!t)return!1;let n=function(e){let{node:t,point:n}=e;if((0,eb.Mz)(t))return t;let r=t.getParent();return r&&(0,eb.Mz)(r)&&0===n.offset?r:null}(t);if(!n)return!1;let r=(0,eT.lJ)();if(n.replace(r,!0),0===r.getChildrenSize()){let e=(0,eT.sT)("");r.append(e),e.select()}return!0},eT.d),[e])}(),function(){let[e]=(0,e4.DF)(),t=(0,i.useCallback)(t=>{let{shiftKey:n,key:r}=t;return!!tg(t)&&!!n&&("x"===r?(t.preventDefault(),t.stopPropagation(),e.dispatchCommand(eT.mB,"strikethrough"),!0):"8"===r?(t.preventDefault(),t.stopPropagation(),function(e){e.update(()=>{let t=(0,eT.vJ)();(0,eT.I2)(t)&&(th(t.anchor.getNode(),"bullet")?e.dispatchCommand(eb.uS,void 0):e.dispatchCommand(eb.q7,void 0))})}(e),!0):"7"===r&&(t.preventDefault(),t.stopPropagation(),function(e){e.update(()=>{let t=(0,eT.vJ)();(0,eT.I2)(t)&&(th(t.anchor.getNode(),"number")?e.dispatchCommand(eb.uS,void 0):e.dispatchCommand(eb.x,void 0))})}(e),!0))},[e]);(0,i.useEffect)(()=>e.registerRootListener(e=>{if(e)return e.addEventListener("keydown",t),()=>{e.removeEventListener("keydown",t)}}),[e,t])}(),function(){let[e]=(0,e4.DF)(),t=(0,i.useCallback)(t=>{tg(t)&&t.shiftKey&&"u"===t.key&&(t.stopPropagation(),e.dispatchCommand(td,void 0))},[e]);(0,i.useEffect)(()=>e.registerRootListener(e=>{if(e)return e.addEventListener("keydown",t),()=>{e.removeEventListener("keydown",t)}}),[e,t])}(),function(){let[e]=(0,e4.DF)();(0,i.useEffect)(()=>e.registerRootListener(e=>{if(e){let t=e=>{"Escape"!==e.key&&"Backspace"!==e.key&&e.stopPropagation()};return e.addEventListener("keydown",t),()=>{e.removeEventListener("keydown",t)}}}),[e])}()}({onEscape:e,onSubmit:t,delegateEscapeHandling:n,hasTypeahead:r,submitOnEnter:l}),null}function tm(e){return t=>(t.stopPropagation(),!!e()&&(t.preventDefault(),!0))}var ty=n(666875),t_=n(795161);function tx({contactsAnalytics:e,dispatch:t,onUpdateTextArea:n,mentionables:r,isProtoView:l,figmaEditorType:o}){let[s]=(0,e4.DF)(),a=(0,i.useRef)(null),u=(0,i.useRef)(null),[c]=(0,ty.A)(async i=>{let s=(async e=>{u.current&&u.current.cancel(),u.current=new tl.qm;try{return{result:await (0,tl.t8)((0,q.fG)(e,r,!l&&o===W._Y.DESIGN),u.current),canceled:!1}}catch(e){if(e instanceof tl.cJ)return{result:null,canceled:!0};throw e}})(i);(0,t_.Lg)()&&(window.TEST_ONLY_mentionsSearchPending=s);let{result:a,canceled:c}=await s;c||(a?(e.trackQueryResult(a.query,a.mentions.length),t(M.We(a))):t(M.We({type:"mentions",mentions:[],index:0,maxMentions:0,search:i,query:i})),n())},300),d=(0,i.useRef)(c);return d.current=c,(0,i.useEffect)(()=>s.registerUpdateListener(({editorState:e})=>{e.read(()=>{let e=(0,eT.vJ)();if((0,eT.I2)(e)){let n=e.anchor.getNode();if(n instanceof eT.Ey){let r=n.getTextContent(),i=e.anchor.offset,l=r.substring(0,i),o=(0,tl.uT)(l);if(o){let{search:e}=o;e!==a.current&&(a.current=e,d.current(e))}else null!==a.current&&(a.current=null,u.current&&u.current.cancel(),t(M.We(null)))}else null!==a.current&&(a.current=null,u.current&&u.current.cancel(),t(M.We(null)))}})}),[s,t]),null}function tE({contactsAnalytics:e,delegateEscapeHandling:t,dispatch:n,editingComment:l,editorOnClear:o,editorOnInsert:s,editorRef:a,editorType:u,figmaEditorType:c,hasTypeahead:d,isProtoView:f,isThreadCommentOverflowMenuOpen:g,maintainSelectionOnFocus:h,mentionables:p,onCancel:m,onFocus:_,onSubmit:x,onUpdateTextArea:E,setHyperlinkEditorRef:b,setHyperlinkLocation:T,setIsEditorFocused:C,submitOnEnter:k,typeahead:I}){let A=(0,i.useRef)(I);A.current=I;let{insertEmoji:v,insertMention:D,clearTypeahead:L,selectAll:N}=function({contactsAnalytics:e,dispatch:t}){let[n]=(0,e4.DF)(),r=(0,i.useCallback)(e=>{let r=()=>{n.update(()=>{let t=(0,eT.vJ)()??(0,eT.S1)();if(!(0,eT.I2)(t))return;let n=t.anchor.getNode(),r=y.il.getDefaultSkin(),i=r?`:skin-tone-${r}:`:"";e.skins.length<2&&(i="");let l=`:${e.id}:${i}`,o=(0,ej.UF)(l);if(!o||o.length<1)return;let s=ev(o[0].unicode,l);if(n instanceof eT.Ey){let e=n.getTextContent(),r=t.focus.offset,i=e.substring(0,r).match(to.n);if(i){let e=i.index;ts({anchorNode:n,replacementNode:s,end:r,matchText:i[0],selection:t,start:e});return}}let a=t.anchor.offset===n.getTextContent().length;t.insertNodes([s]),a&&ta()}),t(M.We(null))};n.getEditorState().read(()=>(0,eT.vJ)())?r():n.focus(r)},[t,n]);return{insertEmoji:r,insertMention:(0,i.useCallback)((r,i)=>{e.trackResultClicked(i.query,i.index,i.mentions.length,!1),(0,ti.r)(i.query,i,!0),n.update(()=>{let e=(0,eT.vJ)()??(0,eT.S1)();if(!(0,eT.I2)(e))return;let t=e.anchor.getNode(),n="profile_handle"in r,i=n?void 0:r.id,l=n?r.id:void 0,o=n?void 0:r,s=eN({displayText:n?`@${r.profile_handle}`:(0,eP.F)(r.handle)??r.id,userId:i,profileId:l,userAnnotated:o});if(t instanceof eT.Ey){let n=t.getTextContent(),r=e.focus.offset,i=n.substring(0,r),l=(0,tl.uT)(i);if(l){let n=l.index;ts({anchorNode:t,replacementNode:s,end:r,matchText:`@${l.search}`,selection:e,start:n});return}}e.insertNodes([s]),s.selectEnd()}),"profile_handle"in r&&t((0,tr.Hx)(r)),t(M.We(null))},[e,t,n]),clearTypeahead:(0,i.useCallback)(n=>{e.endSession(n),t(M.We(null))},[e,t]),selectAll:(0,i.useCallback)(()=>{n.focus(()=>{n.update(()=>{let e=(0,eT.vJ)();(0,eT.I2)(e)&&(0,tn.e1)(e)})})},[n])}}({contactsAnalytics:e,dispatch:n}),K=function(){let[e]=(0,e4.DF)();return(0,i.useCallback)(()=>e.getEditorState().read(()=>{let e=(0,eT.vJ)();if(!(0,eT.I2)(e))return!1;let{anchor:t,focus:n}=e,r=e.isBackward(),i=r?n:t,l=r?t:n,o=(0,eT.Ni)(),s=function(e,t){let n=e.getFirstDescendant(),r=e.getFirstChild();return n?.getKey()===t?n:r?.getKey()===t?r:null}(o,i.key),a=function(e,t){let n=e.getLastDescendant(),r=e.getLastChild();return n?.getKey()===t?n:r?.getKey()===t?r:null}(o,l.key);return!!s&&!!a&&0===i.offset&&l.offset===((0,eT.ff)(a)?a.getChildrenSize():a.getTextContentSize())}),[e])}(),F=function({editingComment:e,editorType:t,hasTypeahead:n,isThreadCommentOverflowMenuOpen:r,onCancel:l}){let o=!r&&!(e&&"comment-editor-reply"===t);return(0,i.useCallback)(()=>{!n()&&o&&l()},[o,n,l])}({editingComment:l,editorType:u,hasTypeahead:d,isThreadCommentOverflowMenuOpen:g,onCancel:m}),{hasFocus:w,handleOnFocus:R,focus:j}=function({contactsAnalytics:e,maintainSelectionOnFocus:t=!1,onFocus:n,setIsEditorFocused:r,typeaheadRef:l}){let[o]=(0,e4.DF)(),s=(0,i.useRef)(!1),a=(0,i.useCallback)(()=>s.current,[]),u=(0,i.useCallback)(()=>(s.current=!0,r(s.current),n(),!1),[n,r]),c=(0,i.useCallback)(()=>{tc(o,!t)},[o,t]),d=(0,i.useCallback)((e=!0)=>{a()||tc(o,e)},[o,a]),f=(0,i.useCallback)(()=>{s.current=!1,r(s.current);let t=l.current;return t?.type==="mentions"&&t.mentions[t.index]&&(e.endSession("input_blurred"),(0,ti.r)(t.query,t,!1)),!1},[e,r,l]);return(0,i.useLayoutEffect)(()=>(s.current=o.getRootElement()===document.activeElement,(0,tu.Sd)(o.registerCommand(eT.$7,u,eT.Ac),o.registerCommand(eT.pF,f,eT.Ac))),[o,f,u]),{hasFocus:a,handleOnFocus:c,handleOnBlur:f,focus:d}}({contactsAnalytics:e,maintainSelectionOnFocus:h,onFocus:_,setIsEditorFocused:C,typeaheadRef:A});!function({setHyperlinkLocation:e,setHyperlinkEditorRef:t,editorRef:n}){let[r]=(0,e4.DF)();(0,i.useEffect)(()=>n&&e&&t?r.registerCommand(td,()=>(r.update(()=>{let r=(0,eT.vJ)();(0,eT.I2)(r)&&e2(r);let i=(0,eU.L5)();i&&(e(i),t(n))}),!0),eT.d):()=>{},[r,n,t,e])}({setHyperlinkLocation:T,setHyperlinkEditorRef:b,editorRef:a});let P=function({dispatch:e,editorType:t}){let[n]=(0,e4.DF)();return(0,i.useCallback)(r=>{let i=(0,eB.xT)(r);if(!(0,eJ.$x)(i)){e(O.F.enqueue({message:(0,S.t)("hyperlink.invalid_link_plain")}));return}n.update(()=>{!function(e,t){let n=(0,eT.vJ)();if(!(0,eT.I2)(n))return;if(n.isCollapsed()){let r=eV(e,e,t);n.insertNodes([r]);return}let r=new Set;n.getNodes().forEach(e=>{if((0,eT.kF)(e)){let t=e.getParent();eM(t)?r.add(t):r.add(e)}else eM(e)&&r.add(e)});let i=Array.from(r),l=n.anchor,o=n.focus;for(let n=0;n<i.length;n++){let r=i[n];if((0,eT.kF)(r)){let s,a;1===i.length?(s=Math.min(l.offset,o.offset),a=Math.max(l.offset,o.offset)):0===n?(s=l.key===r.getKey()?l.offset:o.offset,a=void 0):n===i.length-1&&(s=0,a=l.key===r.getKey()?l.offset:o.offset),function(e,t,n,r,i){let l=e.getTextContent(),o=r??0,s=i??l.length,a=l.slice(0,o),u=l.slice(o,s),c=l.slice(s),d=[];a&&d.push((0,eT.sT)(a)),u&&d.push(eV(t,u,n)),c&&d.push((0,eT.sT)(c));let[f,...g]=d;f&&(e.replace(f),g.reduce((e,t)=>(t.insertAfter(e),t),f))}(r,e,t,s,a)}else eM(r)&&r.setURL(e)}}(i,t)})},[e,n,t])}({dispatch:n,editorType:u}),B=function(){let[e]=(0,e4.DF)();return(0,i.useCallback)(()=>e.read(()=>eZ()??""),[e])}(),U=function(){let[e]=(0,e4.DF)();return(0,i.useCallback)(()=>{e.update(()=>{!function(){if(!eZ())return;let e=eT.vJ()?.getNodes().filter(eM);e?.forEach(e=>{!function(e){let t=e.getTextContent(),n=(0,eT.sT)(t),r=(0,eT.vJ)();e.replace(n),(0,eT.I2)(r)&&n.select()}(e)})}()})},[e])}(),J=function({dispatch:e,setHyperlinkLocation:t,setHyperlinkEditorRef:n,editorRef:r}){let[l]=(0,e4.DF)();return(0,i.useCallback)((i,o)=>{t&&n&&r&&(e((0,em.jD)()),l.update(()=>{let e=(0,eT.ns)(i);if(!eM(e))return;e.select();let l=(0,eT.vJ)();(0,eT.I2)(l)&&e2(l),o&&(t(o),n(r))}))},[e,l,r,n,t])}({dispatch:n,setHyperlinkLocation:T,setHyperlinkEditorRef:b,editorRef:a});(0,i.useImperativeHandle)(a,()=>({onFocus:R,focus:j,selectAll:N,onSubmitHyperlink:P,onRemoveHyperlink:U,getActiveHyperlinkForCurrentSelection:B,editHyperlinkFromTooltip:J,handleEscape:F,hasFocus:w,isAllSelected:K,insertEmoji:v}),[J,j,B,F,R,U,P,w,v,K,N]);let W=(0,i.useCallback)(()=>{let e=A.current;if(e){if("emojis"===e.type){let t=e.emojis[e.index];t&&v(t)}else if("mentions"===e.type){let t=e.mentions[e.index];t&&D(t,e)}}},[v,D]);return(0,i.useEffect)(()=>{s(W),o(()=>L("editor_clear"))},[L,s,o,W]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(tf,{dispatch:n,onUpdateTextArea:E}),(0,r.jsx)(tx,{contactsAnalytics:e,dispatch:n,onUpdateTextArea:E,mentionables:p,isProtoView:f,figmaEditorType:c}),(0,r.jsx)(tp,{onEscape:F,onSubmit:x,delegateEscapeHandling:t,hasTypeahead:d,submitOnEnter:k})]})}function tb(){let[e]=(0,e4.DF)();return(0,i.useEffect)(()=>e.registerNodeTransform(eT.Ey,e=>{let t=e.getTextContent(),n=(function(e,t){let n=e.getTextContent(),r=n;if((0,eT.I2)(t)&&t.anchor.getNode()===e){let e=t.anchor.offset;r=n.substring(0,e)}return r})(e,(0,eT.vJ)()).match(to.v);if(!n)return;let r=n[0],i=n.index,l=i+r.length;if(!(0,ej.xM)(r))return;let o=(0,ej.UF)(r);if(null==o||0===o.length)return;let s=ev(o[0].unicode,r);switch(function({startOffset:e,endOffset:t,textContent:n}){return 0===e&&t===n.length?"all":0===e?"start":t===n.length?"end":"middle"}({startOffset:i,endOffset:l,textContent:t})){case"all":e.replace(s);break;case"start":{let n=t.slice(l),r=(0,eT.sT)(n);e.insertAfter(r),e.replace(s);break}case"end":{let n=t.slice(0,i),r=(0,eT.sT)(n);e.insertBefore(r);let l=(0,eT.sT)(" ");e.insertAfter(l),e.replace(s),l.select();break}case"middle":{let n=t.slice(0,i),r=t.slice(l),o=(0,eT.sT)(n),a=(0,eT.sT)(r);e.insertBefore(o),e.insertAfter(a),e.replace(s)}}}),[e]),null}var tT=n(832937);function tC({onFilePaste:e}){let[t]=(0,e4.DF)();return(0,i.useEffect)(()=>t.registerCommand(eT.w,t=>{let[,n,r]=(0,tT.gA)(t);return n.length>0&&!r&&(e(n),!0)},eT.Ac),[t,e]),null}function tk({initMention:e}){let[t]=(0,e4.DF)(),n=(0,i.useRef)();return(0,i.useEffect)(()=>{let r=n.current;e&&!r&&t.update(()=>{let e=(0,eT.vJ)();(0,eT.I2)(e)&&e.insertText("@")}),n.current=e},[t,e]),null}function tI({maxLength:e}){let[t]=(0,e4.DF)();return(0,i.useEffect)(()=>{let n=null;return t.registerNodeTransform(eT.h,r=>{let i=(0,eT.vJ)();if(!(0,eT.I2)(i)||!i.isCollapsed())return;let l=t.getEditorState(),o=l.read(()=>r.getTextContentSize()),s=r.getTextContentSize();if(o!==s){let r=s-e,a=i.anchor;r>0&&(o===e&&n!==l?(n=l,(0,tu.Xq)(t,l)):(0,tn._A)(t,a,r))}})},[t,e]),null}function tA({messageMeta:e,editorType:t}){let[n]=(0,e4.DF)(),r=(0,ep.ZC)(e);return i.useEffect(()=>{if(r&&!(0,E.Wf)(e,r)){let r=eH(n.getEditorState());if(!(0,E.Wf)(r,e)){let r=eq(e,t);n.setEditorState(r),n.focus()}}},[n,e,r,t]),null}function tv({shouldAutoFocus:e}){let[t]=(0,e4.DF)();return i.useEffect(()=>{e&&t.focus()},[t,e]),null}var tS=n(725694),tO=n(901144);let tM=[tS.d7,tS.Pi,tS.Eg,tS.gW,tS.NB,tS.mK,tS.WY];function tD(){return(0,r.jsx)(tO.E,{transformers:tM})}let tL=i.forwardRef(function(e,t){let{ariaLabel:n,className:l,currentOrgId:o,currentOrgUsers:s,delegateEscapeHandling:a,dispatch:u,editingComment:c,editorOnClear:d,editorOnInsert:f,editorRef:g,editorType:h,figmaEditorType:p,initMention:y,isProtoView:_,isThreadCommentOverflowMenuOpen:x,maintainSelectionOnFocus:E,maxCommentLength:b,mentionables:T,messageMeta:C,onCancel:k,onFilePaste:I,onFocus:A,onSubmit:v,onUpdateTextArea:S,openFileKey:O,openFileTeamId:D,placeholderText:L,readOnly:N,setHyperlinkEditorRef:K,setHyperlinkLocation:F,setIsEditorFocused:w,showDebugger:R,submitOnEnter:j,tabIndex:P,typeahead:B,updateMessage:U,user:J}=e,W=function({messageMeta:e,editorType:t,editable:n}){let[r]=(0,i.useState)(()=>eq(e,t));return(0,i.useMemo)(()=>eF({editorState:r,editorType:t,editable:n}),[n,t,r])}({messageMeta:C,editorType:h,editable:!N}),H=function({currentOrgId:e,currentOrgUsers:t,openFileKey:n,openFileTeamId:r,user:l}){return(0,i.useMemo)(()=>{let i=(0,e_.Ty)(e??null,l??null,t),o=(0,e_.pP)(e,r,i);return new e_.yO(e_.I2,n,o,e,r,"lexical")},[e,t,n,r,l])}({currentOrgId:o,currentOrgUsers:s,openFileKey:O,openFileTeamId:D,user:J}),q=function(){let[e]=(0,i.useState)(()=>{let e=["onMouseDown"];return ex.eD||e.push("onContextMenu"),e});return e}(),$=(0,ep.ZC)(B),Y=i.useRef(B);Y.current=B;let z=(0,i.useCallback)(()=>!!Y.current,[]);return(0,i.useEffect)(()=>{g&&h&&u(em.pP({targetKey:h,targetRef:g}))},[u,g,h]),(0,i.useEffect)(()=>{$||B?.type!=="mentions"||u((0,M.Qe)())},[$,B,u]),(0,r.jsx)("div",{className:m()(eC.DX,l||eC.DL),"data-testid":"editable-typeahead",children:(0,r.jsx)(el.o,{eventListeners:q,children:(0,r.jsxs)(es.n,{initialConfig:W,children:[(0,r.jsx)(ec.G,{}),(0,r.jsx)(eh.$,{contentEditable:(0,r.jsx)("div",{className:"x1n2onr6",children:(0,r.jsx)(ea.a,{"aria-haspopup":"listbox","aria-placeholder":L??"",ariaActiveDescendant:B?.type==="mentions"?e.activeMentionsId:void 0,ariaControls:B?.type==="mentions"?ey.Qd:void 0,ariaExpanded:B?.type==="mentions",ariaLabel:n??L,placeholder:(0,r.jsx)("span",{className:"x3vvef7 x10l6tqk x13vifvy xu96u03 x47corl",children:L}),role:"combobox",tabIndex:P})}),ErrorBoundary:eu.A}),(0,r.jsx)(eg.D,{onChange:e=>{U([eH(e),e.read(()=>{let e=(0,eT.vJ)();if(!(0,eT.I2)(e))return!1;let t=(0,eT.Ni)(),n=t.getChildren();if(0===n.length)return!1;let r=n[n.length-1],i=n.length>1?n[n.length-2]:null,l=e.getNodes()[e.getNodes().length-1]??e.focus.getNode();for(;l&&l.getParent()!==t;)l=l.getParent();return l===r||null!=i&&l===i})])}}),(0,r.jsx)(tv,{shouldAutoFocus:!0}),(0,r.jsx)(tA,{messageMeta:C,editorType:h}),(0,r.jsx)(tk,{initMention:y}),null!=b&&b>0&&(0,r.jsx)(tI,{maxLength:b}),(0,r.jsx)(tb,{}),null!=I&&(0,r.jsx)(tC,{onFilePaste:I}),(0,r.jsx)(tE,{contactsAnalytics:H,delegateEscapeHandling:a,dispatch:u,editingComment:c,editorOnClear:d,editorOnInsert:f,editorRef:g,editorType:h,figmaEditorType:p,hasTypeahead:z,isProtoView:_,isThreadCommentOverflowMenuOpen:x,maintainSelectionOnFocus:E,mentionables:T,onCancel:k,onFocus:A,onSubmit:v,onUpdateTextArea:S,setHyperlinkEditorRef:K,setHyperlinkLocation:F,setIsEditorFocused:w,submitOnEnter:j,typeahead:B}),(0,r.jsx)(eo.p,{matchers:eG}),(0,r.jsx)(ed.W,{validateUrl:eQ}),(0,r.jsx)(tD,{}),(0,r.jsx)(ef.Q,{}),R&&(0,r.jsx)(tt,{})]})})})});var tN=n(788965),tK=n(156071);let tF=[];function tw(e){let t=(0,S.t)("comments.submit");return(0,r.jsx)(s.K,{recordingKey:k.Pt(e,"submit"),disabled:e.disabled,onClick:e.onClick,"data-tooltip-type":Y.Ib.TEXT,"data-tooltip":t,"aria-label":t,htmlAttributes:{"data-testid":"comments-submit-button"},variant:"primaryCircle",children:(0,r.jsx)(u.N,{})})}let tR=e=>{switch(e.type){case $.Wn.MAX_UPLOADS_EXCEEDED:return(0,S.t)("comments.upload_error.media_file_maximum",e.params);case $.Wn.MAX_IMAGE_SIZE_EXCEEDED:case $.Wn.MAX_VIDEO_SIZE_EXCEEDED:return(0,S.t)("comments.upload_error.media_file_size_limit_MB",e.params);case $.Wn.INVALID_FILE_TYPE:return(0,S.t)("comments.upload_error.media_file_types");case $.Wn.DUPLICATE_FILE_UPLOAD:return(0,S.t)("comments.upload_error.already_uploaded_items",e.params);case $.Wn.FAILED_TO_UPLOAD:return(0,S.t)("comments.upload_error.failed_to_upload",e.params);default:(0,o.xb)(e)}};function tj(e){let[t,n]=i.useState(e.mountInputFocused||e.mountWithButtons||!1),[o,u]=i.useState(!1),p=i.useRef(null),z=i.useRef(null),X=(0,U.iZ)(),G=(0,J.f)("has_opened_comments_modal"),{threadPosition:Q,dispatch:V,viewportPositionFromClientPosition:el,setHyperlinkLocation:eo,setHyperlinkEditorRef:es,editorRef:ea,scrollToBottom:eu}=e,ec=(0,B.q5)(),ed=ec?.key||null,ef=(0,l.d4)(e=>e.currentUserOrgId),eg=ec?.teamId,eh=(0,l.d4)(e=>e.orgUsersByOrgId),ep=(0,tN.i)(),em=(0,l.d4)(e=>e.comments.editingComment),ey=!!(0,J.f)("has_mentioned_pending_user_invite"),e_=!!(0,J.f)("has_mentioned_pending_user_invite_twice"),ex=(0,h.Xr)(P.H),[eE,eb]=i.useState(!1),eT=(0,N.lg)(),eC=(0,N.HW)(),ek=(0,l.d4)(e=>e.comments.activeDragTarget),eI=(0,L.y)(),eA=(0,h.md)(P.H),ev=(0,R.eR)(e.threadId)&&eI({isDraftFile:!eg,isMobile:T.Ay.isMobileBrowser,showExpAtMentionInvite:!!(0,g.kc)().show_at_mention_invited_users,isFigmaDesign:eT===W._Y.DESIGN,inOrg:!!ef})&&eA||[],eS=i.useCallback(e=>{if(eo&&es){if(e?.top===0&&e?.bottom===0&&e?.left===0&&e?.right===0&&e?.height===0&&e?.width===0&&z.current){let e=(0,x.E)(z.current.getBoundingClientRect());eo({...e,width:32,top:e.top+12})}else eo(e);es(ea)}},[eo,es,ea]),eO=(0,l.Pj)();i.useEffect(()=>{let t=!(0,R.eR)(e.threadId);(0,F.uE)("Comment composer opened",eO.getState(),{isThread:t}),G||eO.dispatch(D.b({has_opened_comments_modal:!0}))},[eO,e.threadId,G]);let eM=(0,l.d4)(e=>e.comments.emojiPicker),eD=i.useCallback(()=>eM?.visible?(eM.onCancel?.(),V(M.RI({visible:!1})),!0):(e.editorRef.current&&e.editorRef.current.handleEscape(),!1),[e.editorRef,eM,V]),eL=i.useCallback(()=>{e.editorRef.current&&e.editorRef.current.onFocus()},[e.editorRef]),eN=()=>{e1()||e.onSubmit()},eK=e=>{e.preventDefault(),eN()},eF=()=>{!1!==e.onCancel()&&n(!1)},ew=i.useCallback(e=>{eu&&(e?setTimeout(eu,e):eu())},[eu]);(0,b.h)(()=>{e.scrollToBottom&&z.current&&new MutationObserver(e.scrollToBottom).observe(z.current,{childList:!0,subtree:!0})}),i.useEffect(()=>{(0,g.kc)().autofocus_edit_comment&&e.editingExistingComment&&eL()},[eL,e.editingExistingComment]);let eR=k.qP(e.recordingKey,"update",([t,n])=>{n&&!e2(e.messageMeta)&&ew(100),e.updateMessage(t)}),ej=k.qP(e.recordingKey,"emojiPick",t=>{if(e.editorRef&&e.editorRef.current){let n=y.dN.get(t.id);n&&e.editorRef.current.insertEmoji(n),e.dispatch(M.RI({visible:!1}))}}),eP=async()=>{e.dispatch(M.We(await (0,q.fG)("",e.mentionables,eT===W._Y.DESIGN))),(0,_.sx)("Comment Composer At Mention Clicked",{userId:e.user.id,fileKey:e.fileKey,parentCommentId:e.threadId}),u(!0),setTimeout(()=>{u(!1)},250),e.editorRef.current?.focus(!1)},eB=e.allowAttachments,{updateAttachment:eU,deleteAttachment:eJ}=e,eW=e.attachments?.sort((e,t)=>e.uploadedAt.getTime()-t.uploadedAt.getTime())??tF,[eH,eq]=i.useState(eW.length),[e$,eY]=i.useState({}),ez=eW.some(e=>e.isUploading),eX=i.useRef(null),eG=i.useCallback(e=>{eq(e=>e-1),e$.hasOwnProperty(e.id)?eJ&&eJ(e.id,e$[e.id]):eJ&&eJ(e.id)},[eJ,e$]),eQ=i.useCallback((e,t)=>{if(e instanceof C.qW){(0,er.MZ)(V,(0,S.t)("check_network_compatibility.error_bell.comment_attachments.message"));return}V(O.F.enqueue({message:tR(e)})),t&&eG(t)},[V,eG]),eV=i.useCallback(t=>{if(!eB||!eU||0===t.length)return;let n=(0,H.K)(t,eH,w.xS,$.xp,eQ);eq(e=>e+n.length),n.forEach((t,n)=>{if($.xp.includes(t.type)){let r=URL.createObjectURL(t),i=new Date;i.setMilliseconds(i.getMilliseconds()+n),(0,w.JZ)(e.recordingKey,eU,eY,eQ,r,t.type,ed,i,t.name||null)}else throw Error("unexpected file type")})},[eB,eU,eH,eQ,e.recordingKey,ed]),eZ=i.useCallback(e=>()=>{let t=e.current?.files||null;if(null===t||0===t.length)return;let n=Array.from(t);(0,_.sx)("Comment Attachments Selected",{count:n.length,fileTypes:Array.from(n.reduce((e,t)=>(e.add(t.type),e),new Set))}),eV(n),e.current&&(e.current.value="")},[eV]),e0=(0,K.k)(),e1=()=>e.isDisabled||ez||e2(e.messageMeta)||(0,E.q)(e.messageMeta)||e0,e2=e=>(0,E.I)(e),e6=e1(),e5=e2(e.messageMeta)&&(!eB||0===eW.length),e7=(0,h.md)(en.p),e9=eB&&ek===e.recordingKey&&!(0,R.eR)(e.threadId),e3=(0,g.kc)().comments_lexical?tL:ei.iX;return(0,r.jsxs)(A.Y,{className:m()(e.containerClassName||{[tK.fP]:!0,[tK.U0]:(0,R.eR)(e.threadId),[tK.mr]:e9},e5&&tK.Sg),isDragTarget:()=>eB,onTargetDrop:e=>{if(e.files.length>0){let t=Array.from(e.files);(0,_.sx)("Comment Attachments Dropped",{count:t.length,fileTypes:Array.from(t.reduce((e,t)=>(e.add(t.type),e),new Set))}),eV(t)}V(M.uz(null))},onTargetDragEnter:t=>{V(M.uz(e.recordingKey))},onTargetDragLeave:e=>{V(M.uz(null))},forwardedRef:z,"data-testid":e.editingExistingComment?"edit-comment-composer-container":"new-comment-composer-container",children:[(0,r.jsx)(j.$W,{handleEscape:eD,priority:j.KD.EDITING_TEXT_FIELD,children:(0,r.jsx)(e3,{ref:e.editorRef,activeMentionsId:e7,ariaLabel:e.ariaLabel,className:e.editableTypeaheadClassName||tK.OX,currentOrgId:ef,currentOrgUsers:eh,delegateEscapeHandling:!0,dispatch:e.dispatch,editingComment:em??void 0,editorOnClear:e.editorOnClear,editorOnInsert:e.editorOnInsert,editorRef:e.editorRef,editorType:e.editorType,figmaEditorType:eT,hasMentionedPendingUserInvite:ey,hasMentionedPendingUserInviteTwice:e_,hyperlinkLocation:e.hyperlinkLocation,initMention:o,isProtoView:eC,isThreadCommentOverflowMenuOpen:ep,maintainSelectionOnFocus:e.maintainSelectionOnFocus,maxCommentLength:e.maxCommentLength,mentionables:e.mentionables,messageMeta:e.messageMeta,mountInputFocused:e.mountInputFocused,onCancel:eF,onFilePaste:e=>{if(e.length>0){let t=e.map(e=>new File([e],"",{type:e.type}));(0,_.sx)("Comment Attachments Pasted",{count:t.length,fileTypes:Array.from(t.reduce((e,t)=>(e.add(t.type),e),new Set))}),eV(t)}},onFocus:()=>{e.onComposeFocus&&e.onComposeFocus(),!t&&(n(!0),e.onEditStart&&e.onEditStart())},onSubmit:eN,onUpdateTextArea:e=>{if(!Q||!z.current)return;let t=z.current.getBoundingClientRect(),n=el(new I.Mi(t.right,t.top)),r=el(new I.Mi(t.left,t.bottom));V(M.i4({top:n.y-Q.y,right:n.x-Q.x,bottom:r.y-Q.y,left:r.x-Q.x,height:t.height,width:t.width})),ey&&e_||!ev||!(ev.length>0)||eE||e?.getCurrentContent().getPlainText()!==`${ev[0].user?.email} `||(V(M.We((0,et.tI)({index:-1,userId:X?.id}))),eb(!0))},openFileKey:ed,openFileTeamId:eg,pendingUserInvites:ev,placeholderText:e.placeholderText,readOnly:e.readOnly,setHyperlinkEditorRef:es,setHyperlinkLocation:eS,setIsEditorFocused:e.setIsEditorFocused,setPendingUserInvitesAtom:ex,submitOnEnter:e.submitOnEnter??!0,typeahead:e.typeahead,updateMessage:eR,user:X})}),eB&&eU&&eW.length>0&&(0,r.jsx)(Z,{attachments:eW,fileKey:ed,onDelete:eG,onUpdate:eU,focusComposer:eL}),(0,r.jsxs)("div",{className:tK.o1,children:[!e5&&(0,r.jsxs)("div",{className:tK.xu,children:[ee.Y&&(0,r.jsx)(s.K,{onClick:t=>{(0,_.sx)("Emoji Picker Opened");let n=p.current?.getBoundingClientRect();n&&e.dispatch(M.RI({visible:!0,targetRect:n,onPick:t=>{ej(t),e.editorRef.current?.focus()},onCancel:()=>{e.editorRef.current?.focus(),e.dispatch(M.RI({visible:!1}))}}))},ref:p,"data-tooltip-type":Y.Ib.TEXT,"data-tooltip":(0,S.t)("comments.add_emoji"),"aria-label":(0,S.t)("comments.add_emoji"),htmlAttributes:{"data-testid":"emoji-picker-button"},recordingKey:"emojiPicker",disabled:e5,children:(0,r.jsx)(c.A,{})}),(0,r.jsx)(s.K,{onClick:eP,"data-tooltip-type":Y.Ib.TEXT,"data-tooltip":(0,S.t)("comments.add_mention"),"aria-label":(0,S.t)("comments.add_mention"),disabled:e5,recordingKey:"mentionButton",children:(0,r.jsx)(d,{})}),eB&&(0,r.jsx)(v.n,{svgAltText:(0,S.t)("comments.upload_images"),isDisabled:eW.length>=w.xS,acceptedFileTypes:$.xp.join(","),inputRef:eX,inputId:`fileUploadIconInput-${e.recordingKey}`,onFileInputChange:eZ,"data-tooltip-type":Y.Ib.TEXT,"data-tooltip":(0,S.t)("comments.upload_images"),children:(0,r.jsx)("span",{"aria-hidden":!0,children:(0,r.jsx)(f.s,{})})})]}),!e.hideSubmitButton&&(e.editingExistingComment?(0,r.jsxs)("div",{className:tK.q9,children:[(0,r.jsx)(a.$n,{variant:"secondary",onClick:eF,children:(0,S.tx)("comments.cancel")}),(0,r.jsx)(a.$n,{variant:"primary",onClick:eK,disabled:e6,recordingKey:k.Pt(e,"editSave"),children:e.submitText})]}):(0,r.jsx)(tw,{recordingKey:e.recordingKey,onClick:eK,disabled:e6}))]})]})}},484655:(e,t,n)=>{n.d(t,{r:()=>i});var r=n(883765);function i(e,t,n){let i=t.index,l=t.mentions?t.mentions.length:0;(0,r.sx)("at_mention_search_metrics",{did_click_through:n,search_text_length:e.length,selected_index:i,suggestions_length:l})}},403206:(e,t,n)=>{function r(e){let t;let n=0,r=0;-1!==e.lastIndexOf("\n")&&(r=e.lastIndexOf("\n")+1,e=e.substring(r));let i=e.lastIndexOf("@");if(-1!==i){if(t=e.substring(i+1),n=i," "===t.substring(0,1)||t.length>100)return null;let r=e.substring(0,i),l=r.lastIndexOf("@");if(-1!==l){let i=e.substring(l+1);if(-1===i.indexOf(" ")){if(0!==l&&" "!==r[l-1])return null;t=i,n=l}}else if(0!==i&&![" ","[","{","("].includes(e[i-1]))return null}return null!=t?{search:t,index:n+=r}:null}n.d(t,{cJ:()=>l,qm:()=>i,t8:()=>o,uT:()=>r});class i{constructor(){this._isCanceled=!1,this._isEnabled=!0}isCanceled(){return!!this._isEnabled&&this._isCanceled}reset(){this._isEnabled=!1}cancel(){this._isEnabled&&(this._isCanceled=!0)}}class l extends Error{}async function o(e,t){let n=await e;if(t.isCanceled())throw t.reset(),new l;return t.reset(),n}},335963:(e,t,n)=>{n.d(t,{n:()=>r,v:()=>i});let r=/:([0-9A-Za-z-_+]+)$/,i=/(:[0-9A-Za-z-_+]+:)$/},683785:(e,t,n)=>{n.d(t,{AO:()=>a,Ed:()=>d,Ly:()=>c,gG:()=>u,rv:()=>f});var r=n(291705),i=n(873304),l=n(372868),o=n(750802),s=n(695370);function a(e,t){let n=e.getCurrentContent();if(t.id.startsWith("invite-")&&!("profile_handle"in t)){let r=n.createEntity("INVITE","IMMUTABLE",{mention:t}).getLastCreatedEntityKey(),i=(0,s.TE)(e);return g(e,i,r,(0,o.F)(t.handle)||"",!1)}let r=n.createEntity("MENTION","IMMUTABLE",{mention:t}).getLastCreatedEntityKey(),i=(0,s.TE)(e),l="profile_handle"in t?`@${t.profile_handle}`:t.handle;return g(e,i,r,(0,o.F)(l)||"",!1)}function u(e,t){let n=i.il.getDefaultSkin(),r=n?`:skin-tone-${n}:`:"";return t.skins.length<2&&(r=""),c(e,`:${t.id}:`+r)}function c(e,t){let n=(0,s.TE)(e),r=(0,l.UF)(t)[0].unicode,i=e.getCurrentContent().createEntity("EMOJI","IMMUTABLE",{text:t,unicode:r}).getLastCreatedEntityKey();return g(e,n,i,r,!1)}function d(e,t){let n=e.getCurrentContent().createEntity("SUGGESTION","IMMUTABLE",{suggestion:t}).getLastCreatedEntityKey(),r=(0,s.TE)(e);return g(e,r,n,t.suggestionInsert,t.suggestionInsert.includes("@"))}function f(e,t){let n=e.getCurrentContent().createEntity("INVITE","IMMUTABLE",{mention:{email:t.user.email,id:`invite-${t.id}`}}).getLastCreatedEntityKey(),r=(0,s.TE)(e);return t.user.email?g(e,r,n,t.user.email,!1):e}let g=(e,t,n,i,l)=>{let o=e.getSelection(),a=e.getCurrentContent(),{start:u,end:c}=t,d=o;null!=u&&null!=c&&(d=o.merge({anchorOffset:u,focusOffset:c}));let f=r.Modifier.replaceText(a,d,i,void 0,n),g=f.getSelectionAfter(),h=f.getLastBlock();h.getKey()===g.getStartKey()&&h.getKey()===g.getEndKey()&&h.getLength()===g.getStartOffset()&&h.getLength()===g.getEndOffset()&&(f=r.Modifier.replaceText(f,g,l?"":" ",void 0,void 0));let p=r.EditorState.push(e,f,"insert-fragment");return l?(0,s.aC)(p,"@"):r.EditorState.forceSelection(p,f.getSelectionAfter())}},695370:(e,t,n)=>{n.d(t,{Aw:()=>Y,Bm:()=>_,DL:()=>b,Er:()=>T,FA:()=>N,Gm:()=>I,Ji:()=>w,L5:()=>S,M1:()=>O,Qo:()=>D,TE:()=>v,Wt:()=>U,XM:()=>B,_S:()=>V,aC:()=>A,c9:()=>L,cL:()=>x,d8:()=>F,f7:()=>C,jM:()=>X,lZ:()=>q,mi:()=>E,oP:()=>J,q7:()=>W,wT:()=>K,ws:()=>Z,yN:()=>H});var r=n(291705),i=n(779666),l=n.n(i),o=n(686549),s=n(466890),a=n(372868),u=n(750802),c=n(390036),d=n(116553),f=n(403206),g=n(335963),h=n(479929);let p={BOLD:"b",ITALIC:"i",STRIKETHROUGH:"s"},m={b:"BOLD",i:"ITALIC",s:"STRIKETHROUGH"},y={BOLD:[{char:"*",sequence:"**"},{char:"_",sequence:"__"}],ITALIC:[{char:"*",sequence:"*"},{char:"_",sequence:"_"}],STRIKETHROUGH:[{char:"~",sequence:"~"}]},_=new Set(["*","-","+"]);function x(e,t,n){return k(e,t,n,"EMOJI")}function E(e,t,n){return k(e,t,n,"HYPERLINK")}function b(e,t){let n=e.getText();for(let r of(0,h.Vt)(n).filter(t=>{for(let n=t.start;n<t.end;n++)if(e.getEntityAt(n))return!1;return!0}))t(r.start,r.end)}function T(e,t,n){return k(e,t,n,"MENTION")}function C(e,t,n){return k(e,t,n,"INVITE")}let k=(e,t,n,r)=>{e.findEntityRanges(e=>(function(e,t,n){return null!==t&&e.getEntity(t).getType()===n})(n,e.getEntity(),r),t)};function I(e){let t=e.getSelection(),n=e.getCurrentContent(),r=t.getAnchorKey(),i=n.getBlockForKey(r),l=t.getAnchorOffset(),o=i.getText().substring(0,l),s=(0,f.uT)(o);return null!==s?s.search:""}function A(e,t){let n=e.getCurrentContent().getBlockMap().toArray(),i=null;for(let e of n){let n=e.getText().indexOf(t);if(-1!==n){i={blockKey:e.getKey(),position:n+1};break}}if(i){let t=new r.SelectionState({anchorKey:i.blockKey,anchorOffset:i.position,focusKey:i.blockKey,focusOffset:i.position});return r.EditorState.forceSelection(e,t)}return e}function v(e){let t,n,r,i;let l=e.getSelection(),o=e.getCurrentContent(),c=l.getAnchorKey(),d=o.getBlockForKey(c),h=l.getAnchorOffset(),p=o.getBlocksAsArray(),m=H(e),y=d.getText().substring(0,h),_=y.match(g.n),x=y.match(g.v),E=(0,f.uT)(y);if(E){let e=function(e,t,n,r,i){let{token:l}=function e(t,n){let r=0;for(let i=0;i<n.length;i++){if(n[i].children?.length){let{lengthOfText:l,token:o}=e(t-r,n[i].children);if((r+=l)>t)return{lengthOfText:r,token:o}}else n[i].t?r+=n[i].t?.replace(/\n/g,"").length||0:r+=u.F(n[i].user_annotated?.handle)?.length||0;if((r+="profile_id"in n[i]?1:0)>t)return{lengthOfText:r,token:n[i]}}return{lengthOfText:r,token:null}}(function(e,t,n,r){let i=0;for(let n=0;n<e.length&&e[n]!==t;++n)i+=e[n].getText().replace(/\n/g,"").length;return i+(n-(r.match(/\n/g)||[]).length)}(e,t,n,i),r);return l}(p,d,E.index,m,y);E=e&&(0,s.l5)(e)===s.vj.PLAIN_TEXT?E:null}return E?(t="MENTION",n=E.search,r=E.index,i=h):_?(t="EMOJI",n=_[1],r=_.index,i=h):x&&(0,a.xM)(x[1])&&(t="COMPLETE_EMOJI",n=x[1],r=x.index,i=h),{type:t,search:n,start:r,end:i}}function S(){let e=window.getSelection();if(e&&e.rangeCount>0){let t=e.getRangeAt(0).getBoundingClientRect();return(0,o.E)(t)}return null}function O(e){var t;let n=e.getSelection(),r=null;if((t=n).getStartKey()===t.getEndKey()){let t=F(e),i=[];if(t.findEntityRanges(t=>{let n=t.getEntity();return null!==n&&"HYPERLINK"===e.getCurrentContent().getEntity(n).getType()},(e,t)=>{i.push({start:e,end:t})}),i.length<1)return{selection:n,entityKey:r};let l={start:n.getStartOffset(),end:n.getEndOffset()};for(let o of i)if(l.start>=o.start&&l.end<=o.end){n=w(e,o),r=t.getEntityAt(o.start);break}}return r&&(n=D(e,n,r)),{selection:n,entityKey:r}}function M(e,t,n,r){let i=t.getEntityAt(n);if(!i)return!1;let l=e.getEntity(i);return"HYPERLINK"===l.getType()&&l.getData().hyperlink===r}function D(e,t,n){let r=e.getCurrentContent(),i=r.getEntity(n);if(!i||"HYPERLINK"!==i.getType())return t;let l=i.getData().hyperlink,o=r.getBlockForKey(t.getStartKey()),s=t.getStartOffset(),a=o,u=s-1;e:for(let e=0;e<r.getBlocksAsArray().length&&a;e++){for(;u>=0;u--){if(!M(r,a,u,l))break e;o=a,s=u}a=r.getBlockBefore(a.getKey()),u=(a?.getLength()||0)-1}let c=r.getBlockForKey(t.getEndKey()),d=t.getEndOffset();a=c,u=d+1;e:for(let e=0;e<r.getBlocksAsArray().length&&a;e++){for(;u<=a.getLength();u++){if(!M(r,a,u-1,l))break e;c=a,d=u}a=r.getBlockAfter(a.getKey()),u=1}return t.merge({anchorOffset:s,anchorKey:o.getKey(),focusOffset:d,focusKey:c.getKey()})}function L(e){let t=e.getSelection();return t.getAnchorKey()===t.getFocusKey()&&t.getAnchorOffset()===t.getFocusOffset()}function N(e){let t=e.getCurrentContent();return!t.hasText()&&"unstyled"===t.getBlockMap().first().getType()}function K(e){return!!L(e)&&0===e.getSelection().getStartOffset()}function F(e){let t=e.getSelection().getAnchorKey();return e.getCurrentContent().getBlockForKey(t)}function w(e,t){let n=F(e);return r.SelectionState.createEmpty(n.getKey()).merge({anchorOffset:t.start,focusOffset:t.end})}function R(e,t,n){let i=w(e,t);return r.Modifier.replaceText(e.getCurrentContent(),i,n)}let j=e=>{let{index:t,char:n,line:r,numRepeats:i,exactMatch:l}=e;if(l&&t-i-1>=0&&r.charAt(t-i-1)===n)return!1;for(let e=0;e<i;e++)if(r.charAt(t-e-1)!==n)return!1;return!0},P=(e,t,n)=>{if(n-1>0&&" "===e.charAt(n-1))return null;for(let r=n-1;r>=0;r--){if(" "===e.charAt(r))continue;let i=!1;switch(t){case"BOLD":for(let{char:t,sequence:l}of y.BOLD)e.charAt(r)!==t&&e.charAt(n)===t&&j({index:r,char:t,line:e,numRepeats:l.length,exactMatch:!1})&&(i=!0);break;case"ITALIC":for(let{char:t,sequence:l}of y.ITALIC)if(e.charAt(r)!==t&&e.charAt(n)===t&&j({index:r,char:t,line:e,numRepeats:l.length,exactMatch:!1})){if("_"===t){let t=r-l.length-1;(t<0||" "===e.charAt(t))&&(i=!0)}else i=!0}break;case"STRIKETHROUGH":for(let{char:t,sequence:l}of y.STRIKETHROUGH)e.charAt(r)!==t&&e.charAt(n)===t&&j({index:r,char:t,line:e,numRepeats:l.length,exactMatch:!1})&&(i=!0)}if(i)return{start:r,end:n}}return null};function B(e,t){if(!L(e))return null;let n=e.getSelection(),r=F(e),i=n.getAnchorOffset();if(0===i&&""===t){let t=e.getCurrentContent().getBlockBefore(r.getKey());if(!t)return null;r=t,i=t.getLength()}let l=r.getText();for(let e of Object.keys(y))for(let n of y[e]){let{char:r,sequence:o}=n;if(t!==r&&j({index:i,char:r,line:l,numRepeats:o.length,exactMatch:!0})){let t=P(l,e,i-o.length);if(t)return{sequence:o,style:e,range:t}}}return null}function U(e,t){if(" "!==t||!L(e))return null;let n=e.getSelection(),r=F(e);if(" "===t){let e=l()(r.getText().slice(0,n.getAnchorOffset()));if(_.has(e))return"unordered-list-item";if("1."===e)return"ordered-list-item"}return null}function J(e,t,n){let{sequence:i,style:l,range:o}=n;if(t.length){let n=r.Modifier.insertText(e.getCurrentContent(),w(e,{start:o.end+i.length,end:o.end+i.length}),t);e=r.EditorState.push(e,n,"insert-characters")}let s=r.Modifier.removeRange(e.getCurrentContent(),w(e,{start:o.end,end:o.end+i.length}),"backward");s=r.Modifier.removeRange(s,w(e,{start:o.start-i.length,end:o.start}),"backward");let a={start:o.start-i.length,end:o.end-i.length},u=w(e,a),c=r.Modifier.applyInlineStyle(s,u,l);e=r.EditorState.push(e,c,"change-inline-style");let d={start:a.end+t.length,end:a.end+t.length};return e=r.EditorState.forceSelection(e,w(e,d))}function W(e,t){let n={start:0,end:e.getSelection().getAnchorOffset()},i=F(e).getText().slice(n.start,n.end),l=R(e,n,`${i} `),o=R(e=r.EditorState.push(e,l,"insert-characters"),{start:n.start,end:n.end+1},""),s={start:0,end:0},a=w(e,s),u=r.Modifier.setBlockType(o,a,t);return e=r.EditorState.push(e,u,"change-block-type"),e=r.EditorState.forceSelection(e,w(e,s))}function H(e){let t,n;let i=[],l="",o=e=>{let t=n||i;e.profile_id||e.user_id||e.user_annotated||e.styles||e.link?t.push(e):""!==e.t&&(t.length&&"t"in t[t.length-1]&&1===Object.keys(t[t.length-1]).length?t[t.length-1].t+=e.t:t.push(e))},s=(e,t,n)=>{let r=a.entityMap[e.key],i={};"MENTION"===r.type&&"profile_handle"in r.data.mention?(i.profile_id=r.data.mention.id,i.t=r.data.mention.profile_handle):"MENTION"===r.type?(i.user_id=r.data.mention.id,i.user_annotated=r.data.mention):"HYPERLINK"===r.type?(i.link=r.data.hyperlink,i.t=t):"EMOJI"===r.type?i.t=r.data.text:"INVITE"===r.type?(i.t=r.data.mention.email,i.user_id=r.data.mention.id):(i.t=t,n.length&&(i.styles=n)),o(i)},a=(0,r.convertToRaw)(e.getCurrentContent()),d="";return a.blocks.forEach(e=>{let r=(0,c.Qt)((0,u.F)(e.text)||"");["ordered-list-item","unordered-list-item"].includes(e.type)?(e.type!==l&&(n&&i.push({styles:["ordered-list-item"===l?"ol":"ul"],children:t}),t=[],n=[]),t||=[],n||=[],l=e.type.slice()):(i.length&&""===l&&o({t:"\n"}),n&&(i.push({styles:["ordered-list-item"===l?"ol":"ul"],children:t}),t=void 0,n=void 0),l="");let a={};e.entityRanges.forEach(e=>{a[e.offset]=e});let f={};(0,h.Vt)(e.text).forEach(e=>{let{start:t,end:n}=e;for(let e=t;e<n;e++)if(a[e])return;f[t]=e});let g={};e.inlineStyleRanges.forEach(e=>{e.offset in g?g[e.offset].push(e):g[e.offset]=[e]});let m=[],y={};for(let e=0;e<r.length;e++){if(e in y&&m.length&&(o({t:d,styles:[...m]}),d="",m=m.filter(t=>!y[e].includes(t))),e in a){let t=a[e];if(m.length)for(var _ in o({t:d,styles:[...m]}),m=[],y)Number(_)>e+t.length&&m.push(...y[_]);else o({t:d});d="",s(t,r.slice(e,e+t.length).join(""),m),e+=t.length-1;continue}if(e in f){let t=f[e],n=t.end-t.start;if(m.length)for(var _ in o({t:d,styles:[...m]}),m=[],y)Number(_)>e+n&&m.push(...y[_]);else o({t:d});d="",o({t:r.slice(e,e+n).join(""),link:t.href}),e+=n-1;continue}e in g&&(m.length?o({t:d,styles:[...m]}):o({t:d}),d="",g[e].forEach(e=>{if(p[e.style]){let t=p[e.style];m.push(t);let n=e.offset+e.length;n in y?y[n].push(t):y[n]=[t]}})),d+=r[e]}m.length?o({t:d,styles:[...m]}):o({t:d}),d="",n&&(0===n.length&&n.push({t:""}),t.push({children:n}),n=[])}),n&&i.push({styles:["ordered-list-item"===l?"ol":"ul"],children:t}),i}function q(e){let t=[];return e.forEach(e=>{let n=(0,u.F)(e.t);if(n){let r=n.split("\n");1===r.length?t.push(e):r.forEach((n,i)=>{let l=i<r.length-1?`${n}
`:n;void 0!==e.styles?t.push({t:l,styles:e.styles}):t.push({t:l})})}else t.push(e)}),t}let $=(e,t,n,r,i,l="default")=>{let o=[],s=[],f="";q(e).forEach(e=>{let g=(0,u.F)(e.t);if(e.children?.length){""!==f&&(i.push({text:f,entityRanges:o,type:l,depth:0,inlineStyleRanges:s,key:i.length.toString()}),f="",s=[],o=[]);let a=e.styles?.includes("ol")?"ordered-list-item":"unordered-list-item";e.children.forEach(e=>{e.children?.length&&$(e.children,t,n,r,i,a)})}else if(e.user_annotated||e.profile_id){let t=e.user_annotated?(0,u.F)(e.user_annotated.handle)||"":"@"+g,n=e.user_annotated?e.user_annotated:{id:e.profile_id,profile_handle:g};o.push({key:Object.keys(r).length,length:(0,c.Qt)(t).length,offset:(0,c.Qt)(f).length}),r[Object.keys(r).length]={type:"MENTION",mutability:"IMMUTABLE",data:{mention:n}},f+=t}else if(e.link&&(0,h.$x)((0,d.xT)(e.link)))o.push({key:Object.keys(r).length,length:(0,c.Qt)(g).length,offset:(0,c.Qt)(f).length}),r[Object.keys(r).length]={type:"HYPERLINK",mutability:"MUTABLE",data:{hyperlink:e.link,commentEditorType:n}},f+=g;else{if(e.styles?.length)e.styles.forEach(e=>{if(m[e]){let t=m[e];s.push({style:t,length:(0,c.Qt)(g).length,offset:(0,c.Qt)(f).length})}});else if((0,a.Lg)(g)){let e=(0,a.wd)(g),t=0,n="";for(let i of e){let e="",l="";(0,a.xM)(i)&&((0,a.UF)(i).forEach(t=>{e+=t.unicode,l+=t.meta}),o.push({key:Object.keys(r).length,length:(0,c.Qt)(e).length,offset:(0,c.Qt)(f).length+t}),r[Object.keys(r).length]={type:"EMOJI",mutability:"IMMUTABLE",data:{text:l,unicode:e}}),n+=e.length?e:i,t+=(0,c.Qt)(e.length?e:i).length}g=n}g?.endsWith("\n")?(f+=g.slice(0,-1),i.push({text:f,entityRanges:o,type:l,depth:0,inlineStyleRanges:s,key:i.length.toString()}),f="",o=[],s=[]):f+=g}}),(""!==f||"default"!==l)&&i.push({text:f,entityRanges:o,type:l,depth:0,inlineStyleRanges:s,key:i.length.toString()})};function Y(e,t,n){let i={},l=[];$(e,t,n,i,l,"default");let o=(0,r.convertFromRaw)({blocks:l,entityMap:i});return r.EditorState.createWithContent(o,t)}let z=e=>{let t=e.getCurrentContent().getFirstBlock(),n=t.getKey(),i=t.getLength();return r.EditorState.acceptSelection(e,new r.SelectionState({anchorKey:n,anchorOffset:i,focusKey:n,focusOffset:i,isBackward:!1}))};function X(e){let t=z(e);return r.EditorState.forceSelection(t,t.getSelection())}let G=e=>{let t=e.getAttribute("data-mention-user-id"),n=e.getAttribute("data-tooltip-user-handle");return t&&n?{id:t,handle:n}:null},Q=e=>e.getAttribute("data-tooltip-url-string");function V(e,t){var n=new DOMParser().parseFromString(e,"text/html"),i=n.getElementsByTagName("a");let l={};for(let e=0;e<i.length;e++){i[e].setAttribute("href",new URL(i[e].href,document.baseURI).toString());let t=i[e].getAttribute("href"),n=G(i[e]);n&&t&&(l[t]=n);let r=Q(i[e]);r&&i[e].setAttribute("href",r)}n.querySelectorAll('[data-stringify-type="paragraph-break"]').forEach(function(e){let t=n.createElement("br");e.parentNode&&e.parentNode.replaceChild(t,e)});let o=n.querySelector("body"),s=o?o.innerHTML:n.documentElement.outerHTML,a=s.includes("\x3c!--StartFragment--\x3e")?s:s.replace(/(?:\r\n|\r|\n)/g,"<br/>"),u=(0,r.convertFromHTML)(a),c=r.ContentState.createFromBlockArray(u.contentBlocks,u.entityMap);return c.getBlockMap().forEach(e=>{e?.findEntityRanges(e=>{let t=e.getEntity();return!!t&&"LINK"===c.getEntity(t).getType()},(n,i)=>{let o=e.getText().slice(n,i),s=r.SelectionState.createEmpty(e.getKey());s=s.merge({anchorOffset:n,focusKey:e.getKey(),focusOffset:i});let a=e.getEntityAt(n),u=c.getEntity(a).getData().url,f=l[u];f&&f.handle===o?c=c.createEntity("MENTION","IMMUTABLE",{mention:l[u]}):h.$x(d.xT(u))&&(c=c.createEntity("HYPERLINK","MUTABLE",{hyperlink:u,editorType:t}));let g=c.getLastCreatedEntityKey();c=r.Modifier.applyEntity(c,s,g)})}),c}function Z(e){let t=e.getCurrentContent().getLastBlock().getKey(),n=e.getSelection().getEndKey();return n===t||n===e.getCurrentContent().getKeyBefore(t)}},157869:(e,t,n)=>{n.d(t,{n:()=>c});var r=n(104076),i=n(674524),l=n(511570),o=n.n(l),s=n(652539),a=n(894210);let u="file_upload_icon_input--disabledIcon--JLhI1";function c(e){let{svg:t,svgAltText:n,isDisabled:l,acceptedFileTypes:c,inputRef:d,onFileInputChange:f,singleFile:g,recordingKey:h}=e,p=(0,i.AF)(h,"change",e=>{f(d)()});return(0,r.jsxs)("label",{htmlFor:e.inputId,className:o()("file_upload_icon_input--fileUploadIconLabel--GkBse",{[u]:l}),"data-tooltip-type":a.Ib.TEXT,"data-tooltip-show-immediately":!0,"data-tooltip":l?null:e["data-tooltip"],children:[(0,r.jsx)("input",{ref:d,accept:c,"aria-label":e["data-tooltip"],className:"file_upload_icon_input--fileInput--qwRav",disabled:l,id:e.inputId,multiple:!g,name:e.inputId,onChange:p,type:"file"}),e.children||t&&(0,r.jsx)("div",{className:"file_upload_icon_input--svg--qwaj3",children:(0,r.jsx)(s.B,{title:n,ariaLabel:n,svg:t,autosize:!0,className:o()({[u]:l})})})]})}}}]);

//# debugId=3c6cb0ea-809d-5cc9-9d00-767bc605e36f

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/ca180a4a1e7cf0b0cece4d936226f0120c28fa05/9137-35d4869705b2df61.min.js.map